<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>ApiBoot Blog</title>
        <link>https://apiboot2.minbox.org/blog</link>
        <description>ApiBoot Blog</description>
        <lastBuildDate>Thu, 09 Jan 2020 09:49:56 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[分布式任务调度框架ApiBoot Quartz内的两种任务存储方式]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-quartz-job-storage-away</link>
            <guid>apiboot-quartz-job-storage-away</guid>
            <pubDate>Thu, 09 Jan 2020 09:49:56 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p><code>Quartz</code>是一款比较优秀的分布式任务调度框架，<code>ApiBoot</code>对其封装之前就有两种任务存储方式，分别是：<code>memory</code>（内存方式）、<code>jdbc</code>（数据库方式），不过我们需要编写一些繁琐的代码配置，<code>ApiBoot</code>实现了集成后，可快速应用到项目中，而且还提供了 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/ApiBootQuartzService.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzService</a> 接口用于操作任务的状态、有效性、新任务创建等，提供了一些常用方法，使用时只需要注入即可，因为该类在 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/quartz/ApiBootQuartzAutoConfiguration.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzAutoConfiguration</a> 自动化配置类中已经做了实例化。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="任务存储">任务存储<a class="hash-link" href="#任务存储" title="标题的直接链接">​</a></h2><p>之前有提到<code>Quartz</code>提供了两种任务存储的方式，这两种存在什么区别呢？</p><ul><li><strong>内存方式</strong>：将任务临时存储到内存中，仅支持单项目部署，项目重启后任务会失效，不支持由调度器控制任务漂移，不建议使用。</li><li><strong>数据库方式</strong>：<code>Quartz</code>提供了多种数据库的所需表结构脚本，它内部通过<code>DataSource</code>来操作数据，支持分布式方式部署、支持任务漂移，项目重启后任务不会丢失，直到任务执行完成后才会被从数据库内清除。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="默认方式">默认方式<a class="hash-link" href="#默认方式" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>在整合<code>Quartz</code>之后将<code>内存方式</code>（memory）作为默认的任务存储方式，默认方式下不需要一行代码的配置就可以实现集成，通过<code>ApiBootQuartzService#newJob</code>方法就可以实现任务的初始化运行，还可以指定<code>Once</code>、<code>Loop</code>、<code>Cron</code>三种方式的任意一种来运行任务，使用方式详见：<a href="https://blog.yuqiyu.com/apiboot-quartz-job-types.html" target="_blank" rel="noopener noreferrer">分布式调度框架Quartz衍生出的三种任务类型，你用过几个？</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据库方式">数据库方式<a class="hash-link" href="#数据库方式" title="标题的直接链接">​</a></h2><p><code>Quartz</code>针对不同数据库类型提供了代理接口<code>DriverDelegate</code>，不同数据库类型都会有该代理接口的实现类，而我们平时所用到的则为<code>StdJDBCDelegate</code>，该类内包含了<code>Quartz</code>操作数据库表内数据的全部方法。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据脚本">数据脚本<a class="hash-link" href="#数据脚本" title="标题的直接链接">​</a></h3><p><code>Quartz</code>针对不同类型的数据库分别提供了 <a href="https://gitee.com/minbox-projects/api-boot/tree/master/api-boot-samples/api-boot-sample-quartz/src/main/resources/schemas" target="_blank" rel="noopener noreferrer">建表语句</a>，使用时请按照脚本名称自行选择。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apiboot-quartz启用数据库方式">ApiBoot Quartz启用数据库方式<a class="hash-link" href="#apiboot-quartz启用数据库方式" title="标题的直接链接">​</a></h3><p>启用的方式很简单，只需要在<code>application.yml/application.properties</code>文件内添加如下配置：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">quartz</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置使用Jdbc方式存储任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">job-store-type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意事项：既然启用<strong>数据库方式</strong>，那么你的项目中必须要有<code>数据源</code>、<code>数据库驱动</code>、<code>实例化数据源</code>（实例化<code>DataSource</code>的工作一般是ORM框架来担任，如：<a href="https://apiboot.minbox.org/docs/components/api-boot-mybatis-enhance.html" target="_blank" rel="noopener noreferrer">ApiBoot MyBatis Enhance</a>）等依赖。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>本章主要介绍了<code>ApiBoot</code>整合<code>Quartz</code>后的任务存储方式配置方式以及提供的不同数据库的对应建表脚本。</p><blockquote><p>如果你对<code>ApiBoot</code>开源框架在使用方面感觉不顺手，欢迎提出您的宝贵 <a href="https://gitee.com/minbox-projects/api-boot/issues" target="_blank" rel="noopener noreferrer">意见</a>，让开源框架走更远的路、服务更多的开发者！！！</p></blockquote>]]></content:encoded>
            <category>Quartz</category>
        </item>
        <item>
            <title><![CDATA[OAuth2在内存、Redis方式下的多客户端配置]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-oauth-multiple-client-config</link>
            <guid>apiboot-oauth-multiple-client-config</guid>
            <pubDate>Tue, 31 Dec 2019 09:37:53 GMT</pubDate>
            <description><![CDATA[Spring所提供的OAuth2集成策略，支持多种方式存储认证信息以及客户端信息，由于在之前的文章中讲解使用时把知识点进行了拆分，有很多同学不太会组合使用，很多单独问我ApiBoot所提供的OAuth2的整合后，多个客户端该怎么配置？]]></description>
            <content:encoded><![CDATA[<p><code>Spring</code>所提供的<code>OAuth2</code>集成策略，支持多种方式存储<code>认证信息</code>以及<code>客户端信息</code>，由于在之前的文章中讲解使用时把知识点进行了拆分，有很多同学不太会组合使用，很多单独问我<code>ApiBoot</code>所提供的<code>OAuth2</code>的整合后，多个客户端该怎么配置？</p><p>本章就来讲讲如果我们使用<code>内存方式</code>、<code>Redis方式</code>做<code>OAuth2</code>相关信息存储时，该如何配置多个客户端！！！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="系列文章">系列文章<a class="hash-link" href="#系列文章" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>针对每一个组件都提供一系列的拆分详解文章，详情请访问 <a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot开源框架各个组件的系列使用文章汇总</a> 。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>集成<code>OAuth2</code>后<code>内存方式</code>与<code>Redis方式</code>的客户端配置都位于<code>application.yml/application.properties</code>配置文件内，通过源码发现<code>Spring</code>提供了一个接口 <strong>TokenStore</strong> 来定义操作认证信息的方法列表，实现该接口后就可以定义不同的存储方式具体的逻辑，当前我们也可以进行自定义，只需要将自定义实现类的实例交付给<code>Spring IOC</code>进行托管就即可，<code>OAuth2</code>内部就会调用自定义的实现类来处理业务（<strong>在内部都是通过接口来操作，不关心实例是哪个实现类</strong>）。</p><p>当然<code>Spring</code>在整合<code>OAuth2</code>后也提供了一些内置的<code>TokenStore</code>实现类，如下所示：</p><ul><li><p><strong>InMemoryTokenStore</strong></p><p>将<code>客户端信息</code>以及生成的<code>AccessToken</code>存放在<strong>内存</strong>中，项目重启后之前生成的<code>AccessToken</code>就会丢失，而<code>ApiBoot OAuth</code>在项目启动时会自动加载<code>application.yml</code>配置文件的客户端列表，所以客户端信息不会丢失。</p></li><li><p><strong>JdbcTokenStore</strong></p><p>将<code>客户端信息</code>以及生成的<code>AccessToken</code>存放在<strong>数据库</strong>中，项目重启后不影响认证，表结构由<code>OAuth2</code>提供。</p></li><li><p><strong>RedisTokenStore</strong></p><p>将<code>客户端信息</code>以及生成的<code>AccessToken</code>存放在 <strong>Redis</strong>中，支持分布式部署，<code>AccessToken</code>默认过期时间为<code>7200</code>秒，过期后也会自动被删除，使用起来比较方便，<code>ApiBoot OAuth</code>只需要修改<code>api.boot.oauth.away=redis</code>就可以启用这种方式。</p></li><li><p><strong>JwtTokenStore</strong></p><p>主要功能是使用<code>Jwt</code>进行转换<code>AccessToken</code>，并不做数据<code>AccessToken</code>的存储。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端配置源码分析">客户端配置源码分析<a class="hash-link" href="#客户端配置源码分析" title="标题的直接链接">​</a></h2><p>当我们使用<code>ApiBoot OAuth2</code>提供的<code>内存方式</code>、<code>Redis方式</code>来集成使用时，客户端列表的配置都位于<code>application.yml</code>，使用<code>api.boot.oauth.clients</code>配置参数进行指定，那这个参数所对应的源码位于 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/oauth/ApiBootOauthProperties.java" target="_blank" rel="noopener noreferrer">ApiBootOauthProperties</a> 属性配置类内。</p><p>在<code>ApiBoot</code>最初发行版中客户端只允许配置一个，根据使用者的反馈进行了迭代更新后支持了多个客户端的配置，对应<code>ApiBootOauthProperties</code>属性配置类内的<code>clientis</code>字段，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * configure multiple clients</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">List</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">Client</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> clients </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ArrayList</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token function" style="color:#79b6f2">add</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Client</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>clients</code>字段默认值为一个<code>Client</code>的对象实例，而<code>Client</code>则是为<code>ApiBootOauthProperties</code>的一个内部类，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Oauth2 Client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Used to configure multiple clients</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Client</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> clientId </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"ApiBoot"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client secret</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"ApiBootSecret"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client grant types</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "password,refresh_token"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> grantTypes </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"password"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_token"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client scope</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "api"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> scopes </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 application resource id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "api"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> resourceId </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 access token validity seconds</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is 7200 second</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> accessTokenValiditySeconds </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7200</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据<code>Client</code>类我们也就可以明白了，为什么<code>ApiBoot OAuth</code>在集成时不配置<code>客户端</code>也可以使用<code>ApiBoot:ApiBootSecret</code>来进行获取<code>AccessToken</code>，因为在<code>ApiBootOauthProperties</code>属性配置类中有一个默认的<code>Client</code>对象实例。</p><blockquote><p>注意事项：当我们配置<code>api.boot.oauth.clients</code>参数时默认的客户端会被覆盖掉</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例项目">示例项目<a class="hash-link" href="#示例项目" title="标题的直接链接">​</a></h2><p>既然我们知道了使用<code>api.boot.oauth.clients</code>可以配置多个客户端，那么接下来我们创建一个测试的项目，使用<code>IDEA</code>创建一个<code>SpringBoot</code>项目，项目<code>pom.xml</code>文件内容如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Security OAuth--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置多客户端">配置多客户端<a class="hash-link" href="#配置多客户端" title="标题的直接链接">​</a></h3><p>看过<code>ApiBoot OAuth2</code>系列文章的同学都应该知道，默认使用<code>内存方式</code>进行存储生成的<code>AccessToken</code>，这一点我们就不做修改了，如果你项目不是使用默认，可以去参考 <a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot开源框架各个组件的系列使用文章汇总</a> 内安全组件分类下的文章。</p><p>在<code>application.yml</code>文件内添加客户端列表配置，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot OAuth 相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">clients</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> minbox</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> chapter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Security 相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>由于<code>api-boot-starter-security-oauth-jwt</code>依赖是<code>Spring Security</code>与<code>OAuth2</code>的整合，所以我们想要获取<code>AccessToken</code>需要配置<code>Spring Security</code>的用户列表，即<code>api.boot.security.users</code>参数，默认同样是内存方式存储，详见：<a href="https://blog.yuqiyu.com/apiboot-security-oauth-zero-code-integration.html" target="_blank" rel="noopener noreferrer">ApiBoot实现零代码整合Spring Security &amp; OAuth2</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>通过<code>XxxApplication</code>方式启动本章项目，通过Curl命令测试获取<code>AccessToken</code>，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜  ~ curl -X POST minbox</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">8080</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bf2d67b8-c7a4-4f5c-846e-a6f1c7e44a9d"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"522507a2-30e5-4d86-a997-c991c3cb0807"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7191</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上面命令行中，我们通过<code>minbox:chapter</code>客户端进行测试获取<code>AccessToken</code>，接下来我们验证是否两个客户端都已经生效，下面使用<code>hengboy:123123</code>客户端尝试：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜  ~ curl -X POST hengboy</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain">@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">8080</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain">'                    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"62b8da93-27cd-4963-8612-8e94036c4d78"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"4e516a7f-db52-4f40-ab92-c6b43cd62294"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据输出来看，是可以获取到<code>AccessToken</code>的，多客户端配置都已经生效。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>其实<code>ApiBoot Security OAuth</code>有很多配置都可以组合使用，不过跨越存储方式的配置有的是无法相互组合使用的，比如：当你使用<code>Jdbc</code>方式来存储认证信息时，即使我们配置了<code>api.boot.oauth.clients</code>参数，这时也是没有任何作用的，因为使用数据库方式来读取客户端信息时，<code>OAuth2</code>通过<code>JdbcClientDetailsService</code>类从数据库的<code>oauth_client_details</code>表内查询客户端列表，我们如果想要添加客户端，这时就需要向<code>oauth_client_details</code>表内添加一条数据。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-oauth-multiple-client-config</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[Quartz衍生出的三种任务类型，你用过几个？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-quartz-job-types</link>
            <guid>apiboot-quartz-job-types</guid>
            <pubDate>Tue, 24 Dec 2019 09:33:00 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p><code>Quartz</code>内部没有明确的任务类型的概念，在<code>ApiBoot</code>中对其进行封装后才确切的定义了这个概念，可以根据业务场景按需选择适合的任务类型来构建执行的任务。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="系列文章">系列文章<a class="hash-link" href="#系列文章" title="标题的直接链接">​</a></h2><p><code>ApiBoot Quartz</code>是以系列文章的形式更新，了解更多使用方法请访问如下链接：</p><ul><li><a href="https://blog.yuqiyu.com/apiboot-quartz-integrated-away.html" target="_blank" rel="noopener noreferrer">这种方式整合Quartz你见过吗？</a></li></ul><p><code>ApiBoot</code>内其他组件系列使用文章请访问：<a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot开源框架各个组件的系列使用文章汇总</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="衍生的任务类型">衍生的任务类型<a class="hash-link" href="#衍生的任务类型" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>对<code>Quartz</code>集成封装后，提供了如下三种的任务类型：</p><ul><li><strong>OnceJob</strong>：一次性任务，仅执行一次</li><li><strong>CronJob</strong>：使用Cron表达式定义任务周期</li><li><strong>LoopJob</strong>：指定循环次数的任务</li></ul><blockquote><p>注意事项：任务类型是任务的执行方式类型，并不是创建任务的类型，创建任务都是通过继承<code>QuartzJobBean</code>来完成，同一个任务可以使用不同的类型执行。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="演示项目">演示项目<a class="hash-link" href="#演示项目" title="标题的直接链接">​</a></h2><p>我们使用<code>Idea</code>创建一个<code>SpringBoot</code>项目，用于我们本章的演示项目，创建项目后添加<code>ApiBoot Quartz</code>相关的依赖到<code>pom.xml</code>文件内，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Quartz--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-quartz</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例任务">示例任务<a class="hash-link" href="#示例任务" title="标题的直接链接">​</a></h3><p>我们来创建一个本章演示所需要的任务类，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 示例任务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">QuartzJobBean</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">executeInternal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">JobExecutionContext</span><span class="token plain"> context</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">JobExecutionException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"这是一个示例任务，执行时间：{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">System</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">currentTimeMillis</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当任务执行时就会在控制台输出任务执行的时间，继承自<code>Spring</code>提供的封装任务类<code>QuartzJobBean</code>，会自动扫描到<code>DemoJob</code>并通过反射创建实例后放入<code>Ioc</code>容器，具体的流程可以访问 <a href="https://blog.yuqiyu.com/apiboot-quartz-integrated-away.html" target="_blank" rel="noopener noreferrer">这种方式整合Quartz你见过吗？</a> 了解详情。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="一次性任务">一次性任务<a class="hash-link" href="#一次性任务" title="标题的直接链接">​</a></h3><p>我们使用<code>Once</code>任务类型来执行上面创建的<code>DemoJob</code>示例任务，先上代码，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * ApiBoot Quartz内置接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * @see org.minbox.framework.api.boot.plugin.quartz.support.ApiBootQuartzServiceDefaultSupport</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootQuartzService</span><span class="token plain"> quartzService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// 创建Once任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootOnceJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们只需要一行代码就可以来定义一个新的任务，在代码中出现了一个新面孔 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/wrapper/support/ApiBootOnceJobWrapper.java" target="_blank" rel="noopener noreferrer">ApiBootOnceJobWrapper</a>。</p><p><code>ApiBootOnceJobWrapper</code>主要工作是来封装Once类型任务所需要的配置字段，内部通过<code>Lombok</code>提供的<code>@Builder</code>注解来实现，<code>Once</code>任务可配置的内容如下所示：</p><table><thead><tr><th>方法</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>.jobClass(Class&lt;? extends QuartzJobBean&gt; jobClass)</td><td>-</td><td>配置所执行的QuartzJobBean实现类类型</td></tr><tr><td>.jobKey(String jobKey)</td><td>随机UUID字符串</td><td>任务唯一key</td></tr><tr><td>.startAtTime(Date startAtTime)</td><td>当前时间</td><td>任务开始执行时间</td></tr><tr><td>.param(ApiBootJobParamWrapper param)</td><td>-</td><td>任务执行时的参数列表封装对象</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cron表达式任务">Cron表达式任务<a class="hash-link" href="#cron表达式任务" title="标题的直接链接">​</a></h3><p><code>Cron</code>表达式来创建任务是比较灵活的，也是比较常用的方式，使用<code>ApiBoot Quartz</code>同样仅仅需要一行代码就可以实现，下面我们来定义每间隔一秒执行一次<code>DemoJob</code>内的任务逻辑，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * ApiBoot Quartz内置接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * @see org.minbox.framework.api.boot.plugin.quartz.support.ApiBootQuartzServiceDefaultSupport</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootQuartzService</span><span class="token plain"> quartzService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// 创建Cron任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootCronJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">cron</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"0/1 * * * * ?"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/wrapper/support/ApiBootCronJobWrapper.java" target="_blank" rel="noopener noreferrer">ApiBootCronJobWrapper</a> 所做的工作与<code>ApiBootOnceJobWrapper</code>其实是一样的，都是用来采集<code>Cron</code>类型的任务所需要的配置字段，内部同样是通过<code>Lombok</code>提供的<code>@Builder</code>注解实现，<code>Cron</code>类型任务可配置的内容如下所示：</p><table><thead><tr><th>方法</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>.jobClass(Class&lt;? extends QuartzJobBean&gt; jobClass)</td><td>-</td><td>配置所执行的QuartzJobBean实现类类型</td></tr><tr><td>.jobKey(String jobKey)</td><td>随机UUID字符串</td><td>任务唯一key</td></tr><tr><td>.cron(String cron)</td><td>-</td><td>任务执行时间的Cron表达式</td></tr><tr><td>.param(ApiBootJobParamWrapper param)</td><td>-</td><td>任务执行时的参数列表封装对象</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loop循环任务">Loop循环任务<a class="hash-link" href="#loop循环任务" title="标题的直接链接">​</a></h3><p><code>Loop</code>类型的任务在开发中也是比较常用的，根据指定的<code>循环次数</code>以及每一次执行的<code>间隔时间</code>运行定时任务逻辑，当获取到期望的结果后还可以将任务自身进行删除，先来看看一个简单例子：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * ApiBoot Quartz内置接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * @see org.minbox.framework.api.boot.plugin.quartz.support.ApiBootQuartzServiceDefaultSupport</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootQuartzService</span><span class="token plain"> quartzService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// 创建Loop任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootLoopJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">loopIntervalTime</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2000</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">repeatTimes</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>上面的定时任务会先执行1次后每<code>间隔2000毫秒</code>再执行<strong>5次</strong>，一共是执行<strong>6次</strong>，大家注意配置。</p></blockquote><p>可以看到<code>Loop</code>类型的任务也提供了一个 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/wrapper/support/ApiBootLoopJobWrapper.java" target="_blank" rel="noopener noreferrer">ApiBootLoopJobWrapper</a> 来封装任务执行所需要的配置字段，可配置的字段方法如下所示：</p><table><thead><tr><th>方法</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>.jobClass(Class&lt;? extends QuartzJobBean&gt; jobClass)</td><td>-</td><td>配置所执行的QuartzJobBean实现类类型</td></tr><tr><td>.jobKey(String jobKey)</td><td>随机UUID字符串</td><td>任务唯一key</td></tr><tr><td>.loopIntervalTime(int intervalTime)</td><td>1000</td><td>循环执行的间隔时间，单位：毫秒</td></tr><tr><td>.repeatTimes(int times)</td><td>0</td><td>循环执行次数</td></tr><tr><td>.startAtTime(Date startAtTime)</td><td>当前时间</td><td>任务开始执行时间</td></tr><tr><td>.param(ApiBootJobParamWrapper param)</td><td>-</td><td>任务执行时的参数列表封装对象</td></tr></tbody></table><blockquote><p>如果不设置<code>repeatTimes</code>仅执行一次，效果与<code>Once</code>一样。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>在运行项目之前先来修改项目的<code>XxxApplication</code>入口类，我们期望在项目启动完成后就执行任务，那么我们直接实现<code>CommandLineRunner</code>接口来完成这一需求，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Quartz 三种任务类型示例</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootQuartzJobTypesApplication</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CommandLineRunner</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootQuartzJobTypesApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * ApiBoot Quartz内置接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @see org.minbox.framework.api.boot.plugin.quartz.support.ApiBootQuartzServiceDefaultSupport</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootQuartzService</span><span class="token plain"> quartzService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// 一次性任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootOnceJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// 循环执行任务，每隔2000毫秒执行一次，循环5次，一共执行6次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootLoopJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">loopIntervalTime</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2000</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">repeatTimes</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Cron表达式任务，间隔1秒执行一次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootCronJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">cron</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"0/1 * * * * ?"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动项目后我们可以在控制台看到有任务执行时间输出，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:05.046  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170565046</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:05.046  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-2</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170565046</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:05.047  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-3</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170565047</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:06.005  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-4</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170566005</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:07.002  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-5</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170567002</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:07.042  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-6</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170567042</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2019</span><span class="token plain">-12-24 </span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:56:08.003  INFO </span><span class="token number" style="color:#5a9bcf">3113</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">eduler_Worker-7</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.minbox.chapter.apiboot.quartz.DemoJob  </span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token plain"> 这是一个示例任务，执行时间：1577170568003</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>虽然任务已经执行了，但是由于是多种执行方式同时执行同一个任务，我们不好做出区分，针对这个问题可以使用<code>ApiBoot Quartz</code>提供的参数来解决。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Quartz</code>所提供的功能已经可以满足日常开发所需要，而且比较灵活，可以通过<code>ApiBoot Quartz</code>提供的<code>Wrapper</code>封装类的方法进行自定义配置，<strong>任务的执行是子线程异步操作，不需要考虑会影响访问响应的效率问题</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-quartz-job-types</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Quartz</category>
        </item>
        <item>
            <title><![CDATA[这种方式整合Quartz你见过吗？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-quartz-integrated-away</link>
            <guid>apiboot-quartz-integrated-away</guid>
            <pubDate>Mon, 23 Dec 2019 14:34:10 GMT</pubDate>
            <description><![CDATA[Quartz是一款优秀的任务调度框架，支持内存、JDBC的形式来存储未执行的任务列表，支持多个任务节点同时执行任务，支持任务漂移到不同的节点执行。]]></description>
            <content:encoded><![CDATA[<p><code>Quartz</code>是一款优秀的任务调度框架，支持内存、JDBC的形式来存储未执行的任务列表，支持多个任务节点同时执行任务，支持任务漂移到不同的节点执行。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p>这么优秀的任务调度框架我想应该是很多开发者的首选解决方案，因此<code>ApiBoot</code>对它下手了，基于<code>SpringBoot</code>封装了名为<code>ApiBoot Quartz</code>的组件，同样是通过<code>application.yml</code>配置文件的形式就可以简单的实现初始化集成。</p><p>如果使用默认的配置，我们可以不编写一行集成相关的代码，<code>ApiBoot Quartz</code>还针对日常高频率使用的方法提供了一个接口，定义的方法如：创建任务、暂停任务、恢复任务、删除任务等等。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="任务存储方式">任务存储方式<a class="hash-link" href="#任务存储方式" title="标题的直接链接">​</a></h2><p><code>Quartz</code>自身提供了两种存储任务的方式：</p><ul><li><code>Memory</code>：内存方式，将任务存储到内存中，当项目重启时就会丢失，不建议生产环境使用。</li><li><code>Jdbc</code>：数据库方式，将任务存储到<code>Quartz</code>提供的固定结构的表内，项目重启任务不会丢失，多种数据库的建表语句请访问：<a href="https://github.com/minbox-projects/api-boot/tree/master/api-boot-samples/api-boot-sample-quartz/src/main/resources/schemas" target="_blank" rel="noopener noreferrer">Quartz Schemas</a> 按需选择。</li></ul><p><code>ApiBoot</code>将<code>Quartz</code>内提供的两种存储方式进行了封装，通过<code>api.boot.quartz.job-store-type</code>参数进行配置，该参数默认值为<code>memory</code>，所以你如果使用内存方式该参数不需要修改，更多配置请访问 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/quartz/ApiBootQuartzProperties.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzProperties</a> 查看。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="任务类型">任务类型<a class="hash-link" href="#任务类型" title="标题的直接链接">​</a></h2><p>任务类型是<code>ApiBoot Quartz</code>的新概念，其实在<code>Quartz</code>中任务并没有类型区分，实现<code>org.quartz.Job</code>接口就可以创建一个任务。</p><p>不过<code>Spring</code>也是爱折腾，对其进行了封装提供了<code>QuartzJobBean</code>，它是一个抽象类，我们继承该类后也可以创建一个定时任务。</p><p>在<code>ApiBoot Quartz</code>中有三种任务类型，分别是：</p><ul><li><strong>OnceJob</strong>：仅执行一次的任务类型</li><li><strong>CronJob</strong>：使用Cron表达式来定义任务的执行周期</li><li><strong>LoopJob</strong>：可指定循环次数的任务，根据指定循环的次数进行重复执行</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内置方法">内置方法<a class="hash-link" href="#内置方法" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>封装<code>Quartz</code>后所提供的方法都位于 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/ApiBootQuartzService.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzService</a> 接口中，而该接口有一个默认的实现类 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-plugins/api-boot-plugin-quartz/src/main/java/org/minbox/framework/api/boot/plugin/quartz/support/ApiBootQuartzServiceDefaultSupport.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzServiceDefaultSupport</a> ，该实现类全部实现了接口定义方法，内部通过<code>org.quartz.Scheduler</code>来实现任务的基本操作。</p><p><strong>内置方法列表：</strong></p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>Scheduler getScheduler();</code></td><td>获取SpringIoc容器内的Scheduler实例</td></tr><tr><td><code>String newJob(ApiBootJobWrapper jobWrapper);</code></td><td>通过封装的对象创建一个新的任务，这是创建所有类型任务的入口</td></tr><tr><td><code>void deleteJob(String jobKey);</code></td><td>删除一个任务</td></tr><tr><td><code>void deleteJobs(String... jobKeys);</code></td><td>删除一系列任务</td></tr><tr><td><code>void deleteJobs(Collection&lt;String&gt; jobKeys);</code></td><td>删除集合内的所有任务</td></tr><tr><td><code>void pauseJob(String jobKey);</code></td><td>暂停一个任务</td></tr><tr><td><code>void pauseJobs(String... jobKeys);</code></td><td>暂停传递的所有任务</td></tr><tr><td><code>java void pauseJobs(Collection&lt;String&gt; jobKeys);</code></td><td>暂停集合内的所有任务</td></tr><tr><td><code>void resumeJob(String jobKey);</code></td><td>恢复一个任务执行</td></tr><tr><td><code>void resumeJobs(String... jobKeys);</code></td><td>恢复数组内的所有任务执行</td></tr><tr><td><code>java void resumeJobs(Collection&lt;String&gt; jobKeys);</code></td><td>恢复集合内的所有任务执行</td></tr><tr><td><code>void updateJobCron(String jobKey, String cron);</code></td><td>更新任务Cron表达式</td></tr><tr><td><code>void updateJobStartTime(String jobKey, Date jobStartTime);</code></td><td>更新任务开始时间</td></tr><tr><td><code>void startAllJobs();</code></td><td>启动所有定时任务</td></tr><tr><td><code>void shutdownAllJobs();</code></td><td>关闭所有定时任务</td></tr></tbody></table><p>既然<code>ApiBoot</code>为我们提供了这么多内置的方法，我们接下来创建一个项目来感受一下。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例项目">示例项目<a class="hash-link" href="#示例项目" title="标题的直接链接">​</a></h2><p>使用<code>Idea</code>创建一个<code>SpringBoot</code>项目，我们把本章所需要的依赖添加在<code>pom.xml</code>文件内，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Quartz--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-quartz</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="示例任务类">示例任务类<a class="hash-link" href="#示例任务类" title="标题的直接链接">​</a></h2><p>我们来创建一个名为<code>DemoJob</code>的任务调度示例类，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 示例任务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">QuartzJobBean</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">executeInternal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">JobExecutionContext</span><span class="token plain"> jobExecutionContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">JobExecutionException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">System</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">println</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"任务执行了.."</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quartzjobbean是什么">QuartzJobBean是什么？<a class="hash-link" href="#quartzjobbean是什么" title="标题的直接链接">​</a></h2><p><code>QuartzJobBean</code>是由<code>Spring</code>提供，实现<code>org.quartz.Job</code>接口，是对<code>Quartz</code>内置任务接口的实现并且封装。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quartzjobbean的优势">QuartzJobBean的优势<a class="hash-link" href="#quartzjobbean的优势" title="标题的直接链接">​</a></h2><p><code>Spring</code>所提供的<code>QuartzJobBean</code>具体有什么优势呢？</p><ul><li><p><strong>自动将实现类实例加入IOC</strong></p><p>使用<code>QuartzJobBean</code>来创建自定义任务时，<code>Spring</code>会自动扫描项目内的实现类，将每一个实现类通过反射机制创建出实例并将实例写入到<code>IOC</code>容器内。</p></li><li><p><strong>可在实现类内注入实例</strong></p><p>直接使用<code>Quartz</code>时，如果自定义任务类实例不加入<code>IOC</code>容器，我们无法在自定义任务类注入<strong>Service</strong>，这一点了解<code>Spring</code>基础的同学应该都明白，我们无法在非被<code>IOC</code>托管的类内进行注入操作，而使用<code>QuartzJobBean</code>则不用考虑这一点。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quartzjobbean注册流程">QuartzJobBean注册流程<a class="hash-link" href="#quartzjobbean注册流程" title="标题的直接链接">​</a></h2><p>使用<code>ApiBoot Quartz</code>后为什么不需要再手动添加注入把任务实现类加入到<code>IOC</code>容器？</p><p>任务类注册流程如下所示：</p><ul><li><p><strong>第一步：ApiBootQuartzAutoConfiguration#quartzScheduler()</strong></p><p><code>ApiBoot</code>在集成<code>Quartz</code>时提供了一个自动化配置类 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/quartz/ApiBootQuartzAutoConfiguration.java" target="_blank" rel="noopener noreferrer">ApiBootQuartzAutoConfiguration</a> ，在该类中通过<code>quartzScheduler()</code>方法来自动创建一个<code>SchedulerFactoryBean</code>实例</p></li><li><p><strong>第二步：SchedulerFactoryBean#setJobFactory()</strong></p><p>通过<code>SchedulerFactoryBean</code>内提供的<code>setJobFactory()</code>方法可以自定义设置具体使用<code>JobFactory</code>的实现类，而在<code>spring-context-support</code>依赖内已经提供了相关实现，名为 <code>SpringBeanJobFactory</code>。</p></li><li><p><strong>第三步：SpringBeanJobFactory#createJobInstance()</strong></p><p>在项目启动时会将扫描到的所有<code>QuartzJobBean</code>实现类通过<code>JobFactory#newJob</code>方法进行创建任务实例后将实例交付给<code>Quartz</code>框架进行准备后期的任务调度。</p></li></ul><p><code>SpringBeanJobFactory</code>类继承于<code>AdaptableJobFactory</code>类，而<code>AdaptableJobFactory</code>则是实现了<code>JobFactory</code>接口，这样的话如果我们将<code>SpringBeanJobFactory</code>设置给<code>SchedulerFactoryBean</code>项目启动时<code>Quartz</code>就会调用<code>SpringBeanJobFactory#createJobInstance()</code>方法来创建任务实例。</p><p>而在<code>createJobInstance()</code>方法内<code>Spring</code>则是将创建的任务实例存入了<code>IOC</code>容器内，这样一来我们的自定义任务内就可以进行注入其他Bean的操作了，该方法源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    * Create the job instance, populating it with property values taken</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    * from the scheduler context, job data map and trigger data map.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">protected</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Object</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createJobInstance</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">TriggerFiredBundle</span><span class="token plain"> bundle</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token class-name" style="color:#FAC863">Object</span><span class="token plain"> job </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">applicationContext </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">null</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999">// 通过ApplicationContext创建任务实例，并添加到IOC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">applicationContext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getAutowireCapableBeanFactory</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">createBean</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                  bundle</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getJobDetail</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getJobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">AutowireCapableBeanFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">AUTOWIRE_CONSTRUCTOR</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">false</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">super</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">createJobInstance</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bundle</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token function" style="color:#79b6f2">isEligibleForPropertyPopulation</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">BeanWrapper</span><span class="token plain"> bw </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PropertyAccessorFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">forBeanPropertyAccess</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">job</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">MutablePropertyValues</span><span class="token plain"> pvs </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MutablePropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">schedulerContext </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">null</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      pvs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">addPropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">schedulerContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    pvs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">addPropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bundle</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getJobDetail</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getJobDataMap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    pvs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">addPropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">bundle</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getTrigger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getJobDataMap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ignoredUnknownProperties </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">null</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> propName </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ignoredUnknownProperties</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pvs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">contains</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">propName</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">!</span><span class="token plain">bw</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">isWritableProperty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">propName</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          pvs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">removePropertyValue</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">propName</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      bw</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">setPropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pvs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      bw</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">setPropertyValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pvs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> job</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>大致的<code>QuartzJobBean</code>实现类注册流程就是这个样子的，下面让我们来见识下是不是真的有那么简单就可以创建并执行一个任务。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>为了演示方便，我们修改<code>XxxApplication</code>入口类，让项目启动后自动执行<code>DemoJob</code>任务，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootQuartzIntegratedAwayApplication</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CommandLineRunner</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootQuartzIntegratedAwayApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    * ApiBoot Quartz内置方法接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    * {@link org.minbox.framework.api.boot.plugin.quartz.support.ApiBootQuartzServiceDefaultSupport}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">    */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootQuartzService</span><span class="token plain"> quartzService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    quartzService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">newJob</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApiBootOnceJobWrapper</span><span class="token class-name punctuation" style="color:#8dc891">.</span><span class="token class-name" style="color:#FAC863">Context</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                         </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">jobClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">DemoJob</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                         </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">wrapper</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><code>CommandLineRunner</code>是由<code>SpringBoot</code>提供用于执行项目启动后的逻辑。</p></blockquote><p>启动项目后控制台输出内容如下所示：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">......</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">任务执行了..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>心细的同学应该看到了我们使用了<code>ApiBootOnceJobWeapper</code>这个封装类来创建的任务对象，我们下一章就来讲下这个封装类到底可以干什么？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>Quartz</code>是一个优秀的分布式任务调度框架，<code>ApiBoot</code>封装了它，使它插上了翅膀，让我们明白了简单的另一层定义。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-quartz-integrated-away</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Quartz</category>
        </item>
        <item>
            <title><![CDATA[Swagger2怎么整合OAuth2来在线调试接口？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-swagger-integrated-oauth</link>
            <guid>apiboot-swagger-integrated-oauth</guid>
            <pubDate>Wed, 18 Dec 2019 17:05:58 GMT</pubDate>
            <description><![CDATA[前言]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p><code>Swagger2</code>作为侵入式文档中比较出色的一员，支持接口认证的在线调试肯定是不在话下的，当我们在调用<code>OAuth2</code>所保护的接口时，需要将有效的<code>AccessToken</code>作为请求<code>Header</code>内<code>Authorization</code>的值时，我们才拥有了访问权限，那么我们在使用<code>Swagger</code>在线调试时该设置<code>AccessToken</code>的值呢？</p><p>本文所需ApiBoot相关链接：</p><ul><li><a href="https://apiboot.minbox.org/" target="_blank" rel="noopener noreferrer">ApiBoot官网</a></li><li><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot全组件系列文章</a></li><li><a href="https://gitee.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">ApiBoot Gitee源码仓库（欢迎Contributor）</a></li><li><a href="https://github.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">ApiBoot GitHub源码仓库（欢迎Contributor）</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建示例项目">创建示例项目<a class="hash-link" href="#创建示例项目" title="标题的直接链接">​</a></h2><p>在之前文章「<a href="https://blog.yuqiyu.com/apiboot-swagger-describe-the-interface.html" target="_blank" rel="noopener noreferrer">使用Swagger2作为文档来描述你的接口信息</a>」我们已经讲到了使用<code>Swagger2</code>来简单的描述接口，提供可视化在线的接口文档，我们本章的主要目的是来集成使用<code>OAuth2</code>实现在线调试接口，我们把之前章节测试的接口<code>UserController</code>复制到本篇文章中以便于测试，本章项目<code>pom.xml</code>依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-swagger</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你看过<code>ApiBoot Security</code>、<code>ApiBoot OAuth</code>你应该知道，通过<code>application.yml</code>文件简单的几行配置就可以集成<code>Spring Security</code>整合<code>OAuth2</code>，本章来使用<strong>内存方式</strong>配置<code>用户列表</code>以及<code>客户端列表</code>。</p><blockquote><p>ApiBoot Security &amp; ApiBoot OAuth组件使用系列文章：<a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">https://blog.yuqiyu.com/apiboot-all-articles.html</a></p><p>如果你想深入的了解这个神奇的<code>ApiBoot</code>安全组件，可以通过依赖文章汇总链接学习。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启用apiboot-swagger">启用ApiBoot Swagger<a class="hash-link" href="#启用apiboot-swagger" title="标题的直接链接">​</a></h2><p>通过<code>@EnableApiBootSwagger</code>注解来启用<code>ApiBoot Swagger</code>相关功能，在<code>XxxApplication</code>入口类配置如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableApiBootSwagger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootSwaggerIntegratedOauthApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootSwaggerIntegratedOauthApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置apiboot-security">配置ApiBoot Security<a class="hash-link" href="#配置apiboot-security" title="标题的直接链接">​</a></h2><p>使用<code>grant_type=password</code>获取<code>AccessToken</code>时，需要我们传递用户的<code>username</code>、<code>password</code>，使用默认的内存方式配置我们只需要在<code>application.yml</code>文件内添加如下配置：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置安全用户列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 资源保护路径前缀，默认为/api/**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">auth-prefix</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> /</span><span class="token important" style="font-weight:400">**</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置apiboot-oauth">配置ApiBoot OAuth<a class="hash-link" href="#配置apiboot-oauth" title="标题的直接链接">​</a></h2><p>我们来添加<code>OAuth2</code>所需要的客户端列表配置信息，使用默认的内存方式配置客户端的<code>client-id</code>、<code>client-secret</code>，只需要修改<code>application.yml</code>文件内容如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置OAuth客户端列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">clients</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> minbox</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> chapter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="了解资源文件排除拦截">了解资源文件排除拦截<a class="hash-link" href="#了解资源文件排除拦截" title="标题的直接链接">​</a></h2><p><code>Swagger2</code>可视化界面有很多静态资源组成，比如：<code>js/css/images</code>等，而集成<code>Spring Security</code>后这些资源需要排除权限拦截才可以访问到，如果是使用传统的方式整合<code>Spring Security</code>，需要使用<code>WebSecurity</code>来进行忽略路径才可以，而通过<code>ApiBoot Security</code>则是不用考虑这一点，在内部已经对<code>Swagger</code>的静态资源文件做出了排除。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>通过<code>Application</code>方式启动本章项目，<code>Swagger</code>可视化界面访问：<a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener noreferrer">http://localhost:8080/swagger-ui.html</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取accesstoken">获取AccessToken<a class="hash-link" href="#获取accesstoken" title="标题的直接链接">​</a></h3><p>通过<code>CURL</code>方式获取用户：<code>yuqiyu</code>的请求令牌，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> -X POST minbox:chapter@localhost:8080/oauth/token -d </span><span class="token string" style="color:#8dc891">'grant_type=password&amp;username=yuqiyu&amp;password=123123'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"access_token"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"304676a4-b9a6-4c4d-af40-e439b934aba8"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"token_type"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"refresh_token"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"ee2b5744-6947-4677-862e-fcf9517afca5"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"expires_in"</span><span class="token plain">:7199,</span><span class="token string" style="color:#8dc891">"scope"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swagger在线调试">Swagger在线调试<a class="hash-link" href="#swagger在线调试" title="标题的直接链接">​</a></h3><p>我们把获取的<code>AccessToken</code>与类型进行组合成：<code>Bearer 304676a4-b9a6-4c4d-af40-e439b934aba8</code>，将该令牌字符串配置到<code>Swagger</code>界面上，如下图所示：</p><p><img loading="lazy" src="https://blog.yuqiyu.com/images/post/apiboot-swagger-integrated-oauth-1.png" class="img_ev3q"></p><p>输入后点击<code>Authorize</code>按钮即可。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>Swagger</code>的在线调试其实内部是模拟发送请求，将界面上输入的参数进行组合装配，发送到需要测试的接口路径，而上图设置<code>AccessToken</code>，也是一个临时保存，<strong>刷新页面就会丢失</strong>，发送请求时会自动追加到<code>Request Header</code>列表内。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-swagger-integrated-oauth</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Swagger2</category>
        </item>
        <item>
            <title><![CDATA[使用Swagger2作为文档来描述你的接口信息]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-swagger-describe-the-interface</link>
            <guid>apiboot-swagger-describe-the-interface</guid>
            <pubDate>Wed, 18 Dec 2019 10:34:07 GMT</pubDate>
            <description><![CDATA[接口文档在前后分离的项目中是必不可少的一部分，文档的编写一直以来都是一件头疼的事情，写程序不写注释、不写文档这几乎是程序员的通病，Swagger2的产生给广大的程序员们带来了曙光，只需要在接口类或者接口的方法上添加注解配置，就可以实现文档效果，除了可以应用到单体应用，在微服务架构中也是可以使用的，只需要整合zuul就可以实现各个服务的文档整合。]]></description>
            <content:encoded><![CDATA[<p>接口文档在前后分离的项目中是必不可少的一部分，文档的编写一直以来都是一件头疼的事情，写程序<code>不写注释</code>、<code>不写文档</code>这几乎是程序员的通病，<code>Swagger2</code>的产生给广大的程序员们带来了曙光，只需要在接口类或者接口的方法上添加注解配置，就可以实现文档效果，除了可以应用到<code>单体应用</code>，在<code>微服务架构中</code>也是可以使用的，只需要整合<code>zuul</code>就可以实现各个服务的文档整合。</p><p>本文所需ApiBoot相关链接：</p><ul><li><a href="https://apiboot.minbox.org/" target="_blank" rel="noopener noreferrer">ApiBoot官网</a></li><li><a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot全组件系列文章</a></li><li><a href="https://gitee.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">ApiBoot Gitee源码仓库（欢迎Contributor）</a></li><li><a href="https://github.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">ApiBoot GitHub源码仓库（欢迎Contributor）</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="标题的直接链接">​</a></h2><p><code>ApiBoot Swagger</code>内部封装了<code>Swagger2</code>，只需要一个注解<code>@EnableApiBootSwagger</code>就可以实现集成，使用起来非常简单。</p><p><code>ApiBoot Swagger</code>提供了一系列的默认配置，比如：<code>文档标题</code>、<code>文档描述</code>、<code>文档版本号</code>等，如果需要修改文档的默认配置，只需要在<code>application.yml</code>文件内对应配置参数即可实现自定义，告别了繁琐的代码配置，<code>ApiBoot</code>通过自动化配置的方式来实现这一点，可以查看 <a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-autoconfigure/src/main/java/org/minbox/framework/api/boot/autoconfigure/swagger/ApiBootSwaggerAutoConfiguration.java" target="_blank" rel="noopener noreferrer">ApiBootSwaggerAutoConfiguration</a> 配置类源码了解详情。</p><p><code>ApiBoot Swagger</code>支持在线调试集成<code>OAuth2</code>的接口，只需要在文档界面通过 <code>"Authorize"</code>按钮设置有效的<code>AccessToken</code>即可。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="可配置参数一览">可配置参数一览<a class="hash-link" href="#可配置参数一览" title="标题的直接链接">​</a></h2><p><code>ApiBoot Swagger</code>之所以可以只需要一个注解就可以实现<code>Swagger2</code>的集成，其中难免有很多的配置参数在做支持，了解每一个配置参数的作用，我们才能进行心应手的自定义调整。</p><table><thead><tr><th>参数名</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>api.boot.swagger.enable</td><td>true</td><td>是否启用文档</td></tr><tr><td>api.boot.swagger.title</td><td>ApiBoot快速集成Swagger文档</td><td>文档标题</td></tr><tr><td>api.boot.swagger.description</td><td>-</td><td>文档描述</td></tr><tr><td>api.boot.swagger.base-package</td><td>SpringBoot默认package，详见<code>AutoConfigurationPackages</code></td><td>生成文档的基础package</td></tr><tr><td>api.boot.swagger.version</td><td>ApiBoot的版本号</td><td>文档版本号</td></tr><tr><td>api.boot.swagger.authorization.name</td><td></td><td>授权名称</td></tr><tr><td>api.boot.swagger.authorization.key-name</td><td>Authorization</td><td>整合Oauth2后AccessToken在Header内的Name</td></tr></tbody></table><hr><p>上面是常用的参数，更多配置参数详见官方文档：<a href="https://apiboot.minbox.org/docs/components/api-boot-swagger.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org/docs/components/api-boot-swagger.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建示例项目">创建示例项目<a class="hash-link" href="#创建示例项目" title="标题的直接链接">​</a></h2><p>我们先来创建一个<code>SpringBoot</code>应用程序，在项目的<code>pom.xml</code>文件内添加<code>ApiBoot</code>的相关依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-swagger</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.1.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用apiboot-swagger">启用ApiBoot Swagger<a class="hash-link" href="#启用apiboot-swagger" title="标题的直接链接">​</a></h3><p>通过<code>@EnableApiBootSwagger</code>注解来启用<code>ApiBoot Swagger</code>，该注解可以配置在<code>XxxApplication</code>入口类上，也可以配置在被<code>@Configuration</code>注解修饰的配置类上。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableApiBootSwagger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootSwaggerDescribeTheInterfaceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootSwaggerDescribeTheInterfaceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改默认配置">修改默认配置<a class="hash-link" href="#修改默认配置" title="标题的直接链接">​</a></h3><p><code>ApiBoot Swagger</code>所提供的<strong>配置参数</strong>都可以在<code>application.yml</code>文件内进行设置或修改默认值，下面是修改了<code>版本号</code>、<code>标题</code>的配置：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ApiBoot相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">swagger</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置文档标题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">title</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 接口文档</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置文档版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">version</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> v1.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试控制器">测试控制器<a class="hash-link" href="#测试控制器" title="标题的直接链接">​</a></h3><p>为了方便演示<code>Swagger</code>文档的强大之处，我们来创建一个测试的控制器，使用<code>Swagger</code>提供的注解来描述测试接口，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 示例控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/user"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Api</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">tags </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"用户控制器"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 示例：</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 根据用户名查询用户基本信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param name {@link UserResponse#getName()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link UserResponse}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/{name}"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@ApiOperation</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"查询用户信息"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> response </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserResponse</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@ApiResponse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">code </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> message </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"success"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> response </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserResponse</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserResponse</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getUser</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@PathVariable</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"name"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserResponse</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">25</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 响应实体示例</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@ApiModel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@AllArgsConstructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@NoArgsConstructor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserResponse</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#8dc891">@ApiModelProperty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"用户名"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#8dc891">@ApiModelProperty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"年龄"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> age</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：<code>ApiBoot Swagger</code>只是针对<code>Swagger</code>进行了封装，实现了快速集成，对内部的注解以及配置不做修改。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>启动本章项目源码，访问：<a href="http://localhost:8080/swagger-ui.html" target="_blank" rel="noopener noreferrer">http://localhost:8080/swagger-ui.html</a> 查看运行效果，如下图所示：</p><p><img loading="lazy" src="/assets/images/apiboot-swagger-describe-the-interface-1-545063c094b7c70a194958469964779b.png" width="2850" height="1364" class="img_ev3q"></p><p>当我们点击 "用户控制器" 时可以展开该<code>Controller</code>内定义的接口列表，每一个接口都提供了 "Try it out"（在线调试）功能。</p><blockquote><p>本章并没有集成<code>OAuth2</code>，在执行在线调试时并不需要配置<code>AccessToken</code>。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Swagger</code>的实现主要归功于<code>SpringBoot</code>自定义<code>Starter</code>，根据配置参数进行条件配置控制对象的实例化，通过<code>@Import</code>来导入<code>Swagger</code>所需要的配置类。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-swagger-describe-the-interface</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Swagger2</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot新特性GlobalLogging详解]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-use-global-log</link>
            <guid>apiboot-logging-use-global-log</guid>
            <pubDate>Tue, 17 Dec 2019 10:12:47 GMT</pubDate>
            <description><![CDATA[全局日志是一个什么概念呢？]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全局日志是一个什么概念呢">全局日志是一个什么概念呢？<a class="hash-link" href="#全局日志是一个什么概念呢" title="标题的直接链接">​</a></h2><p>其实理解起来比较简单，类似于我们平时一直在使用的<code>logback</code>、<code>log4j</code>这种的日志框架的其中一个功能部分，<code>minbox-logging</code>分布式日志框架目前独立于<code>api-boot-plugins</code>，已经加入了<code>minbox-projects</code>开源组织，之前博客有一系列的文章来讲解了<code>ApiBoot Logging</code>（内部是集成的<code>minbox-logging</code>）日志组件的使用以及极简的配置方式，可以访问<a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot 组件系列文章使用汇总</a>了解日志组件的使用详情。</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="什么是全局日志">什么是全局日志？<a class="hash-link" href="#什么是全局日志" title="标题的直接链接">​</a></h2><p>在之前<code>ApiBoot Logging</code>分布式日志组件可以实现<code>日志采集</code>、<code>日志上报</code>、<code>日志统一存储</code>、<code>集成Spring Security</code>、<code>集成Openfeign</code>等功能，随着<code>ApiBoot Logging 2.2.1.RELEASE</code>版本的发布引入了一个新的概念，那就是<code>GlobalLog</code>。</p><p>用过<code>ApiBoot Logging</code>日志组件的同学应该都有了解，它只会记录每一次发送<code>请求</code>相关的一些信息，如：请求参数、请求地址、请求头信息、响应内容等，并没有提供业务代码中的<code>debug</code>、<code>info</code>、<code>error</code>等级日志的采集方式，就不要提上报这种日志到<code>Logging Admin</code>了。</p><p>新版本的发布给我们带来了春天，<code>ApiBoot Logging</code>为了方便代码的调试，执行时业务数据的监控，支持了采集业务代码内的不同等级的日志，而且还支持采集<code>Exception</code>的堆栈信息，方便定位错误，及时纠正。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="了解globallogging接口">了解GlobalLogging接口<a class="hash-link" href="#了解globallogging接口" title="标题的直接链接">​</a></h2><p>为了支持<code>业务全局日志</code>，新版本中引入了<code>GlobalLogging</code>接口，我们先来看看这个接口的源码，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Global log collection interface</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Provide debug, info, and error log collection</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GlobalLogging</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Debug Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param msg log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">debug</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Debug Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param format    Unformatted log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param arguments List of parameters corresponding to log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">debug</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> format</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Object</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Info Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param msg log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Info Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param format    Unformatted log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param arguments List of parameters corresponding to log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> format</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Object</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Error Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param msg log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Error Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param msg       log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param throwable Exception object instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Throwable</span><span class="token plain"> throwable</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Collect Error Level Logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param format    Unformatted log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param arguments List of parameters corresponding to log content</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> format</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Object</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>GlobalLogging</code>接口内提供了三种类型的日志采集方法，分别是：<code>debug</code>、<code>info</code>、<code>error</code>，这个版本只是对日志的等级进行了划分，并没有添加限制或者过滤机制。</p><p><code>GlobalLogging</code>当前版本有一个实现类<code>org.minbox.framework.logging.client.global.support.GlobalLoggingMemoryStorage</code>，该类实现了<code>GlobalLogging</code>内的全部方法，并将采集到的日志保存到了<code>GlobalLoggingThreadLocal</code>，方便统一上报到<code>Logging Admin</code>。</p><p>为了方便后期修改<code>Global Log</code>的存储方式，<code>ApiBoot Logging</code>提供了一个配置参数<code>api.boot.logging.global-logging-storage-away</code>，该配置的默认值为<code>memory</code>，对应<code>GlobalLoggingMemoryStorage</code>实现类。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="globallogging自动化配置">GlobalLogging自动化配置<a class="hash-link" href="#globallogging自动化配置" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging</code>根据<code>api.boot.logging.global-logging-storage-away</code>配置参数，条件判断自动化配置了<code>GlobalLogging</code>接口的实现类，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">minbox</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">framework</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">api</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">boot</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">autoconfigure</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">logging</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * the "minbox-logging" global log storage configuration</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@ConditionalOnClass</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">GlobalLogging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootLoggingGlobalLogStorageAutoConfiguration</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Instance global log memory mode storage</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link GlobalLoggingMemoryStorage}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@ConditionalOnProperty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">prefix </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">API_BOOT_LOGGING_PREFIX</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"global-logging-storage-away"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> havingValue </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"memory"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> matchIfMissing </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GlobalLogging</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">globalLogging</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GlobalLoggingMemoryStorage</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据<code>globalLogging()</code>方法上的条件注入注解<code>@ConditionalOnProperty</code>配置内容可以了解到，当我们在<code>application.yml</code>配置文件内添加<code>api.boot.logging.global-logging-storage-away=memory</code>时或者<code>缺少该配置</code>时，该方法会被调用并且创建一个<code>GlobalLoggingMemoryStorage</code>对象实例，并将该实例对象写入到<code>IOC</code>容器内，这样我们在使用<code>GlobalLogging</code>实例时，只需要注入就可以了，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * {@link GlobalLogging}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * @see org.minbox.framework.logging.client.global.AbstractGlobalLogging</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  * @see org.minbox.framework.logging.client.global.support.GlobalLoggingMemoryStorage</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GlobalLogging</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用globallogging">使用GlobalLogging<a class="hash-link" href="#使用globallogging" title="标题的直接链接">​</a></h2><p>采集的方式很简单，我们只需要注入<code>GlobalLogging</code>对象，使用该接口提供的方法即可，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 测试用户控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/user"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * {@link GlobalLogging}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @see org.minbox.framework.logging.client.global.AbstractGlobalLogging</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @see org.minbox.framework.logging.client.global.support.GlobalLoggingMemoryStorage</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GlobalLogging</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 测试获取用户名</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/name"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getUserName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">debug</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"这是一条debug级别的日志"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"这是一条info级别的日志"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"用户名：恒宇少年"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当我们调用<code>GlobalLogging</code>提供的不同日志等级的方法时，会自动将日志相关信息写入到<code>GlobalLoggingThreadLocal</code>的集合内，等到上报请求日志时一并提交给<code>Logging Admin</code>，由<code>Logging Admin</code>进行保存。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="globallogging表结构">GlobalLogging表结构<a class="hash-link" href="#globallogging表结构" title="标题的直接链接">​</a></h2><p><code>GlobalLogging</code>相关的全局日志采集到<code>Logging Admin</code>需要进行保存，所有对应添加了一个名为<code>logging_global_logs</code>信息表，结构如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_global_logs</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志主键'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_request_log_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求日志编号，关联logging_request_logs主键'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_level</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">20</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志等级'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_content</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mediumtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志内容'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_caller_class</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志输出的类名'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_caller_method</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">50</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志输出的方法名称'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_caller_code_line_number</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志输出的代码行号'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_exception_stack</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mediumtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'error等级的日志异常堆栈信息'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_create_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mediumtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志发生时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_global_logs_logging_request_logs_lrl_id_fk</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_request_log_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">CONSTRAINT</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_global_logs_logging_request_logs_lrl_id_fk</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">FOREIGN</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lgl_request_log_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">REFERENCES</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_request_logs</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ENGINE</span><span class="token operator" style="color:#d7deea">=</span><span class="token keyword" style="color:#c5a5c5">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CHARSET</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">'全局日志信息表'</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="采集exception堆栈信息">采集Exception堆栈信息<a class="hash-link" href="#采集exception堆栈信息" title="标题的直接链接">​</a></h2><p>使用<code>GlobalLogging</code>可以采集遇到异常的详细堆栈信息，可以让我们直接定位到问题出现的位置，在第一时间解决出现的问题，具体使用如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> a </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">/</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Exception</span><span class="token plain"> e</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getMessage</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>我们来运行本章的源码，看下日志采集的效果。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="输出的采集日志">输出的采集日志<a class="hash-link" href="#输出的采集日志" title="标题的直接链接">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1576561372604</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"globalLogs"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerClass"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"org.minbox.chapter.user.service.UserController"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerCodeLineNumber"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">33</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"getUserName"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"content"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"这是一条debug级别的日志，发生时间：{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"createTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1576561372585</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"level"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"debug"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerClass"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"org.minbox.chapter.user.service.UserController"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerCodeLineNumber"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">34</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"getUserName"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"content"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"这是一条info级别的日志，发生时间：1576561372586"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"createTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1576561372586</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"level"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"info"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerClass"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"org.minbox.chapter.user.service.UserController"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerCodeLineNumber"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">43</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"callerMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"aa"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"content"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"出现了异常."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"createTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1576561372586</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"exceptionStack"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"java.lang.ArithmeticException: / by zero\n\tat org.minbox.chapter.user.service.UserController.aa(UserController.java:41)\n\tat org.minbox.chapter.user.service.UserController.getUserName(UserController.java:35)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\t...."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"level"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"error"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:10000"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/user/name"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"用户名：恒宇少年"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"user-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"10000"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"41a0c852-812b-4a2e-aa4a-228b87ce52f6"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1576561372577</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">27</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"42ca9f5a-5977-49cf-909d-a23614a47a6b"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>上面是控制台输出的一个请求日志的详细内容，其中<code>globalLogs</code>字段就是我们采集的全局日志列表。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储的采集日志">存储的采集日志<a class="hash-link" href="#存储的采集日志" title="标题的直接链接">​</a></h3><p>我们来确认下采集日志上报到<code>Logging Admin</code>后是否保存到了<code>logging_global_logs</code>日志表内，如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mysql</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">select</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> logging_global_logs </span><span class="token keyword" style="color:#c5a5c5">order</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">by</span><span class="token plain"> lgl_create_time </span><span class="token keyword" style="color:#c5a5c5">asc</span><span class="token plain">\G</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1.</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">row</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                     lgl_id: </span><span class="token number" style="color:#5a9bcf">112</span><span class="token plain">e36ff</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">e781</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">f11</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">f21</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">2196823</span><span class="token plain">cde38</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">         lgl_request_log_id: f91382e2</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">d79</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">499</span><span class="token plain">e</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">b1df</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4757</span><span class="token plain">c1ffdbc5</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                  lgl_level: info</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                lgl_content: 这是一条info级别的日志，发生时间：</span><span class="token number" style="color:#5a9bcf">1576561856333</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">           lgl_caller_class: org</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">minbox</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">chapter</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UserController</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          lgl_caller_method: getUserName</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">lgl_caller_code_line_number: </span><span class="token number" style="color:#5a9bcf">34</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        lgl_exception_stack: </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            lgl_create_time: </span><span class="token number" style="color:#5a9bcf">1576561856333</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2.</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">row</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                     lgl_id: f1d172a6</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">5</span><span class="token plain">cce</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">df0</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">bc29</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">fe27ac441089</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">         lgl_request_log_id: f91382e2</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">d79</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">499</span><span class="token plain">e</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">b1df</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4757</span><span class="token plain">c1ffdbc5</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                  lgl_level: debug</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                lgl_content: 这是一条debug级别的日志，发生时间：{}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">           lgl_caller_class: org</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">minbox</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">chapter</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UserController</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          lgl_caller_method: getUserName</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">lgl_caller_code_line_number: </span><span class="token number" style="color:#5a9bcf">33</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        lgl_exception_stack: </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            lgl_create_time: </span><span class="token number" style="color:#5a9bcf">1576561856333</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">3.</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">row</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                     lgl_id: d95d850d</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain">bc9</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4689</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">928</span><span class="token plain">a</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">32</span><span class="token plain">c6089ff7a2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">         lgl_request_log_id: f91382e2</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain">d79</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">499</span><span class="token plain">e</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">b1df</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4757</span><span class="token plain">c1ffdbc5</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                  lgl_level: error</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                lgl_content: 出现了异常</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">           lgl_caller_class: org</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">minbox</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">chapter</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UserController</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          lgl_caller_method: getUserName</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">lgl_caller_code_line_number: </span><span class="token number" style="color:#5a9bcf">38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        lgl_exception_stack: java</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">lang</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ArithmeticException: </span><span class="token operator" style="color:#d7deea">/</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">by</span><span class="token plain"> zero</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        at org</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">minbox</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">chapter</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UserController</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">getUserName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">UserController</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">java:</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        at sun</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">reflect</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">NativeMethodAccessorImpl</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">invoke0</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">Native Method</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        at sun</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">reflect</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">NativeMethodAccessorImpl</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">NativeMethodAccessorImpl</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">java:</span><span class="token number" style="color:#5a9bcf">62</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            lgl_create_time: </span><span class="token number" style="color:#5a9bcf">1576561856334</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">rows</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">in</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>这里异常的堆栈信息比较多，做出了省略。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>本章把<code>GlobalLog</code>全局日志的概念进行了详细的描述，建议将一些重要逻辑判断性质的<code>GlobalLog</code>进行采集上报，防止<code>logging_global_logs</code>表内的数据量过大。</p><blockquote><p>详细的使用方式请参考本章的源码。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-use-global-log</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[OAuth2使用Redis来存储客户端信息以及AccessToken]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-oauth-use-redis-storage</link>
            <guid>apiboot-oauth-use-redis-storage</guid>
            <pubDate>Wed, 11 Dec 2019 14:48:54 GMT</pubDate>
            <description><![CDATA[使用Redis来存储OAuth2相关的客户端信息以及生成的AccessToken是一个不错的选择，Redis与生俱来的的高效率、集群部署是比较出色的功能，如果用来作为服务认证中心的数据存储，可以大大的提高响应效率。]]></description>
            <content:encoded><![CDATA[<p>使用<code>Redis</code>来存储<code>OAuth2</code>相关的客户端信息以及生成的<code>AccessToken</code>是一个不错的选择，<code>Redis</code>与生俱来的的高效率、集群部署是比较出色的功能，如果用来作为<code>服务认证中心</code>的数据存储，可以大大的提高响应效率。</p><p><code>Redis</code>还支持超时自动删除功能，<code>OAuth2</code>所生成的<code>AccessToken</code>相关的数据在超过配置的<code>有效时间</code>后就会自动被清除，这样也隐形的提高了接口的安全性。</p><p>既然<code>Redis</code>可以做到这么好，我们该怎么实现代码逻辑呢？</p><p><code>ApiBoot OAuth2</code>是支持使用<code>Redis</code>来存储<code>AccessToken</code>的，只需要修改<code>application.yml</code>一个配置就可以实现，相关的使用也可以通过查看文档了解。</p><ul><li><a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">ApiBoot OAuth 官方文档</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>我们使用<code>IDEA</code>开发工具创建一个<code>SpringBoot</code>项目，在项目的<code>pom.xml</code>添加我们需要的<code>ApiBoot</code>的<code>统一版本</code>依赖以及<code>安全组件</code>依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.0.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加redis支持">添加Redis支持<a class="hash-link" href="#添加redis支持" title="标题的直接链接">​</a></h2><p>既然我们本章需要用到<code>Redis</code>，我们需要在项目内添加相关的依赖，<code>SpringBoot</code>已经为我们提供了封装好的依赖，在<code>pom.xml</code>文件内<code>dependencies</code>节点下添加，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-data-redis</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置redis连接信息">配置Redis连接信息<a class="hash-link" href="#配置redis连接信息" title="标题的直接链接">​</a></h3><p><code>SpringBoot</code>对<code>Redis</code>的连接、数据操作都做了封装，我们只需要在<code>application.yml</code>配置文件内添加响应的<code>Redis</code>连接信息即可。</p><p><code>spring-boot-starter-data-redis</code>依赖所需要的配置都是由<code>RedisProperties</code>类提供，该类内有部分配置字段存在默认值，部分源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@ConfigurationProperties</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">prefix </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"spring.redis"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RedisProperties</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Database index used by the connection factory.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> database </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Connection URL. Overrides host, port, and password. User is ignored. Example:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * redis://user:password@example.com:6379</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> url</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Redis server host.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> host </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"localhost"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Login password of the redis server.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> password</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Redis server port.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> port </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6379</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认配置下连接<code>Redis</code>只需要在<code>application.yml</code>配置<code>spring.redis.password</code>，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 配置Redis连接信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">redis</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><code>password</code>是连接<code>Redis</code>所需要的密码，在<code>redis.conf</code>文件内配置。</p></blockquote><p>相关配置解释：</p><ul><li><code>spring.redis.database</code>：如果你使用的<code>Redis DataBase</code>并不是默认的<code>0</code>索引，需要修改该配置</li><li><code>spring.redis.host</code>：默认为<code>localhost</code>，如果不是本地使用，需要修改该配置</li><li><code>spring.redis.url</code>：这是一个连接字符串，如天配置了会自动覆盖<code>database</code>、<code>host</code>、<code>port</code>等三个配置信息</li><li><code>spring.redis.port</code>：默认为<code>Redis</code>的端口号<code>6379</code>，如已修改<code>Redis</code>的监听端口号，需要修改该配置</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启用apiboot-oauth-redis">启用ApiBoot OAuth Redis<a class="hash-link" href="#启用apiboot-oauth-redis" title="标题的直接链接">​</a></h2><p><code>ApiBoot OAuth</code>提供了<code>redis</code>配置选项，在<code>application.yml</code>文件内通过<code>api.boot.oauth.away</code>配置参数指定，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置内存安全用户列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置使用Redis存储OAuth2相关数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">away</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> redis</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置客户端列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">clients</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> minbox</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> chapter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为了方便演示，我们使用<code>ApiBoot Security</code>的内存方式配置了一个用户<code>yuqiyu</code>，而且还修改了默认<code>client</code>信息，新加了<code>minbox</code>客户端。</p><p>如果对<code>ApiBoot Security</code>用户配置或者<code>ApiBoot OAuth</code>的客户端配置不了解，可以查看官方文档：</p><ul><li><a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">ApiBoot Security</a></li><li><a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">ApiBoot OAuth</a></li></ul><p>或者你可以查看我编写的<code>ApiBoot</code>系列的文章：<a href="https://blog.yuqiyu.com/apiboot-all-articles.html" target="_blank" rel="noopener noreferrer">ApiBoot开源框架各个组件的系列使用文章汇总</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>在运行测试之前我们添加一个名为<code>ApiController</code>的控制器用来测试，代码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 测试Api控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/api"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 测试请求，需携带令牌访问</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/index"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">index</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"this is index"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点查看redis存储的accesstoken">测试点：查看Redis存储的AccessToken<a class="hash-link" href="#测试点查看redis存储的accesstoken" title="标题的直接链接">​</a></h3><p>预计效果是当我们发送获取<code>AccessToken</code>的请求时，会自动将生成的<code>AccessToken</code>存储到<code>Redis</code>。</p><p>下面我们使用<code>CURL</code>命令来尝试获取下<code>AccessToken</code>，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl minbox</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"38a7ee20-2fad-43c5-a349-31e6f0ee0f29"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"f469b1e8-f63c-4be9-8564-2603f8458024"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7199</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面我们使用<code>redis-cli</code>来看下是否已经将<code>AccessToken</code>存储到<code>Redis</code>，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ redis-cli </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#d7deea;font-weight:400">9</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> auth </span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:#d7deea;font-weight:400">9</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> keys *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"uname_to_access:minbox:yuqiyu"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_to_access:f469b1e8-f63c-4be9-8564-2603f8458024"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">3</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"access_to_refresh:1ea8e5cd-ea63-4a73-969f-9e7767f25f30"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">4</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"auth:38a7ee20-2fad-43c5-a349-31e6f0ee0f29"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_auth:6898bef4-f4a7-4fa9-858b-a4c62a1567d8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh:6898bef4-f4a7-4fa9-858b-a4c62a1567d8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_auth:f469b1e8-f63c-4be9-8564-2603f8458024"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"access:38a7ee20-2fad-43c5-a349-31e6f0ee0f29"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_to_access:6898bef4-f4a7-4fa9-858b-a4c62a1567d8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">  </span><span class="token string" style="color:#8dc891">"auth_to_access:f02ceb5faa4577222082842b82a57067"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">  </span><span class="token string" style="color:#8dc891">"refresh:f469b1e8-f63c-4be9-8564-2603f8458024"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">3</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">  </span><span class="token string" style="color:#8dc891">"access_to_refresh:38a7ee20-2fad-43c5-a349-31e6f0ee0f29"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token number" style="color:#5a9bcf">4</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">  </span><span class="token string" style="color:#8dc891">"client_id_to_access:minbox"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>结果往往让人感觉惊喜，看到这里我们已经成功的把<code>OAuth2</code>生成的<code>AccessToken</code>存储到了<code>Redis</code>，如果<code>AccessToken</code>对应的数据超过了<code>expires_in</code>时间，就会自动被清除。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点携带accesstoken访问接口">测试点：携带AccessToken访问接口<a class="hash-link" href="#测试点携带accesstoken访问接口" title="标题的直接链接">​</a></h3><p>我们可以拿着生成的<code>AccessToken</code>来访问在上面添加的测试<code>ApiController</code>内的接口，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> -H </span><span class="token string" style="color:#8dc891">'Authorization: Bearer 38a7ee20-2fad-43c5-a349-31e6f0ee0f29'</span><span class="token plain"> http://localhost:9090/api/index</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">this is index</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以拿到接口的返回的接口，这也证明了一点，<code>AccessToken</code>的验证是没有问题的，<code>OAuth2</code>拿着请求携带的<code>AccessToken</code>去<code>Redis</code>验证通过。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot OAuth</code>所支持的<code>3种</code>存储方式都已经通过文章的方式告知大家，每一种方式都做到了精简，简单的配置，添加相关的依赖，就能够实现在之前让很多人头疼的集成。</p><blockquote><p>如果在生产环境中数据量较大，建议使用<code>Redis</code>集群来解决存储<code>AccessToken</code>的问题。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-oauth-use-redis-storage</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[OAuth2设置AccessToken的过期时间]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-oauth-set-token-expire-time</link>
            <guid>apiboot-oauth-set-token-expire-time</guid>
            <pubDate>Wed, 11 Dec 2019 09:45:07 GMT</pubDate>
            <description><![CDATA[OAuth2所生成的AccessToken以及RefreshToken都存在过期时间，当在有效期内才可以拿来作为会话身份发起请求，否者认证中心会直接拦截无效请求提示已过期，那么我们怎么修改这个过期时间来满足我们的业务场景呢？]]></description>
            <content:encoded><![CDATA[<p><code>OAuth2</code>所生成的<code>AccessToken</code>以及<code>RefreshToken</code>都存在过期时间，当在有效期内才可以拿来作为会话身份发起请求，否者<code>认证中心</code>会直接拦截无效请求提示<code>已过期</code>，那么我们怎么修改这个过期时间来满足我们的业务场景呢？</p><p>目前一线大厂所使用的的<code>AccessToken</code>的有效期一般都是<code>7200秒</code>，也就是<code>2小时</code>，而且有获取的次数限制，所以发起请求的一方必须通过一定的形式保存到本地，以方便下一次发起请求时，写入请求的<code>header</code>或者作为参数携带。</p><p>本章来讲解下使用<code>ApiBoot OAuth</code>组件该怎么去设置<code>AccessToken</code>的过期时间，针对<code>memory</code>(内存方式)、<code>jdbc</code>(数据库)这两种方式来讲解，更多使用请参考官方文档：</p><ul><li>ApiBoot OAuth官方文档：<a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org/docs/components/api-boot-oauth.html</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="默认有效时长">默认有效时长<a class="hash-link" href="#默认有效时长" title="标题的直接链接">​</a></h2><p><code>ApiBoot OAuth</code>在<code>memory</code>存储方式下为每一个<code>客户端</code>都提供了一个默认的<code>AccessToken</code>有效时长，该配置在<code>org.minbox.framework.api.boot.autoconfigure.oauth.ApiBootOauthProperties</code>，相关源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Oauth2 Client</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Used to configure multiple clients</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Client</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> clientId </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"ApiBoot"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client secret</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> clientSecret </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"ApiBootSecret"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client grant types</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "password,refresh_token"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> grantTypes </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"password"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"refresh_token"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 client scope</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "api"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> scopes </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 application resource id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is "api"</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> resourceId </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 access token validity seconds</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * default value is 7200 second</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> accessTokenValiditySeconds </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">7200</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Client</code>是<code>ApiBootOauthProperties</code>的一个内部类，主要是提供了<code>OAuth2 客户端</code>的相关配置字段，通过<code>spring-boot-configuration-processor</code>依赖将该类自动解析成<code>配置元数据</code>，这样我们在<code>application.yml</code>输入<code>api.xxx</code>时可以得到相应的提示。</p><p>在<code>Client</code>内部类中有一个字段<code>accessTokenValiditySeconds</code>，通过该字段我们来修改该客户端下所有用户生成的<code>AccessToken</code>默认过期时长，值得注意的是，这里的配置值时间单位是<code>秒</code>，<code>7200秒 = 2小时</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="内存方式">内存方式<a class="hash-link" href="#内存方式" title="标题的直接链接">​</a></h2><p>在上面说到了，内存方式时<code>ApiBoot OAuth</code>会使用<code>ApiBootOauthProperties#Client</code>内部类的<code>accessTokenValiditySeconds</code>字段来配置过期时间，所以我们只需要在<code>application.yml</code>添加如下配置即可：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">clients</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> minbox</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> chapter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token comment" style="color:#999999"># 配置客户端Token过期时长，单位：秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">accessTokenValiditySeconds</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">43200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在上面配置中，我们添加了一个在内存存储的<code>minbox</code>客户端，设置<code>accessTokenValiditySeconds</code>过期时间字段为<code>43200秒 = 12小时</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="jdbc方式">JDBC方式<a class="hash-link" href="#jdbc方式" title="标题的直接链接">​</a></h2><p><code>JDBC</code>方式是<code>ApiBoot OAuth</code>无法控制的，因为<code>OAuth2</code>当使用<code>JDBC</code>方式进行存储客户端、令牌等信息时，都是通过<code>OAuth2</code>提供的固定的表进行操作，正因为如此我们只需要修改<code>oauth_client_details</code>表内每一条<code>client</code>信息的<code>access_token_validity</code>字段的值即可，时间单位同样也是<code>秒</code>，如下图所示：</p><p><img loading="lazy" src="https://blog.yuqiyu.com/images/post/apiboot-oauth-set-token-expire-time-1.png" class="img_ev3q"></p><p><code>OAuth2</code>提供的<code>MySQL</code>版本的建表语句请访问<a href="https://gitee.com/minbox-projects/api-boot/blob/master/api-boot-project/api-boot-starters/api-boot-starter-security-oauth-jwt/oauth-mysql.sql" target="_blank" rel="noopener noreferrer">ApiBoot OAuth Starter</a>查看。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>下面来测试下修改后的过期时间是否已经生效，我们先来启动本章的项目示例。</p><p>通过<code>CURL</code>的方式获取<code>AccessToken</code>，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl -X POST minbox</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"41127985-1b31-4413-ac9f-30d5e26f4aaf"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0a39ca6a-8697-4f80-9bb1-ac59894a45dd"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">43199</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>PostMan</code>方式获取<code>AccessToken</code>如下图所示：</p><p><img loading="lazy" src="https://blog.yuqiyu.com/images/post/apiboot-oauth-set-token-expire-time-2.png" class="img_ev3q"></p><p>我们根据结果可以看到，由原本默认的<code>7200</code>修改成了我们在<code>application.yml</code>配置的<code>43200</code>（结果中的<code>43199</code>是因为生成token耗时差导致的）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>的宗旨就是化繁为简，能使用配置简单搞定的事情，绝不拖泥带水，赶快分享下本篇文章吧，让更多人得到帮助，非常感谢~~~</p><blockquote><p><code>ApiBoot OAuth</code>可以一次配置多个客户端，并且为每一个客户端配置不同的过期时间。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-oauth-set-token-expire-time</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[还不会使用JWT格式化OAuth2令牌吗？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-security-oauth-use-jwt</link>
            <guid>apiboot-security-oauth-use-jwt</guid>
            <pubDate>Mon, 09 Dec 2019 15:53:47 GMT</pubDate>
            <description><![CDATA[OAuth2默认的AccessToken是由DefaultAccessTokenConverter生成，是具有唯一性的UUID随机字符串，我们如果想要使用JWT来格式化AccessToken就需要使用JwtAccessTokenConverter来进行格式化，当然如果你有自己独特的业务可以自己实现AccessTokenConverter接口，并将实现类交付给IOC托管即可。]]></description>
            <content:encoded><![CDATA[<p><code>OAuth2</code>默认的<code>AccessToken</code>是由<code>DefaultAccessTokenConverter</code>生成，是具有唯一性的<code>UUID</code>随机字符串，我们如果想要使用<code>JWT</code>来格式化<code>AccessToken</code>就需要使用<code>JwtAccessTokenConverter</code>来进行格式化，当然如果你有自己独特的业务可以自己实现<code>AccessTokenConverter</code>接口，并将实现类交付给<code>IOC</code>托管即可。</p><p><code>ApiBoot</code>内部集成了<code>DefaultAccessTokenConverter</code>（默认）、<code>JwtAccessTokenConverter</code>，只需要一个配置就可以实现相互转换。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="相关文档">相关文档<a class="hash-link" href="#相关文档" title="标题的直接链接">​</a></h2><ul><li>ApiBoot OAuth2官方文档：<a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org/docs/components/api-boot-oauth.html</a></li><li>ApiBoot 开源源码：<a href="https://gitee.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">minbox-projects/api-boot</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="jwt加密秘钥">JWT加密秘钥<a class="hash-link" href="#jwt加密秘钥" title="标题的直接链接">​</a></h2><p>对<code>JWT</code>了解的同学应该知道，它内部不可逆的部分采用的是<code>RSA</code>加密，在加密过程中需要一个<code>秘钥</code>，在<code>JwtAccessTokenConverter</code>实现类中采用了<strong>6位随机字符串</strong>作为秘钥，相关源码如下：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Helper that translates between JWT encoded token values and OAuth authentication</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * information (in both directions). Also acts as a {@link TokenEnhancer} when tokens are</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * granted.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see TokenEnhancer</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see AccessTokenConverter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author Dave Syer</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author Luke Taylor</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">JwtAccessTokenConverter</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">TokenEnhancer</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">AccessTokenConverter</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">InitializingBean</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> verifierKey </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RandomValueStringGenerator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">generate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Signer</span><span class="token plain"> signer </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MacSigner</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">verifierKey</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> signingKey </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> verifierKey</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这种形式虽然在某一些层面上是唯一的，实在感觉不太严谨，所以<code>ApiBoot</code>添加一个配置，可以自定义这个加密秘钥<code>signingKey</code>字段。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建示例项目">创建示例项目<a class="hash-link" href="#创建示例项目" title="标题的直接链接">​</a></h2><p>为了本章的演示效果，我们使用<code>IDEA</code>来创建一个<code>SpringBoot</code>项目，<code>pom.xml</code>文件内相关的依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.0.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>依赖添加完成后下面我们配置下测试的<code>用户</code>以及<code>客户端信息</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置内存用户">配置内存用户<a class="hash-link" href="#配置内存用户" title="标题的直接链接">​</a></h3><p>我们在获取<code>AccessToken</code>时使用的<code>password</code>授权类型，所以我们需要在<code>application.yml</code>文件内配置<code>登录用户</code>所使用的用户名、密码，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>本章为了演示<code>JWT</code>格式化<code>AccessToken</code>，验证的用户采用内存方式配置，<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">了解详情</a>。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开启jwt转换">开启JWT转换<a class="hash-link" href="#开启jwt转换" title="标题的直接链接">​</a></h3><p><code>ApiBoot OAuth2</code>默认使用<code>DefaultAccessTokenConverter</code>实现类来格式化<code>AccessToken</code>，如果我们想要切换到<code>JwtAccessTokenConverter</code>，需要在<code>application.yml</code>添加一个配置，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 启用JWT，用于格式化AccessToken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">jwt</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">enable</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置加密秘钥">配置加密秘钥<a class="hash-link" href="#配置加密秘钥" title="标题的直接链接">​</a></h3><p>在本文开头说到了<code>JwtAccessTokenConverter</code>实现类内采用的是6位随机字符串的方式来作为<code>RSA</code>加密的秘钥，<code>ApiBoot OAuth2</code>提供了参数配置可以进行自定义，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">jwt</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># 加密秘钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">sign-key</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 恒宇少年</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>秘钥格式不限，如：<code>特殊字符串</code>、<code>汉字</code>、<code>数字</code>、<code>字母</code>....</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>见证奇迹的时刻到了，我们通过<code>IDEA</code>的<code>XxxApplication</code>方式来启动本章项目，尝试使用<code>CURL</code>方式获取<code>AccessToken</code>如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl ApiBoot</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">ApiBootSecret@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiYXBpIl0sInVzZXJfbmFtZSI6Inl1cWl5dSIsInNjb3BlIjpbImFwaSJdLCJleHAiOjE1NzU5NTMwNDgsImF1dGhvcml0aWVzIjpbIlJPTEVfYXBpIl0sImp0aSI6ImQxMDNmNDYwLTk3YzMtNGNiZS05OWM4LWYzZjU2MmRhMDZhOCIsImNsaWVudF9pZCI6IkFwaUJvb3QifQ.HMHRBCIGPZNlkJPCnXaktMWxXEW-5roo7tdQR1JpCyY"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOlsiYXBpIl0sInVzZXJfbmFtZSI6Inl1cWl5dSIsInNjb3BlIjpbImFwaSJdLCJhdGkiOiJkMTAzZjQ2MC05N2MzLTRjYmUtOTljOC1mM2Y1NjJkYTA2YTgiLCJleHAiOjE1Nzg1Mzc4NDgsImF1dGhvcml0aWVzIjpbIlJPTEVfYXBpIl0sImp0aSI6ImY1NDMxZTMzLWE1YzMtNGVmNC1hZDM0LTk1MGQ3ODliYTRiZCIsImNsaWVudF9pZCI6IkFwaUJvb3QifQ.TfJ5vThvaibV2kVo2obHqnYzmYm-GsdtRLoB3RJbkrg"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">6925</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"jti"</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"d103f460-97c3-4cbe-99c8-f3f562da06a8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><code>ApiBoot OAuth</code>有默认的客户端配置信息为<code>ApiBoot</code>、<code>ApiBootSecret</code>，为了方便演示，这里没做修改，如需修改请查看<a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">ApiBoot OAuth文档</a>，如果你感觉控制台打印的<code>json</code>不美观，阅读性太差，可以使用<a href="http://tools.yuqiyu.com/pages/formatter/json.html" target="_blank" rel="noopener noreferrer">在线格式化JSON工具</a>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>使用<code>ApiBoot</code>来格式化<code>OAuth2</code>的<code>AccessToken</code>是不是特别简单？省去了我们自己去创建<code>JwtAccessTokenConverter</code>实例，然后还需要将实例放入<code>IOC</code>繁琐的步骤，更多使用详解敬请期待~~</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-security-oauth-use-jwt</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[原来SpringSecurity整合OAuth2后开放权限拦截路径还能这么玩？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-security-open-paths-without-intercept</link>
            <guid>apiboot-security-open-paths-without-intercept</guid>
            <pubDate>Sat, 07 Dec 2019 09:18:47 GMT</pubDate>
            <description><![CDATA[当我们整合了Spring Security以及OAuth2后发现，有一些业务请求是需要开放的，因为种种原因这时访问者还没有身份标识（比如：用户刚来，还没有注册，需要进行新用户注册，这时注册业务相关的接口都应该是开放的），下面我们来看看ApiBoot是怎么排除路径不进行权限拦截的。]]></description>
            <content:encoded><![CDATA[<p>当我们整合了<code>Spring Security</code>以及<code>OAuth2</code>后发现，有一些业务请求是需要开放的，因为种种原因这时访问者还没有身份标识（<code>比如：用户刚来，还没有注册，需要进行新用户注册，这时注册业务相关的接口都应该是开放的</code>），下面我们来看看<code>ApiBoot</code>是怎么排除路径不进行权限拦截的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="官方相关文档">官方相关文档<a class="hash-link" href="#官方相关文档" title="标题的直接链接">​</a></h2><p>相关<code>ApiBoot Security</code>官方使用文档，请访问 <a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">ApiBoot Security</a>。</p><p>在文档的第<code>4. 默认排除路径</code>部分，我们了解到了<code>ApiBoot Security</code>为了与其他的第三方框架进行集成，在内部已经添加了一些<code>默认的拦截路径</code>，当我们在添加<code>开放路径</code>时会在默认的基础上<strong>增量添加，不会覆盖</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>我们使用<code>IDEA</code>开发工具创建一个<code>SpringBoot</code>项目，在<code>pom.xml</code>内添加相关的依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Security OAuth安全组件--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.0.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="排除路径配置">排除路径配置<a class="hash-link" href="#排除路径配置" title="标题的直接链接">​</a></h3><p><code>ApiBoot Security OAuth</code>安全组件默认拦截配置为<code>/api/**</code>，也就是<code>/api</code>下的全部路径以及子路径都需要认证后才可以访问。</p><p>我们可以通过<code>api.boot.security.auth-prefix</code>参数配置修改<code>保护的路径列表</code>，<code>ApiBoot</code>还提供了另外的一个参数配置<code>api.boot.security.ignoring-urls</code>，用于配置<code>开放的路径列表</code>（开放路径可直接访问，不走权限拦截），支持使用<code>Ant</code>风格，<code>application.yml</code>配置内容如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">security</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">open</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">paths</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">without</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">intercept</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Security安全配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 权限拦截的路径前缀</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">auth-prefix</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> /</span><span class="token important" style="font-weight:400">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 排除不拦截的路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">ignoring-urls</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> /index/</span><span class="token important" style="font-weight:400">**</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们在<code>application.yml</code>文件内配置<code>api.boot.security.ignoring-urls</code>的值为<code>/index/**</code>，这时我们在访问<code>/index</code>、<code>/index/xxx</code>路径时都不会经过权限的拦截，直接可以访问到。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例请求">示例请求<a class="hash-link" href="#示例请求" title="标题的直接链接">​</a></h3><p>我们来创建一个名为<code>IndexController</code>的示例控制器，来验证我们开放的路径是否已经生效了，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 示例：控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/index"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">IndexController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 示例：首页地址</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * /index</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">index</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"this is index page."</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 示例：首页地址子页面</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * /index/sub</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/sub"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">indexSub</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"this is sub index page."</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>application.yml</code>我们配置的开放地址为<code>/index/**</code>，所以<code>IndexController</code>控制器内的两个地址<code>/index</code>、<code>/index/sub</code>都会被开放，不走权限拦截，直接放行。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>我们使用<code>IDEA</code>通过<code>XxxApplication</code>入口类的方式来启动本章项目源码，下面是我们要验证的测试点。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点开放路径">测试点：开放路径<a class="hash-link" href="#测试点开放路径" title="标题的直接链接">​</a></h3><p>我们先来访问下<code>http://localhost:9090/index</code>，效果如下所示：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl http://localhost:9090/index    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">this is index page.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>直接访问<code>/index</code>是可以直接获取接口返回的内容，这也证明了一点，这个地址被开放了，不再被权限拦截。</p><p>在之前说到<code>ApiBoot Security OAuth</code>开放地址支持<code>Ant</code>风格，我们配置的开放地址为<code>/index/**</code>，所以<code>/index/sub</code>这个请求地址也应该已经被开放了，效果如下所示：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl http://localhost:9090/index/sub</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">this is sub index page.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>如果我们修改<code>api.boot.security.ignoring-urls</code>配置为<code>/index</code>，我们在访问<code>/index/sub</code>这个地址时是没有权限的，需要携带有效的<code>AccessToken</code>才可以访问到。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点未开放路径的拦截">测试点：未开放路径的拦截<a class="hash-link" href="#测试点未开放路径的拦截" title="标题的直接链接">​</a></h3><p>下面我们来完成一个比较特殊的测试点，访问一个并没有在后台定义的路径，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl http</span><span class="token operator" style="color:#d7deea">:</span><span class="token comment" style="color:#999999">//localhost:9090/index/11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"error"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"unauthorized"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"error_description"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"Full authentication is required to access this resource"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们并没有添加<code>/index/xx</code>这个请求地址的实现，当访问时同样也会被拦截，这证明了我们发起的请求并没有到达解析请求就已经被权限拦截了。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>除了被开放的路径都需要提供有效的AccessToken才可以访问，无论这个地址是否存在，本章为了示例讲解方便我这里配置的权限拦截根地址为<code>/**</code>，<code>api.boot.security.auth-paths</code>参数源码是一个数组（详见：<code>org.minbox.framework.api.boot.autoconfigure.security.ApiBootSecurityProperties</code>），可以配置多个地址，比如：<code>/user/**</code>、<code>/order/**</code>，<code>api.boot.security.ignoring-urls</code>同样支持数组形式配置多个。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-security-open-paths-without-intercept</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[自定义OAuth2短信登录GrantType]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-define-oauth-grant-type</link>
            <guid>apiboot-define-oauth-grant-type</guid>
            <pubDate>Wed, 04 Dec 2019 09:18:26 GMT</pubDate>
            <description><![CDATA[Spring提供的原生的OAuth2依赖内置了几种比较常用的授权方式：password、authorization-code、clientcredentials、refreshtoken、implicit等，虽然可以满足我们日常的需求，不过针对一些特殊的需求还是捉襟见肘，有点无奈，比如：微信登录、短信登录...，针对这一点ApiBoot通过修改Spring OAuth2依赖的源码，可以根据业务进行自定义添加grantType。]]></description>
            <content:encoded><![CDATA[<p><code>Spring</code>提供的原生的<code>OAuth2</code>依赖内置了几种比较常用的授权方式：<code>password</code>、<code>authorization-code</code>、<code>client_credentials</code>、<code>refresh_token</code>、<code>implicit</code>等，虽然可以满足我们日常的需求，不过针对一些特殊的需求还是捉襟见肘，有点无奈，比如：<code>微信登录</code>、<code>短信登录</code>...，针对这一点<code>ApiBoot</code>通过修改<code>Spring OAuth2</code>依赖的源码，可以根据业务进行自定义添加<code>grantType</code>。</p><ul><li>ApiBoot官方文档：<a href="https://apiboot.minbox.org" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>我们先来使用<code>IDEA</code>创建本章的项目，<code>pom.xml</code>添加的依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">com.zaxxer</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">HikariCP</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-mybatis-enhance</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.0.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ApiBoot MyBatis Enhance</code>使用文档详见<a href="https://apiboot.minbox.org/docs/components/api-boot-mybatis-enhance.html" target="_blank" rel="noopener noreferrer">ApiBoot Mybatis Enhance官网文档</a>。</p><p>本章的源码在<a href="https://blog.yuqiyu.com/apiboot-security-customize-select-user.html" target="_blank" rel="noopener noreferrer">ApiBoot零代码整合Spring Security的JDBC方式获取AccessToken</a>基础上进行修改，将之前章节源码的<code>application.yml</code>、<code>SystemUser</code>、<code>SystemUserEnhanceMppaer</code>、<code>UserService</code>文件复制到本章项目对应的目录内。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="验证码登录逻辑">验证码登录逻辑<a class="hash-link" href="#验证码登录逻辑" title="标题的直接链接">​</a></h2><p>本章来讲下使用<code>ApiBoot</code>怎么完成自定义<code>短信验证码</code>登录的授权方式。</p><p>在短信验证码登录的逻辑中，大致的流程如下所示：</p><ol><li><code>用户在获取验证码时，系统会将验证码保存到数据库内</code></li><li><code>当用户输入验证码后提交登录时，读取验证码并判断有效性后</code></li><li><code>最后获取手机号对应的用户信息完成登录逻辑。</code></li><li><code>返回请求令牌</code></li></ol><p>根据<code>验证码登录</code>的流程来看我们首先需要创建一个<code>验证码数据表</code>，用来保存用户发送的验证码数据，在<code>第3步</code>中需要通过手机号获取对应的用户信息，所以我们还要修改之前章节创建的表结构，添加一列，下面我们开始进行改造。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证码表结构">验证码表结构<a class="hash-link" href="#验证码表结构" title="标题的直接链接">​</a></h3><p>在数据库内创建一个名为<code>phone_code</code>的数据表，并初始化一条验证码数据（模拟已经用户已经发送了验证码），<code>SQL</code>如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">phone_code</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">pc_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'主键自增'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">pc_phone</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'手机号'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">pc_code</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">6</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'验证码内容'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">pc_create_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">timestamp</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'验证码生成时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">pc_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ENGINE</span><span class="token operator" style="color:#d7deea">=</span><span class="token keyword" style="color:#c5a5c5">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">AUTO_INCREMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token number" style="color:#5a9bcf">2</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CHARSET</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">'手机号验证码信息表'</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- 初始化验证码数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">phone_code</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'17111111111'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'123123'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'2019-12-04 03:01:05'</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证码实体">验证码实体<a class="hash-link" href="#验证码实体" title="标题的直接链接">​</a></h3><p>对应<code>phone_code</code>表结构编写一个数据实体，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 手机号验证码信息表</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"phone_code"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCode</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 验证码主键</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"pc_id"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Id</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">generatorType </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">KeyGeneratorTypeEnum</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">AUTO</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 手机号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"pc_phone"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> phone</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 验证码内容</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"pc_code"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> code</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 创建时间</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"pc_create_time"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Timestamp</span><span class="token plain"> createTime</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证码数据接口">验证码数据接口<a class="hash-link" href="#验证码数据接口" title="标题的直接链接">​</a></h3><p>为<code>PhoneCode</code>验证码数据实体添加一个查询的数据接口，实现<code>ApiBoot MyBatis Enhance</code>提供的<code>EnhanceMapper&lt;Entity,ID&gt;</code>接口，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 手机号验证码数据接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCodeEnhanceMapper</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">EnhanceMapper</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">PhoneCode</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">Integer</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 查询手机号验证码信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param phone {@link PhoneCode#getPhone()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param code  {@link PhoneCode#getCode()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link PhoneCode}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">PhoneCode</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">findByPhoneAndCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@Param</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"phone"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> phone</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:#8dc891">@Param</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"code"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> code</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>ApiBoot MyBatis Enhance</code>提供的方法命名规则查询语法，我们可以根据指定的<code>phone</code>、<code>code</code>查询出对应的记录。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="验证码业务逻辑">验证码业务逻辑<a class="hash-link" href="#验证码业务逻辑" title="标题的直接链接">​</a></h3><p>为验证码查询提供一个业务逻辑实现类，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 验证码业务逻辑实现</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCodeService</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 手机号验证码数据接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCodeEnhanceMapper</span><span class="token plain"> mapper</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 查询手机号验证码</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param phone {@link PhoneCode#getPhone()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param code  {@link PhoneCode#getCode()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCode</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">findPhoneCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> phone</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> code</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> mapper</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">findByPhoneAndCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">phone</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> code</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改用户表结构">修改用户表结构<a class="hash-link" href="#修改用户表结构" title="标题的直接链接">​</a></h3><p>我们在<a href="https://blog.yuqiyu.com/apiboot-security-customize-select-user.html" target="_blank" rel="noopener noreferrer">ApiBoot零代码整合Spring Security的JDBC方式获取AccessToken</a>文章内创建的<code>system_user</code>用户表的基础上添加一个字段，如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">table</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">system_user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">add</span><span class="token plain"> su_phone </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">null</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">comment</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'手机号'</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>字段添加后初始化表内<code>yuqiyu</code>这条数据的列值，我在<code>phone_code</code>表内添加的手机号为<code>17111111111</code>，所以我需要更新<code>su_phone</code>字段的值为<code>17111111111</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="了解apibootoauthtokengranter">了解ApiBootOauthTokenGranter<a class="hash-link" href="#了解apibootoauthtokengranter" title="标题的直接链接">​</a></h2><p>基础的代码实现我们都已经准备好了，下面我们来介绍下本章的主角<code>ApiBootOauthTokenGranter</code>接口，该接口为自定义<code>GrantType</code>而生，由<code>ApiBoot OAuth2</code>提供，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Integrates Oauth2 to Realize Custom Authorization to Acquire Token</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author：恒宇少年 - 于起宇</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * DateTime：2019-05-28 09:57</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Blog：http://blog.yuqiyu.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * WebSite：http://www.jianshu.com/u/092df3f77bca</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Gitee：https://gitee.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * GitHub：https://github.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootOauthTokenGranter</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Serializable</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * oauth2 grant type for ApiBoot</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return grant type</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">grantType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * load userDetails by parameter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param parameters parameter map</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return UserDetails</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws ApiBootTokenException</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @see UserDetails</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">loadByParameter</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Map</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">String</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">String</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootTokenException</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>grantType()</code>：该方法的返回值用于告知<code>OAuth2</code>自定义的<code>GrantType</code>是什么，根据自己的业务逻辑而定。</li><li><code>loadByParameter</code>：该方法是自定义<code>GrantType</code>的业务实现，<code>parameters</code>参数内包含了自定义授权请求<code>/oauth/token</code>时所携带的全部参数，如：<code>/oauth/token?grant_type=phone_code&amp;phone=xx&amp;code=xx</code>，会把<code>phone</code>、<code>code</code>参数一并传递给该方法。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实现短信验证码授权方式">实现短信验证码授权方式<a class="hash-link" href="#实现短信验证码授权方式" title="标题的直接链接">​</a></h2><p>下面我们来创建一个名为<code>PhoneCodeGrantType</code>的自定义授权类，实现<code>ApiBootOauthTokenGranter</code>接口，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 手机验证码OAuth2的认证方式实现</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see ApiBootOauthTokenGranter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCodeGrantType</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootOauthTokenGranter</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 手机号验证码方式的授权方式</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">GRANT_TYPE_PHONE_CODE</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"phone_code"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 授权参数：手机号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">PARAM_PHONE</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"phone"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 授权参数：验证码</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">PARAM_CODE</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"code"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 手机号验证码业务逻辑</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PhoneCodeService</span><span class="token plain"> phoneCodeService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 系统用户业务逻辑</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserService</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">grantType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">GRANT_TYPE_PHONE_CODE</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 根据自定义的授权参数进行查询用户信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param parameters</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws ApiBootTokenException</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">loadByParameter</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Map</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">String</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">String</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootTokenException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> phone </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token constant" style="color:#5a9bcf">PARAM_PHONE</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> code </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> parameters</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token constant" style="color:#5a9bcf">PARAM_CODE</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">PhoneCode</span><span class="token plain"> phoneCode </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> phoneCodeService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">findPhoneCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">phone</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> code</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ObjectUtils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">isEmpty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">phoneCode</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootTokenException</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"登录失败，验证码："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> code </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"，已过期."</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> userDetails </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> userService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">findByPhone</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">phone</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ObjectUtils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">isEmpty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">userDetails</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootTokenException</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"用户："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> phone </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"，不存在."</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> userDetails</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>loadByParameter</code>方法内，我们首先获取到了本次登录的手机号（<code>phone</code>）、验证码（<code>code</code>）这两个参数，查询是否存在这条验证码的记录（<code>PS：这里没做验证码过期时间限制，自己的业务请把这块加上</code>），验证码验证通过后查询出手机号对应的用户信息并将用户返回交付给<code>ApiBoot OAuth2</code>框架来完成验证。</p><p>在验证业务逻辑方法内如果出现异常可以直接使用<code>ApiBootTokenException</code>异常进行抛出。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>将我们的项目运行起来，下面通过<code>CURL</code>的方式尝试获取<code>AccessToken</code>，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl -X POST hengboy</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=phone_code&amp;phone=</span><span class="token number" style="color:#5a9bcf">17111111111</span><span class="token plain">&amp;code=</span><span class="token number" style="color:#5a9bcf">123123</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"30e3f7d0-8c53-4dfe-b1ff-523a1db7b9eb"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"4b1f0ad5-f869-46ca-8b45-0231e69316b3"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7194</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用<code>postman</code>方式获取<code>AccessToken</code>，如下图所示：</p><p><img loading="lazy" src="/assets/images/apiboot-define-oauth-grant-type-1-826c28a616386f5d70017532a26cfad5.png" width="2252" height="1200" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>本章根据<code>短信验证码登录</code>的例子来给大家讲解了使用<code>ApiBoot OAuth2</code>怎么进行自定义授权方式来获取<code>AccessToken</code>，例子讲解注重点是在自定义<code>GrantType</code>，在生产使用时还请根据各种情况进行验证，保证数据的安全性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-define-oauth-grant-type</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[见过这么简单的方式整合SpringSecurity & OAuth2的自定义查询用户吗？]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-security-oauth-custom-certification-user</link>
            <guid>apiboot-security-oauth-custom-certification-user</guid>
            <pubDate>Mon, 02 Dec 2019 14:51:51 GMT</pubDate>
            <description><![CDATA[SpringSecurity整合OAuth2是开发者公认的资源保护、服务认证的最佳搭配伙伴，这对好基友一直在默默的守护着应用服务的安全，根据访问者的不同角色可以颗粒度控制到具体的接口，从而实现权限的细微划分。]]></description>
            <content:encoded><![CDATA[<p><code>SpringSecurity</code>整合<code>OAuth2</code>是开发者公认的<code>资源保护</code>、<code>服务认证</code>的最佳搭配伙伴，这对好基友一直在默默的守护着应用服务的安全，根据访问者的不同角色可以颗粒度控制到具体的接口，从而实现权限的细微划分。</p><p>而<code>SpringSecurity</code>框架在安全框架的队伍中算是入门比较高的，虽然<code>Spring</code>通过<code>SpringBoot</code>进行了封装，但是使用起来还是有很多容易遗漏的配置，因为配置比较多，让初学者理解起来也比较困难，针对这个问题<code>ApiBoot</code>对<code>SpringSecurity</code>以及<code>OAuth2</code>进行了封装，在基础上极大的简化了配置（只做简化、增强，<code>SpringSecurity</code>的基础语法、配置还可以正常使用）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apiboot-security-系列文章">ApiBoot Security 系列文章<a class="hash-link" href="#apiboot-security-系列文章" title="标题的直接链接">​</a></h2><ul><li><a href="https://blog.yuqiyu.com/apiboot-security-oauth-zero-code-integration.html" target="_blank" rel="noopener noreferrer">ApiBoot实现零代码整合Spring Security &amp; OAuth2</a></li><li><a href="https://blog.yuqiyu.com/apiboot-security-customize-select-user.html" target="_blank" rel="noopener noreferrer">ApiBoot零代码整合Spring Security的JDBC方式获取AccessToken</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>使用<code>IDEA</code>开发工具创建一个<code>SpringBoot</code>项目。</p><blockquote><p><code>ApiBoot</code>的底层是<code>SpringBoot</code>，而且<code>ApiBoot</code>为了支持<code>SpringBoot</code>的<code>2.2.x</code>分支，也对应的创建了<code>2.2.x</code>分支版本。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot统一依赖">添加ApiBoot统一依赖<a class="hash-link" href="#添加apiboot统一依赖" title="标题的直接链接">​</a></h3><p>创建完项目后我们需要在<code>pom.xml</code>添加<code>ApiBoot</code>的统一版本依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.2.0.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加相关依赖">添加相关依赖<a class="hash-link" href="#添加相关依赖" title="标题的直接链接">​</a></h3><p>本章我们需要查询数据库内的用户信息进行认证，所以需要在<code>pom.xml</code>添加数据库相关的依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">com.zaxxer</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">HikariCP</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-mybatis-enhance</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在本章使用到了<code>ApiBoot Mybatis Enhance</code>，具体的使用请访问官方文档<a href="https://apiboot.minbox.org/docs/components/api-boot-mybatis-enhance.html" target="_blank" rel="noopener noreferrer">ApiBoot MyBatis Enhance使用文档</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置数据源">配置数据源<a class="hash-link" href="#配置数据源" title="标题的直接链接">​</a></h3><p>添加数据库相关的依赖后，在<code>application.yml</code>文件内添加如下配置信息：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">security</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">oauth</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">custom</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">certification</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 数据源配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">datasource</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.zaxxer.hikari.HikariDataSource</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">3306/test</span><span class="token punctuation" style="color:#8dc891">?</span><span class="token plain">characterEncoding=utf8</span><span class="token important" style="font-weight:400">&amp;serverTimezone=Asia/Shanghai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">driver-class-name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置apiboot-security">配置ApiBoot Security<a class="hash-link" href="#配置apiboot-security" title="标题的直接链接">​</a></h3><p><code>ApiBoot Security</code>默认采用的是<code>内存方式</code>（memory）读取用户信息，我们本章需要修改为<code>JDBC</code>方式，并且<code>禁用默认读取用户信息</code>（<code>ApiBoot Security</code>内部提供了默认的表结构，建表后添加数据即可直接使用用户信息进行认证，详见：<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">ApiBoot Security使用文档</a>）。</p><p>在<code>application.yml</code>配置文件中添加如下配置：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ApiBoot配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># ApiBoot Security 使用JDBC方式读取用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">away</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 禁用默认的读取用户方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">enable-default-store-delegate</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>api.boot.security.enable-default-store-delegate</code>配置参数默认值为<code>true</code>，也就是会自动读取数据源对应数据库内的<code>api_boot_user_info</code>用户信息表，当我们设置为<code>false</code>后需要通过实现<code>ApiBootStoreDelegate</code>接口来进行自定义查询的用户信息。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置apiboot-oauth">配置ApiBoot OAuth<a class="hash-link" href="#配置apiboot-oauth" title="标题的直接链接">​</a></h3><p><code>api-boot-starter-security-oauth-jwt</code>这个依赖内部也默认集成了<code>OAuth2</code>，而且默认的数据存储方式与<code>Spring Security</code>一致也是内存方式（<code>memory</code>），我们本章的主要目的是查询<code>认证用户信息</code>，而不是<code>客户端信息</code>，所以我们还是采用默认的内存方式，不过修改下客户端的默认配置信息，在<code>application.yml</code>文件内添加配置如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ApiBoot配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">oauth</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># ApiBoot OAuth2的客户端列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">clients</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">clientId</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">clientSecret</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> chapter</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">grantTypes</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> password</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain">refresh_token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>在<code>ApiBoot</code>中<code>OAuth2</code>默认的客户端配置信息，可以通过查看<code>org.minbox.framework.api.boot.autoconfigure.oauth.ApiBootOauthProperties.Client</code>源码了解详情。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="用户认证">用户认证<a class="hash-link" href="#用户认证" title="标题的直接链接">​</a></h2><p>配置已经完成，下面我们来编写查询用户信息，将用户信息交给<code>ApiBoot Security</code>框架进行<code>认证</code>、<code>生成AccessToken</code>等操作。</p><p>本章使用的持久化框架是<code>ApiBoot MyBatis Enhance</code>，具体的使用方法请查看<a href="https://apiboot.minbox.org/docs/components/api-boot-mybatis-enhance.html" target="_blank" rel="noopener noreferrer">官方文档</a>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建用户表">创建用户表<a class="hash-link" href="#创建用户表" title="标题的直接链接">​</a></h3><p>我们在数据库内创建一张名为<code>system_user</code>的系统用户信息表，表结构如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">system_user</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'用户编号'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_login_name</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">30</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'登录名'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_nick_name</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">30</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'昵称'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_password</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'用户密码'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_create_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">timestamp</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'创建时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_status</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'1'</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'用户状态，1：正常，0：冻结，-1：已删除'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">su_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ENGINE</span><span class="token operator" style="color:#d7deea">=</span><span class="token keyword" style="color:#c5a5c5">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CHARSET</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">'系统用户信息表'</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>system_user</code>用户表创建完成后，我们往这张表内添加一条用户数据，如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">system_user</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">'9b69fd26-14db-11ea-b743-dcd28627348e'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'yuqiyu'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'恒宇少年 - 于起宇'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'$2a$10$RbJGpi.v3PwkjrYENzOzTuMxazuanX3Qa2hwI/f55cYsZhFT/nX3.'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'2019-12-02 08:13:22'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们在登录时用户名对应<code>su_login_name</code>字段，而密码则是对应<code>su_password</code>字段，<code>yuqiyu</code>这个用户的密码初始化为<code>123456</code>，密码的格式必须为<code>BCryptPasswordEncoder</code>加密后的密文。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建用户实体">创建用户实体<a class="hash-link" href="#创建用户实体" title="标题的直接链接">​</a></h3><p>针对<code>system_user</code>表我们需要来创建一个<code>ApiBoot MyBatis Enhance</code>使用的实体，创建一个名为<code>SystemUser</code>的实体如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 系统用户基本信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"system_user"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">SystemUser</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 用户编号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Id</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">generatorType </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">KeyGeneratorTypeEnum</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">UUID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_id"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 登录名</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_login_name"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> loginName</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 昵称</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_nick_name"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> nickName</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 密码</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_password"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> password</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 创建时间</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_create_time"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> createTime</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 用户状态</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 1：正常，0：已冻结，-1：已删除</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Column</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"su_status"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> status</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Collection</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics operator" style="color:#d7deea">?</span><span class="token generics"> </span><span class="token generics keyword" style="color:#c5a5c5">extends</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">GrantedAuthority</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getAuthorities</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Collections</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">EMPTY_LIST</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getUsername</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">loginName</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getPassword</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">password</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * UserDetails提供的方法，用户是否未过期</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 可根据自己用户数据表内的字段进行扩展，这里为了演示配置为true</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">boolean</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">isAccountNonExpired</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * UserDetails提供的方法，用户是否未锁定</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 可根据自己用户数据表内的字段进行扩展，这里为了演示配置为true</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">boolean</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">isAccountNonLocked</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * UserDetails提供的方法，凭证是否未过期</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 可根据自己用户数据表内的字段进行扩展，这里为了演示配置为true</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">boolean</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">isCredentialsNonExpired</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">true</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * UserDetails提供的方法，是否启用</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">boolean</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">isEnabled</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">status </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体的注解使用详见<code>ApiBoot MyBatis Enhance</code>文档，这里还一点需要注意的是，<code>SystemUser</code>实现了<code>UserDetails</code>接口，如果使用过<code>Spring Security</code>的同学应该都知道这是<code>Spring Security</code>提供的用户详情接口定义，我们如果<code>自定义查询用户</code>就应该让我们<code>自定义的用户实体</code>（注：这是的自定义用户实体也就是SystemUser实体）实现这个接口并全部实现<code>UserDetails</code>接口内提供的方法。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建用户数据接口">创建用户数据接口<a class="hash-link" href="#创建用户数据接口" title="标题的直接链接">​</a></h3><p>用户的实体已经创建完成，我们本章需要一个根据用户的<code>登录名</code>来查询用户基本的数据接口，创建一个名为<code>SystemUserEnhanceMapper</code>的接口如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Enhance提供的增强Mapper</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 自动被扫描并且注册到IOC</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see org.minbox.framework.api.boot.autoconfigure.enhance.ApiBootMyBatisEnhanceAutoConfiguration</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">SystemUserEnhanceMapper</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">EnhanceMapper</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">SystemUser</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">Integer</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 根据用户登录名查询用户信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param loginName {@link SystemUser#getLoginName()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link SystemUser}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">SystemUser</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">findByLoginName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@Param</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"loginName"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> loginName</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该接口继承了<code>EnhanceMapper&lt;Entity,ID&gt;</code>接口，可以自动被扫描到<code>创建代理的实例</code>后并且加入<code>IOC</code>，这样我们在项目其他的地方可以直接注入使用。</p><blockquote><p>注意：<code>findByXxx</code>方法是<code>ApiBoot MyBatis Enhance</code>提供的方法命名规则查询，多个查询条件可以使用<code>And</code>或者<code>Or</code>追加，会自动根据方法的规则生成对应的<code>SQL</code>。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实现apibootstoredelegate接口">实现ApiBootStoreDelegate接口<a class="hash-link" href="#实现apibootstoredelegate接口" title="标题的直接链接">​</a></h3><p><code>ApiBoot Security</code>提供了一个接口<code>ApiBootStoreDelegate</code>，这个接口主要是用来查询登录用户的具体信息的作用，当我们通过<code>grant_type=password&amp;username=xxx</code>的方式进行获取<code>AccessToken</code>时，<code>ApiBoot Security</code>会直接把<code>username</code>的参数值传递给<code>ApiBootStoreDelegate#loadUserByUsername</code>的方法内，这样我们就可以根据<code>username</code>进行查询用户并返回给<code>ApiBoot Security</code>做后续的认证操作。</p><p>我们来创建一个名为<code>UserService</code>的类并实现<code>ApiBootStoreDelegate</code>接口，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 自定义读取用户信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserService</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApiBootStoreDelegate</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">UserService</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 用户数据接口</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">SystemUserEnhanceMapper</span><span class="token plain"> mapper</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">loadUserByUsername</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> username</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UsernameNotFoundException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">UserDetails</span><span class="token plain"> userDetails </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> mapper</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">findByLoginName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">username</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ObjectUtils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">isEmpty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">userDetails</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UsernameNotFoundException</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"用户："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> username </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"，不存在."</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"登录用户的信息：{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">JSON</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">toJSONString</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">userDetails</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> userDetails</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>loadUserByUsername</code>方法的返回值是<code>UserDetails</code>接口类型，在之前我们已经将<code>SystemUser</code>实现了该接口，所以我们可以直接将<code>SystemUser</code>实例作为返回值。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>代码一切就绪，通过<code>XxxxApplication</code>的方式来启动项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点获取accesstoken">测试点：获取AccessToken<a class="hash-link" href="#测试点获取accesstoken" title="标题的直接链接">​</a></h3><p>在获取<code>AccessToken</code>之前，我们需要确认<code>application.yml</code>文件内配置的<code>api.boot.oauth.clients</code>的客户端的<code>clientId</code>、<code>clientSecret</code>配置内容，下面是通过<code>CURL</code>的方式：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl hengboy</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=password&amp;username=yuqiyu&amp;password=</span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"3beb1bee-9ca6-45e1-9fb8-5fc181670f63"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"d2243e18-8ab3-4842-a98f-ebd79da94e2e"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7199</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点刷新accesstoken">测试点：刷新AccessToken<a class="hash-link" href="#测试点刷新accesstoken" title="标题的直接链接">​</a></h3><p>复制上面获取到的<code>refresh_token</code>的值进行刷新，下面是刷新<code>AccessToken</code>的<code>CURL</code>方式：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl hengboy</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">chapter@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token -d 'grant_type=refresh_token&amp;refresh_token=d2243e18-8ab3</span><span class="token number" style="color:#5a9bcf">-4842</span><span class="token plain">-a98f-ebd79da94e2e'</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"e842c2ee-5672-49db-a530-329186f36492"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"d2243e18-8ab3-4842-a98f-ebd79da94e2e"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">7199</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><code>hengboy</code>这个<code>OAuth2</code>客户端在<code>application.yml</code>中通过配置<code>grantTypes</code>授权了两种<code>grant_type</code>，分别是<code>password</code>、<code>refresh_token</code>，如果需要别的方式可以在配置文件内对应添加。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot</code>整合<code>Spring Security</code>以及<code>OAuth2</code>后读取自定义用户信息，我们只需要关注具体怎么读取用户信息，之前那些懵懵懂懂的代码配置都可以通过<code>配置文件</code>的方式<strong>代替</strong>，本章的主要内容是<code>ApiBootStoreDelegate</code>这个接口，<code>ApiBoot</code>所提供的功能还不止这些，会陆续分享给大家。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-security-oauth-custom-certification-user</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot零代码整合Spring Security的JDBC方式获取AccessToken]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-security-customize-select-user</link>
            <guid>apiboot-security-customize-select-user</guid>
            <pubDate>Fri, 29 Nov 2019 12:34:41 GMT</pubDate>
            <description><![CDATA[ApiBoot Security内部提供了两种方式进行读取需要认证的用户信息，在之前的文章中讲到过ApiBoot Security使用内存方式（memory）不写一行代码就可以实现用户的认证并获取AccessToken，那我们使用JDBC方式是不是也是这么的简单呢？]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Security</code>内部提供了<strong>两种方式</strong>进行读取需要认证的用户信息，在之前的文章中讲到过<code>ApiBoot Security</code>使用<code>内存方式（memory）</code><strong>不写一行代码</strong>就可以实现用户的认证并获取<code>AccessToken</code>，那我们使用<code>JDBC</code>方式是不是也是这么的简单呢？</p><p>如果你还对<code>ApiBoot</code>不了解，可以通过以下的途径来获取帮助。</p><ul><li>官方文档：<a href="https://apiboot.minbox.org/zh-cn/index.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org</a></li><li>源码：<a href="https://gitee.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apiboot-security的认证方式">ApiBoot Security的认证方式<a class="hash-link" href="#apiboot-security的认证方式" title="标题的直接链接">​</a></h2><p>有一些同学可能对<code>ApiBoot Security</code>的两种认证方式还不太了解，下面介绍下这两种认证方式的区别。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="内存方式">内存方式<a class="hash-link" href="#内存方式" title="标题的直接链接">​</a></h3><p><code>内存方式（memory）</code>是将用户信息（用户名、密码、角色列表）在<code>application.yml</code>文件内配置，可配置多个用户，项目启动后将用户信息加载到内存中，用于获取<code>AccessToken</code>时的认证。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据库方式">数据库方式<a class="hash-link" href="#数据库方式" title="标题的直接链接">​</a></h3><p><code>数据库方式（jdbc）</code>是将用户信息保存到数据库内，<code>ApiBoot Security</code>定义了一个默认表结构的<code>用户信息数据表</code>，我们可以从官网找到<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">建表语句</a>直接在自己的数据库内创建即可，当然如果不使用默认的表结构可以进行自定义读取用户信息。</p><blockquote><p>注意：在数据库内存放用户的<code>密码</code>必须是通过<code>BCryptPasswordEncoder</code>加密后的密文字符串。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>对<code>ApiBoot Security</code>的两种认证方式概念明白后，我们开始说下怎么才能使用<code>JDBC</code>方式进行用户认证，我们先来使用<code>IDEA</code>开发工具创建一个<code>SpringBoot</code>项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot统一版本">添加ApiBoot统一版本<a class="hash-link" href="#添加apiboot统一版本" title="标题的直接链接">​</a></h3><p>在使用<code>ApiBoot</code>内提供的组件依赖时，首先我们需要在<code>pom.xml</code>文件内添加<code>ApiBoot统一版本</code>，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot版本号--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">apiboot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.5.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">apiboot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${apiboot.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot-security依赖">添加ApiBoot Security依赖<a class="hash-link" href="#添加apiboot-security依赖" title="标题的直接链接">​</a></h3><p>在项目<code>pom.xml</code>文件添加<code>ApiBoot Security</code>依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--ApiBoot Security OAuth--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加jdbc相关依赖">添加JDBC相关依赖<a class="hash-link" href="#添加jdbc相关依赖" title="标题的直接链接">​</a></h3><p>我们本章使用<code>MySQL</code>数据库做演示，我们需要添加相关的<code>数据库依赖</code>以及数据库<code>连接池依赖</code>，由于<code>ApiBoot Security</code>读取内置的默认用户表结构使用的是<code>DataSource</code>，所以我们还需要添加一个可以实例化<code>DataSource</code>的依赖，可以选择<code>api-boot-starter-mybatis-enhance</code>或者<code>spring-boot-starter-jdbc</code>，在<code>pom.xml</code>添加依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--MySQL--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--Hikari--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">com.zaxxer</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">HikariCP</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--SpringBoot JDBC--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-jdbc</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：<code>spring-boot-starter-web</code>这个依赖不可少，在<code>ApiBoot AutoConfiguration</code>内需要一些<code>Web</code>的依赖类。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建默认用户表结构">创建默认用户表结构<a class="hash-link" href="#创建默认用户表结构" title="标题的直接链接">​</a></h3><p>本章使用<code>ApiBoot Security</code>提供的默认用户表结构，访问官方文档查看<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">3.3 使用内置表结构的用户</a>，将建表语句在自己数据库内执行创建表信息，创建后添加一条用户信息，如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">api_boot_user_info</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'admin'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'昵称'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'$2a$10$RbJGpi.v3PwkjrYENzOzTuMxazuanX3Qa2hwI/f55cYsZhFT/nX3.'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'N'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'Y'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'O'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">'2019-11-29 06:14:44'</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置数据源">配置数据源<a class="hash-link" href="#配置数据源" title="标题的直接链接">​</a></h3><p>依赖添加完成后我们在<code>application.yml</code>配置文件内进行配置数据源，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">security</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">customize</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">select</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 数据源配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">datasource</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.zaxxer.hikari.HikariDataSource</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">3306/test</span><span class="token punctuation" style="color:#8dc891">?</span><span class="token plain">characterEncoding=utf8</span><span class="token important" style="font-weight:400">&amp;serverTimezone=Asia/Shanghai</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">driver-class-name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置apibootsecurity-jdbc方式">配置ApiBootSecurity JDBC方式<a class="hash-link" href="#配置apibootsecurity-jdbc方式" title="标题的直接链接">​</a></h3><p>由于<code>ApiBoot Security</code>默认使用<code>memory</code>用户认证读取方式，我们需要在<code>application.yml</code>文件内进行修改，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ApiBoot相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># 启用ApiBoot Security 的JDBC方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">away</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>项目配置完成，下面我们通过<code>XxxApplication</code>方式启动项目。</p><p>在获取<code>AccessToken</code>之前我们要知道的一点，<code>ApiBoot Security</code>内部默认集成了<code>OAuth2</code>，而且还默认配置了<code>clientId</code>、<code>clientSecret</code>客户端基本信息，默认值分别是<code>ApiBoot</code>、<code>ApiBootSecret</code>。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">clientId = ApiBoot</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">clientSecret = ApiBootSecret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你对<code>ApiBoot OAuth</code>其他功能有兴趣可以查看<a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">ApiBoot OAuth文档</a>了解详情。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取accesstoken">获取AccessToken<a class="hash-link" href="#获取accesstoken" title="标题的直接链接">​</a></h3><p>由于学习者的本机环境不同，下面采用两种方式进行获取<code>AccessToken</code>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="curl方式">CURL方式<a class="hash-link" href="#curl方式" title="标题的直接链接">​</a></h4><p>执行如下命令获取<code>AccessToken</code>：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ curl -X POST ApiBoot</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain">ApiBootSecret@localhost</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain">/oauth/token\?grant_type\=password\&amp;username\=admin\&amp;password\=</span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"access_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"d9cb97ee-d1bf-42e1-a7a0-c1002df48c52"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"token_type"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"refresh_token"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"db9e9d52-cbe3-4379-a5f2-ffaa34681c01"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"expires_in"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">2884</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"scope"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="postman方式">PostMan方式<a class="hash-link" href="#postman方式" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="/assets/images/apiboot-security-customize-select-user-1-88649a393ac0e635107d82cfa5177cb0.png" width="2270" height="1246" class="img_ev3q"></p><blockquote><p>注意：获取AccessToken的请求方式为<code>POST</code>.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Security</code>不仅<code>内存方式</code>可以实现<strong>零代码</strong>的方式进行集成<code>Spring Security</code>、<code>OAuth2</code>，<code>JDBC</code>方式同样也可以，不过要根据<code>ApiBoot</code>的约定创建用户表。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-security-customize-select-user</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[零代码整合Spring Security & OAuth2]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-security-oauth-zero-code-integration</link>
            <guid>apiboot-security-oauth-zero-code-integration</guid>
            <pubDate>Tue, 12 Nov 2019 00:00:00 GMT</pubDate>
            <description><![CDATA[接口服务的安全性一直是程序员比较注重的一个问题，成熟的安全框架也比较多，其中一个组合就是Spring Security与OAuth2的整合，在ApiBoot内通过代码的封装、自动化配置实现了自动化整合这两大安全框架。]]></description>
            <content:encoded><![CDATA[<p>接口服务的安全性一直是程序员比较注重的一个问题，成熟的安全框架也比较多，其中一个组合就是<code>Spring Security</code>与<code>OAuth2</code>的整合，在<code>ApiBoot</code>内通过代码的封装、自动化配置实现了自动化整合这两大安全框架。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="apiboot-security-oauth简介">ApiBoot Security OAuth简介<a class="hash-link" href="#apiboot-security-oauth简介" title="标题的直接链接">​</a></h2><p><code>ApiBoot Security OAuth</code>是<code>ApiBoot</code>开源项目内的一个组件，内部通过<code>SpringBoot AutoConfiguration</code>整合了<code>Spring Security</code>、<code>OAuth2</code>，而且支持多种存储方式，如：<code>内存（memory）</code>、<code>数据库（jdbc）</code>、<code>Redis</code>等，使用配置文件的方式来<strong>代替</strong>代码侵入式集成方式，提高开发效率、减少非业务的繁琐代码，而且还有这比较高的可扩展性。</p><ul><li><p>ApiBoot 源码（源码详见：api-boot-plugins、api-boot-autoconfigure目录）：<a href="https://gitee.com/minbox-projects/api-boot" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot</a></p></li><li><p>ApiBoot Security使用文档：<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org/docs/components/api-boot-security.html</a></p></li><li><p>ApiBoot OAuth使用文档：<a href="https://apiboot.minbox.org/docs/components/api-boot-oauth.html" target="_blank" rel="noopener noreferrer">https://apiboot.minbox.org/docs/components/api-boot-oauth.html</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建项目">创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">​</a></h2><p>通过<code>Idea</code>开发工具创建一个名为<code>apiboot-security-oauth-zero-code-integration</code>的<code>SpringBoot</code>项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot统一版本依赖">添加ApiBoot统一版本依赖<a class="hash-link" href="#添加apiboot统一版本依赖" title="标题的直接链接">​</a></h3><p>在添加依赖之前我们需要将<code>ApiBoot</code>的统一版本依赖加入到我们项目的<code>pom.xml</code>文件内，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.5.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot-security-oauth依赖">添加ApiBoot Security OAuth依赖<a class="hash-link" href="#添加apiboot-security-oauth依赖" title="标题的直接链接">​</a></h3><p>添加完成版本依赖后，我们继续在<code>pom.xml</code>文件内添加<code>ApiBoot Security OAuth</code>依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Security Oauth--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-security-oauth-jwt</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置apiboot-security用户列表">配置ApiBoot Security用户列表<a class="hash-link" href="#配置apiboot-security用户列表" title="标题的直接链接">​</a></h3><p><code>ApiBoot Security</code>默认支持<code>内存方式（memory）</code>配置<code>用户列表</code>，用于整合<code>OAuth2</code>的<code>密码授权方式（grant_type=password）</code>，我们需要在<code>application.yml</code>配置文件内添加相关配置，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">security</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">oauth</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">first</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">application</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># ApiBoot 相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Security配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置内存用户列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">users</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> yuqiyu</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过<code>api.boot.security.users</code>参数可以配置<code>多个用户</code>信息，每个用户可配置<code>username</code>、<code>password</code>、<code>roles</code>，可以通过查看<code>org.minbox.framework.api.boot.autoconfigure.security.ApiBootSecurityProperties</code>源码类了解详情。</p><ul><li><strong>username</strong>：配置<code>Spring Security</code>用户的用户名。</li><li><strong>password</strong>：配置<code>Spring Security</code>用户的密码。</li><li><strong>roles</strong>：配置<code>Spring Security</code>用户对应授权的角色列表，多个可以使用英文半角<code>,</code>隔开，或者使用<code>-</code>方式配置。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>我们通过<code>XxxApplication</code>方式启动本章项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点获取accesstoken">测试点：获取AccessToken<a class="hash-link" href="#测试点获取accesstoken" title="标题的直接链接">​</a></h3><p>项目运行成功后我们先来测试下是否可以获取到<code>AccessToken</code>。</p><p><strong>Curl方式获取：</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> -X POST ApiBoot:ApiBootSecret@localhost:9090/oauth/token -d </span><span class="token string" style="color:#8dc891">"grant_type=password&amp;username=hengboy&amp;password=123456"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"access_token"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"f16202f7-ab8c-41ae-86be-e314aebe82ff"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"token_type"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"bearer"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"refresh_token"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"93c74812-ec5b-4676-8378-b68e4c1751ae"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"expires_in"</span><span class="token plain">:3297,</span><span class="token string" style="color:#8dc891">"scope"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"api"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>PostMan方式获取：</strong></p><p><img loading="lazy" src="/assets/images/apiboot-security-oauth-zero-code-integration-1-1357178d28d2c64666ef29602e374572.png" width="2260" height="1228" class="img_ev3q"></p><p>如果对<code>Spring Security</code>与<code>OAuth2</code>整合有一定经验的同学应该明白<code>grant_type</code>是<code>OAuth2</code>内提供的其中一种<strong>授权方式</strong>，而参数<code>username</code>、<code>password</code>则是整合后对应的<code>Spring Security</code>的<code>用户名</code>以及<code>密码</code>，也就是我们在<code>application.yml</code>配置文件<code>api.boot.security.users</code>配置用户列表的<strong>其中一个用户信息</strong>。</p><p>在上面分别通过<code>Curl</code>、<code>PostMan</code>两种方式进行测试获取<code>AccessToken</code>，都是可以直接获取到的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点获取当前用户信息">测试点：获取当前用户信息<a class="hash-link" href="#测试点获取当前用户信息" title="标题的直接链接">​</a></h3><p><code>ApiBoot Security OAuth</code>获取<strong>当前用户</strong>信息的方式与<code>Spring Security</code>一样，通过注入<code>java.security.Principal</code>接口来完成，下面我们创建一个名为<code>UserController</code>的控制器来测试下效果：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">minbox</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">chapter</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">apiboot</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">security</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">oauth</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">first</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">application</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">security</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">access</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">prepost</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">PreAuthorize</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">GetMapping</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">RequestMapping</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">RestController</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">java</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">security</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">Principal</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 登录用户信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/api/user"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 获取当前登录的用户信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 通过Spring Security提供的注解{@link PreAuthorize}进行验证角色</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param principal {@link Principal}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link Principal#getName()}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@PreAuthorize</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"hasRole('api')"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Principal</span><span class="token plain"> principal</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> principal</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：<code>ApiBoot Security OAuth</code>默认权限拦截的路径时<code>/api/**</code>，所以我们在测试控制器上配置了<code>/api/user</code>作为路径前缀，如果想对<code>ApiBoot Security OAuth</code>详细了解，请访问ApiBoot官网文档<a href="https://apiboot.minbox.org/docs/components/api-boot-security.html" target="_blank" rel="noopener noreferrer">ApiBoot Security使用文档</a></p></blockquote><p>我们通过<code>Curl</code>方式访问<code>http://localhost:9090/api/user</code>接口效果如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:9090/api/user -H </span><span class="token string" style="color:#8dc891">'Authorization: Bearer d73e86a8-892f-42c1-bc95-04aedfe97828'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">hengboy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问<code>/api/user</code>路径的<code>AccessToken</code>是通过用户<code>hengboy</code>用户生成的，所以该接口返回了<code>hengboy</code>用户名。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Security OAuth</code>极其简单的完成了<code>Spring Security</code>与<code>OAuth2</code>的整合，使用内存方式时不需要配置一行代码就可以完成自动化的整合。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-security-oauth-first-application</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Spring</category>
            <category>Spring Security</category>
            <category>OAuth2</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot Logging Admin可视化界面管理日志]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-admin-visual-interface-management-log</link>
            <guid>apiboot-logging-admin-visual-interface-management-log</guid>
            <pubDate>Thu, 07 Nov 2019 09:16:04 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging Admin支持界面可视化查看请求日志信息，初期版本支持查看上报日志的服务列表、最新的链路日志等功能，还可以整合Spring Security配置用户名、密码]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging Admin</code>支持界面可视化查看请求日志信息，初期版本支持查看上报日志的<code>服务列表</code>、<code>最新的链路日志</code>等功能，还可以整合<code>Spring Security</code>配置用户名、密码</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建logging-admin项目">创建Logging Admin项目<a class="hash-link" href="#创建logging-admin项目" title="标题的直接链接">​</a></h2><p>我们需要创建一个<code>SpringBoot</code>项目，并添加<code>ApiBoot Logging Admin</code>相关的依赖以及配置信息。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加依赖">添加依赖<a class="hash-link" href="#添加依赖" title="标题的直接链接">​</a></h3><p>在项目的<code>pom.xml</code>配置文件内添加如下依赖：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Spring Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--MySQL--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">runtime</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">com.zaxxer</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">HikariCP</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging Admin--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging-admin</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Mybatis Enhance--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-mybatis-enhance</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">&lt;!--版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.5.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置数据源">配置数据源<a class="hash-link" href="#配置数据源" title="标题的直接链接">​</a></h3><p>我们需要连接到<code>Logging Admin</code>所需要的数据库上，具体的数据库表结构请访问【<a href="https://blog.yuqiyu.com/apiboot-report-logs-by-logging-to-admin.html#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%A5%E5%BF%97%E8%A1%A8%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">将ApiBoot Logging采集的日志上报到Admin</a>】查看.</p><p>修改<code>application.yml</code>配置文件添加相关数据源信息如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># 服务名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 数据源相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">datasource</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">driver-class-name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">3306/test</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.zaxxer.hikari.HikariDataSource</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># 服务端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置日志输出--美化">配置日志输出 &amp; 美化<a class="hash-link" href="#配置日志输出--美化" title="标题的直接链接">​</a></h3><p>修改<code>application.yml</code>配置文件添加<code>ApiBoot Logging Admin</code>相关配置信息，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># Logging Admin相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># 控制台显示采集的日志信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">show-console-report-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># 美化日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="集成spring-security">集成Spring Security<a class="hash-link" href="#集成spring-security" title="标题的直接链接">​</a></h2><p>当我们集成<code>Spring Security</code>时，直接访问 <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a> 就可以查看<code>ApiBoot Logging Admin</code>提供的可视化界面，不过为了安全起见，我们添加<code>Spring Security</code>依赖并对应配置内存用户信息，在<code>pom.xml</code>文件内添加依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--Spring Security--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置安全用户">配置安全用户<a class="hash-link" href="#配置安全用户" title="标题的直接链接">​</a></h3><p><code>spring-boot-starter-security</code>依赖提供了内存方式配置用户信息，在<code>application.yml</code>文件配置用户如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># 服务名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 整合Spring Security，配置内存用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">user</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> admin123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>通过<code>XxxApplication</code>方式启动本章项目。</p><p>在浏览器内访问 <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a> 地址，效果如下所示：</p><p><img loading="lazy" src="/assets/images/apiboot-logging-admin-visual-interface-management-log-1-46727089fc05eaa1a464fdf070d3a439.png" width="2140" height="1030" class="img_ev3q"></p><p>因为<code>Spring Security</code>的安全拦截，会直接跳转到<code>ApiBoot Logging Admin</code>内置的登录页面，输入我们在<code>application.yml</code>配置的<code>用户名</code>、<code>密码</code>即可登录。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="链路日志列表">链路日志列表<a class="hash-link" href="#链路日志列表" title="标题的直接链接">​</a></h3><p>登录成功后会跳转到<code>链路日志</code>列表页面，点击<code>每一行链路日志</code>都可以<code>展开查看详情</code>，效果如下所示：</p><p><img loading="lazy" src="/assets/images/apiboot-logging-admin-visual-interface-management-log-2-7e0ce0e5a6c0dbe8de3acc9d7e3f8418.png" width="2854" height="1386" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="日志服务列表">日志服务列表<a class="hash-link" href="#日志服务列表" title="标题的直接链接">​</a></h3><p><code>日志服务</code>菜单内可以查看每一个服务的基本信息，最后上报的时间以及第一次上报日志的时间，如下图所示：</p><p><img loading="lazy" src="/assets/images/apiboot-logging-admin-visual-interface-management-log-3-d1c24902b5055b3c2fe3daf610ffd5c7.png" width="2848" height="1020" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging Admin</code>目前支持可视化界面查看日志、服务基本信息，功能还在不断丰富，完整度有待提高。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-admin-visual-interface-management-log</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot Logging使用RestTemplate透传链路信息]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-using-resttemplate-transparent-traceid</link>
            <guid>apiboot-logging-using-resttemplate-transparent-traceid</guid>
            <pubDate>Wed, 06 Nov 2019 14:15:57 GMT</pubDate>
            <description><![CDATA[在上一篇文章【{% post_link apiboot-logging-using-openfeign-transparent-traceid %}】中我们详细的讲解了ApiBoot Logging整合SpringCloud通过Openfeign进行透传链路信息，包括traceId（链路编号）、parentSpanId（上级单元编号）等信息。]]></description>
            <content:encoded><![CDATA[<p>在上一篇文章【{% post_link apiboot-logging-using-openfeign-transparent-traceid %}】中我们详细的讲解了<code>ApiBoot Logging</code>整合<code>SpringCloud</code>通过<code>Openfeign</code>进行透传链路信息，包括<code>traceId</code>（链路编号）、<code>parentSpanId</code>（上级单元编号）等信息。
<code>ApiBoot Logging</code>不仅仅可以使用<code>Openfeign</code>传递链路信息，还支持<code>RestTemplate</code>方式，本篇文章来详细的讲解下具体的使用方式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建logging-admin">搭建Logging Admin<a class="hash-link" href="#搭建logging-admin" title="标题的直接链接">​</a></h2><p>我们需要搭建<code>Logging Admin</code>服务，用于接收<code>业务服务</code>上报的请求日志信息，请参考【{% post_link apiboot-report-logs-by-logging-to-admin %}】文章内容.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot统一版本">添加ApiBoot统一版本<a class="hash-link" href="#添加apiboot统一版本" title="标题的直接链接">​</a></h2><p>由于本章采用是<code>Maven 多模块</code>的方式构建源码，所以我们只需要将<code>ApiBoot</code>统一版本的依赖配置在<code>root</code>项目的<code>pom.xml</code>内，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot版本号--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.5.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${api.boot.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下来我们营造本篇文章的<code>模拟场景</code>，<strong>查询用户基本信息时一并查询出用户的账号余额</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建账户服务">创建账户服务<a class="hash-link" href="#创建账户服务" title="标题的直接链接">​</a></h2><p>创建一个名为<code>account-service</code>的<code>SpringBoot</code>项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加相关依赖">添加相关依赖<a class="hash-link" href="#添加相关依赖" title="标题的直接链接">​</a></h3><p>在项目<code>pom.xml</code>配置文件内添加相关依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置上报的logging-admin">配置上报的Logging Admin<a class="hash-link" href="#配置上报的logging-admin" title="标题的直接链接">​</a></h3><p>在<code>application.yml</code>配置文件内添加请求日志上报的<code>Logging Admin</code>地址，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 控制台打印请求日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 美化请求日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># Logging Admin地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">server-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token number" style="color:#5a9bcf">8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：<code>server-address</code>配置参数不需要添加<code>http://</code>前缀</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用logging-client">启用Logging Client<a class="hash-link" href="#启用logging-client" title="标题的直接链接">​</a></h3><p>添加完成依赖后我们通过<code>@EnableLoggingClient</code>注解来启用<code>ApiBoot Logging</code>，在<code>AccountServiceApplication</code>类上添加如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 账户服务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">AccountServiceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">AccountServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">AccountServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"账户"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><code>@EnableLoggingClient</code>注解就实例化部分<code>ApiBoot Logging</code>内部所需要的类，将实例放置到<code>Spring IOC</code>容器内。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询账户余额代码实现">查询账户余额代码实现<a class="hash-link" href="#查询账户余额代码实现" title="标题的直接链接">​</a></h3><p>我们创建一个名为<code>AccountController</code>的控制器来提供查询账户的余额信息，代码实现如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 账户服务实现</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/account"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">AccountController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 示例，内存账户列表</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">HashMap</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">Integer</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">Double</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">ACCOUNTS</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">HashMap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">put</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1233.22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">put</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">69269.22</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 获取指定账户的余额</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param accountId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/{accountId}"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getBalance</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@PathVariable</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"accountId"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> accountId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">ACCOUNTS</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">accountId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>至此我们的账户服务已经编写完成，下面我们来编写<code>用户服务</code>。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建用户服务">创建用户服务<a class="hash-link" href="#创建用户服务" title="标题的直接链接">​</a></h2><p>我们来创建一个名为<code>user-service</code>的<code>SpringBoot</code>项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加相关依赖-1">添加相关依赖<a class="hash-link" href="#添加相关依赖-1" title="标题的直接链接">​</a></h3><p>在项目<code>pom.xml</code>配置文件内添加相关依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置上报的logging-admin-1">配置上报的Logging Admin<a class="hash-link" href="#配置上报的logging-admin-1" title="标题的直接链接">​</a></h3><p>本章我们使用指定<code>Logging Admin</code>地址的方式配置，修改<code>application.yml</code>配置文件如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9091</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 控制台打印请求日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 美化请求日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># Logging Admin地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">server-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token number" style="color:#5a9bcf">8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用logging-client-1">启用Logging Client<a class="hash-link" href="#启用logging-client-1" title="标题的直接链接">​</a></h3><p>添加完依赖后我们需要在<code>XxxApplication</code>入口类上添加<code>@EnableLoggingClient</code>注解来启用<code>ApiBoot Logging</code>，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 用户服务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"用户"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实例化resttemplate对象">实例化RestTemplate对象<a class="hash-link" href="#实例化resttemplate对象" title="标题的直接链接">​</a></h3><p>在<code>user-service</code>需要访问<code>账户服务</code>获取当前用户的余额，所以我们需要在<code>user-service</code>内实例化<code>RestTemplate</code>，这样我们才可以通过<code>RestTemplate</code>访问获取用户账户余额信息，我们直接在<code>UserServiceApplication</code>类内添加实例，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 实例化RestTemplate</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return {@link RestTemplate}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Bean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@ConditionalOnMissingBean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RestTemplate</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">restTemplate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RestTemplate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注解解释：</strong></p><ul><li><code>@ConditionalOnMissingBean</code>：这是<code>SpringBoot</code>条件注入其中的一个注解，表示当<code>IOC</code>容器内不存在<code>RestTemplate</code>类型的实例时才会去执行<code>restTemplate()</code>方法创建对象。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询用户信息代码实现">查询用户信息代码实现<a class="hash-link" href="#查询用户信息代码实现" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 用户基本信息控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/user"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 示例，用户列表</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">HashMap</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">Integer</span><span class="token generics punctuation" style="color:#8dc891">,</span><span class="token generics"> </span><span class="token generics class-name" style="color:#FAC863">User</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">USERS</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">HashMap</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">put</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"恒宇少年"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">put</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"于起宇"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 注入RestTemplate</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RestTemplate</span><span class="token plain"> restTemplate</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 获取用户基本信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param userId 用户编号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/{userId}"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getUserInfo</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@PathVariable</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"userId"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">ResponseEntity</span><span class="token generics punctuation" style="color:#8dc891">&lt;</span><span class="token generics class-name" style="color:#FAC863">Double</span><span class="token generics punctuation" style="color:#8dc891">&gt;</span><span class="token plain"> responseEntity </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> restTemplate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getForEntity</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"http://localhost:9090/account/{accountId}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> balance </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> responseEntity</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getBody</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">User</span><span class="token plain"> user </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">USERS</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">get</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ObjectUtils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">isEmpty</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">RuntimeException</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"用户："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> userId </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"，不存在."</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">setBalance</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">balance</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> user</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> balance</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">this</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们所需要的两个服务都已经编写完成，下面我们来测试<code>RestTemplate</code>是可以透传<code>ApiBoot Logging</code>的链路信息？</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>依次启动<code>logging-admin</code> &gt; <code>user-service</code> &gt; <code>account-service</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点透传链路信息">测试点：透传链路信息<a class="hash-link" href="#测试点透传链路信息" title="标题的直接链接">​</a></h3><p>我们使用<code>curl</code>命令访问<code>user-service</code>提供的地址<code>/user</code>，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:9091/user/1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">"id"</span><span class="token plain">:1,</span><span class="token string" style="color:#8dc891">"name"</span><span class="token builtin class-name" style="color:#FAC863">:</span><span class="token string" style="color:#8dc891">"恒宇少年"</span><span class="token plain">,</span><span class="token string" style="color:#8dc891">"balance"</span><span class="token plain">:1233.22</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面我看来看下<code>logging-admin</code>控制台接收到的请求日志。</p><p><strong>接收user-service请求日志</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【user-service -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573032865311</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:9091"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/user/1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"id\":1,\"name\":\"恒宇少年\",\"balance\":1233.22}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"user-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"9091"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"f8cff018-42d5-481f-98df-c19b7196b3c3"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573032865130</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">181</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"16ad1dd4-beaa-4110-b4b7-fc7d952d9a57"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>接收account-service请求日志</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【account-service -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573032865309</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"parentSpanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"f8cff018-42d5-481f-98df-c19b7196b3c3"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"minbox-logging-x-parent-span-id"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"f8cff018-42d5-481f-98df-c19b7196b3c3"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"minbox-logging-x-trace-id"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"16ad1dd4-beaa-4110-b4b7-fc7d952d9a57"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:9090"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"connection"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"keep-alive"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"application/json, application/*+json"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"Java/1.8.0_211"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/account/1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"1233.22"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"account-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"9090"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"63b18b40-5718-431c-972f-78956ce78380"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573032865307</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"16ad1dd4-beaa-4110-b4b7-fc7d952d9a57"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>当我们访问<code>user-service</code>服务内的<code>/user</code>路径时，因为是第一次访问<code>ApiBoot Logging</code>会主动创建<code>traceId</code>（链路编号）、<code>spanId</code>（单元编号），因为没有<code>上级单元</code>所以<code>parentSpanId</code>为<code>null</code>.</li><li>而通过查看<code>account-service</code>服务上报的请求日志时，可以看到<code>ApiBoot Logging</code>相关的链路信息是通过<code>HttpHeader</code>的方式进行传递的<ul><li><code>minbox-logging-x-trace-id</code> -&gt; <code>链路编号</code></li><li><code>minbox-logging-x-parent-span-id</code> -&gt; <code>上级单元编号</code></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging</code>在内部自动化实现了<code>RestTemplate</code>的拦截器配置，所以我们只需要创建实例就可以，而不需要主动去配置拦截器信息，具体源码请访问<code>org.minbox.framework.logging.client.http.rest.LoggingRestTemplateInterceptor</code>查看。</p><p>不管你一次请求跨度几个服务，都可以将<code>请求入口</code>生成的<code>链路信息</code>进行依次传递，而上下级关系则是根据<code>parentSpanId</code>、<code>spanId</code>进行绑定的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-using-resttemplate-transparent-traceid</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot Logging使用SpringCloud Openfeign透传链路信息]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-using-openfeign-transparent-traceid</link>
            <guid>apiboot-logging-using-openfeign-transparent-traceid</guid>
            <pubDate>Tue, 05 Nov 2019 15:47:14 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging可以无缝整合SpringCloud来采集请求日志，目前支持RestTemplate、Openfeign两种方式，我们本章来讲解下在使用Openfeign完成服务之间请求相互调用的一条链路请求日志是否可以都采集到。]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging</code>可以无缝整合<code>SpringCloud</code>来采集请求日志，目前支持<code>RestTemplate</code>、<code>Openfeign</code>两种方式，我们本章来讲解下在使用<code>Openfeign</code>完成服务之间请求相互调用的一条链路请求日志是否可以都采集到。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建eureka-server">搭建Eureka Server<a class="hash-link" href="#搭建eureka-server" title="标题的直接链接">​</a></h2><p>我们先来搭建一个<code>Eureka Server</code>，请访问【{% post_link eureka-server %}】文章内容查看具体搭建流程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建logging-admin">搭建Logging Admin<a class="hash-link" href="#搭建logging-admin" title="标题的直接链接">​</a></h2><p>我们需要搭建一个<code>Logging Admin</code>用于接收<code>Logging Client</code>上报的请求日志，请访问【<a href="http://localhost:4000/apiboot-logging-integrates-eureka-report-logs.html#%E5%B0%86Logging-Admin%E6%B3%A8%E5%86%8C%E5%88%B0Eureka" target="_blank" rel="noopener noreferrer">ApiBoot Logging整合SpringCloud Eureka负载均衡上报日志</a>】查看具体的搭建流程。</p><p>我们本章来模拟<strong>提交订单</strong>的业务逻辑，涉及到两个服务，分别是：<code>商品服务</code>、<code>订单服务</code>，接下来我们需要来创建这两个服务。</p><p><strong>本章源码采用<code>Maven</code>多模块的形式进行编写，请拉至文章末尾查看下载本章源码。</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot--springcloud统一版本">添加ApiBoot &amp; SpringCloud统一版本<a class="hash-link" href="#添加apiboot--springcloud统一版本" title="标题的直接链接">​</a></h2><p>由于是采用<code>Maven 多模块</code>项目，存在<strong>继承</strong>关系，我们只需要在<code>root</code>模块添加版本依赖即可，其他子模块就可以直接使用，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot版本号--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.5.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringCloud版本号--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">spring.cloud.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">Greenwich.SR3</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">spring.cloud.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${api.boot.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${spring.cloud.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建公共openfeign接口定义">创建公共Openfeign接口定义<a class="hash-link" href="#创建公共openfeign接口定义" title="标题的直接链接">​</a></h2><p>学习过<code>Openfeign</code>的同学应该都知道，<code>Openfeign</code>可以继承实现，我们只需要创建一个公共的<strong>服务接口定义</strong>，在实现该接口的服务进行业务实现，在调用该接口的地方直接注入即可。
下面我们创建一个名为<code>common-openfeign</code>的公共依赖项目，<code>pom.xml</code>添加依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">optional</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">optional</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Openfeign--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">optional</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">true</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">optional</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在提交订单时我们简单模拟需要获取商品的单价，所以在<code>common-openfeign</code>项目内我们要提供一个查询商品单价的服务接口，创建一个名为<code>GoodClient</code>的接口如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">minbox</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">chapter</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">common</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">openfeign</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">cloud</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">openfeign</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">FeignClient</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">GetMapping</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">PathVariable</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">RequestMapping</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 商品服务接口定义</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@FeignClient</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"good-service"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/good"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GoodClient</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 获取商品价格</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param goodId 商品编号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/{goodId}"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getGoodPrice</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@PathVariable</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"goodId"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> goodId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注解解释：</strong></p><ul><li><code>@FeignClient</code>：<code>SpringCloud Openfeign</code>提供的接口客户端定义注解，通过<code>value</code>或者<code>name</code>来指定<code>GoodClient</code>访问的具体<code>ServiceID</code>，这里我们配置的<code>value</code>值为<code>good-service</code>项目<code>spring.application.name</code>配置参数（<code>ServiceID</code> = <code>spring.application.name</code>）。</li></ul><blockquote><p>这样当我们通过注入<code>GoodClient</code>接口调用<code>getGoodPrice</code>方法时，底层通过<code>Openfeign</code>的<code>Http</code>代理访问<code>good-service</code>的对应接口。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建商品服务">创建商品服务<a class="hash-link" href="#创建商品服务" title="标题的直接链接">​</a></h2><p>下面我们再来创建一个名为<code>good-service</code>的<code>SpringBoot</code>项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加相关依赖">添加相关依赖<a class="hash-link" href="#添加相关依赖" title="标题的直接链接">​</a></h3><p>在<code>pom.xml</code>项目配置文件内添加如下依赖：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Eureka Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--公共Openfeign接口定义依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.chapter</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">common-openfeign</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">0.0.1-SNAPSHOT</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到我们在<code>good-service</code>项目依赖内添加了我们在上面创建的<code>common-openfeign</code>依赖模块，因为<code>GoodClient</code>服务接口的实现是在<code>good-service</code>项目内，我们需要添加<code>common-openfeign</code>依赖后创建对应的<code>XxxController</code>并实现<code>GoodClient</code>接口完成对应的业务逻辑实现。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="商品业务实现">商品业务实现<a class="hash-link" href="#商品业务实现" title="标题的直接链接">​</a></h3><p>这里我们简单做个示例，将价格固定返回，实现<code>GoodClient</code>的控制器如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">org</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">minbox</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">chapter</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">good</span><span class="token namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token namespace" style="opacity:0.7">service</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">minbox</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">chapter</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">common</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">openfeign</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">GoodClient</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token import namespace" style="opacity:0.7">org</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">springframework</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">web</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">bind</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import namespace" style="opacity:0.7">annotation</span><span class="token import namespace punctuation" style="opacity:0.7;color:#8dc891">.</span><span class="token import class-name" style="color:#FAC863">RestController</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 商品服务接口实现</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see GoodClient</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GoodController</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GoodClient</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getGoodPrice</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> goodId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">goodId </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">15.6</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0D</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册到eureka-server">注册到Eureka Server<a class="hash-link" href="#注册到eureka-server" title="标题的直接链接">​</a></h3><p>我们需要将<code>good-service</code>注册到<code>Eureka Server</code>，修改<code>application.yml</code>配置文件如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ServiceID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> good</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># 端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8082</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># Eureka Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">eureka</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">client</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">service-url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">defaultZone</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">10000/eureka/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">instance</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">prefer-ip-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置上报的logging-admin">配置上报的Logging Admin<a class="hash-link" href="#配置上报的logging-admin" title="标题的直接链接">​</a></h3><p>我们需要将<code>good-service</code>的请求日志上报到<code>Logging Admin</code>，采用<code>SpringCloud ServiceID</code>的方式配置，修改<code>application.yml</code>配置文件如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 控制台打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 美化打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置Logging Admin 服务编号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">discovery</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">service-id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用eureka-client--logging">启用Eureka Client &amp; Logging<a class="hash-link" href="#启用eureka-client--logging" title="标题的直接链接">​</a></h3><p>最后我们在<code>XxxApplication</code>入口类添加注解来启用<code>Eureka Client</code>以及<code>Logging Client</code>，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 商品服务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GoodServiceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">GoodServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">GoodServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"商品"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>至此我们的商品服务已经准备完成.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建订单服务">创建订单服务<a class="hash-link" href="#创建订单服务" title="标题的直接链接">​</a></h2><p>创建一个名为<code>order-service</code>的<code>SpringBoot</code>项目（建议参考源码，本章采用Maven多模块创建）。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加相关依赖-1">添加相关依赖<a class="hash-link" href="#添加相关依赖-1" title="标题的直接链接">​</a></h3><p>修改<code>pom.xml</code>添加相关依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--SpringBoot Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Eureka Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Openfeign--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-openfeign</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--公共Openfeign接口定义依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.chapter</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">common-openfeign</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">0.0.1-SNAPSHOT</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="订单业务实现">订单业务实现<a class="hash-link" href="#订单业务实现" title="标题的直接链接">​</a></h3><p>我们来模拟一个<strong>提交订单</strong>的场景，创建一个名为<code>OrderController</code>的控制器，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 订单控制器</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/order"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">OrderController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 商品接口定义注入</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * {@link GoodClient}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Autowired</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">GoodClient</span><span class="token plain"> goodClient</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@PostMapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">submit</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> goodId</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Integer</span><span class="token plain"> buyCount</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> goodPrice </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> goodClient</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getGoodPrice</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">goodId</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">Double</span><span class="token plain"> orderAmount </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> goodPrice </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> buyCount</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"订单提交成功，订单总金额："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> orderAmount</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册到eureka-server-1">注册到Eureka Server<a class="hash-link" href="#注册到eureka-server-1" title="标题的直接链接">​</a></h3><p>将我们创建的<code>order-service</code>注册到<code>Eureka Server</code>，修改<code>application.yml</code>配置文件如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> order</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># Eureka Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">eureka</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">client</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">service-url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">defaultZone</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">10000/eureka/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">instance</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">prefer-ip-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置上报的logging-admin-1">配置上报的Logging Admin<a class="hash-link" href="#配置上报的logging-admin-1" title="标题的直接链接">​</a></h3><p>我们需要将<code>order-service</code>的请求日志上报到<code>Logging Admin</code>，采用<code>SpringCloud ServiceID</code>的方式配置，修改<code>application.yml</code>配置文件如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 控制台打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 美化打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置Logging Admin 服务编号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">discovery</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">service-id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用eureka-client--logging-1">启用Eureka Client &amp; Logging<a class="hash-link" href="#启用eureka-client--logging-1" title="标题的直接链接">​</a></h3><p>修改<code>order-service</code>入口类<code>OrderServiceApplication</code>，添加启用<code>Eureka Client</code>、<code>Logging Client</code>的注解，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 订单服务</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableFeignClients</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">basePackages </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"org.minbox.chapter.common.openfeign"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">OrderServiceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">OrderServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">OrderServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>注解解释：</strong></p><ul><li><p><code>@EnableFeignClients</code>：该注解是<code>Openfeign</code>提供的启用自动扫描<code>Client</code>的配置，我们通过<code>basePackages</code>（基础包名）的方式进行配置扫描包下配置<code>@FeignClient</code>注解的接口，并为<strong>每个接口</strong>生成对应的<code>代理实现</code>并添加到<code>Spring IOC</code>容器。</p><p><code>org.minbox.chapter.common.openfeign</code>包名在<code>common-openfeign</code>项目内。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>依次启动项目，<code>eureka-server</code> &gt; <code>logging-admin</code> &gt; <code>good-service</code> &gt; <code>order-service</code>。</p><p>通过<code>curl</code>命令访问<code>order-service</code>内的提交订单地址：<code>/order</code>，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> -X POST http://localhost:8081/order</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">?goodId</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">buyCount</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token number" style="color:#5a9bcf">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">订单提交成功，订单总金额：46.8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>可以看到我们已经可以成功的获取订单的总金额，我们在<code>/order</code>请求方法内调用<code>good-service</code>获取商品的单价后计算得到订单总金额。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试点链路信息传递">测试点：链路信息传递<a class="hash-link" href="#测试点链路信息传递" title="标题的直接链接">​</a></h3><p>我们通过控制台输出的日志信息来确认下链路信息（traceId、spanId）的透传是否正确。</p><p><strong>收到order-service上报的日志</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【order-service -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573009439840</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:8081"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"POST"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"buyCount\":\"3\",\"goodId\":\"1\"}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/order"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"订单提交成功，订单总金额：46.8"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"order-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8081"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"241ef717-b0b3-4fcc-adae-b63ffd3dbbe4"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573009439301</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">539</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"3e20cc72-c880-4575-90ed-d54a6b4fe555"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>收到good-service上报的日志</strong></p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【good-service -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573009439810</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"parentSpanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"241ef717-b0b3-4fcc-adae-b63ffd3dbbe4"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"minbox-logging-x-parent-span-id"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"241ef717-b0b3-4fcc-adae-b63ffd3dbbe4"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"minbox-logging-x-trace-id"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"3e20cc72-c880-4575-90ed-d54a6b4fe555"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"10.180.98.156:8082"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"connection"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"keep-alive"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"Java/1.8.0_211"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"10.180.98.156"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/good/1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"15.6"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"good-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8082"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"6339664e-097d-4a01-a734-935de52a7d44"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1573009439787</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">23</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"3e20cc72-c880-4575-90ed-d54a6b4fe555"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> <strong>结果分析：</strong></p><ul><li><p>请求日志的入口为<code>order-service</code>所以并不存在<code>parentSpanId</code>（上级单元编号），而<code>spanId</code>（单元编号）、<code>traceId</code>（链路编号）也是新生成的。</p></li><li><p>本次请求会经过<code>good-service</code>服务，因此<code>parentSpanId</code>则是<code>order-service</code>生成的<code>spanId</code>，<code>traceId</code>同样也是<code>order-service</code>生成的，透传HttpHeader方式进行传递，表示在同一条请求链路上。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging</code>支持使用<code>Openfeign</code>传递链路信息，内部通过<code>Openfeign</code>拦截器实现，源码详见：<code>org.minbox.framework.logging.client.http.openfeign.LoggingOpenFeignInterceptor</code>。</p><p>将<code>traceId</code>（链路编号）、<code>parentSpanId</code>（单元编号）通过<code>HttpHeader</code>的形式传递到目标访问服务，服务通过请求日志拦截器进行提取并设置链路绑定关系。</p><ul><li><code>traceId</code>传递时HttpHeader名称为：<code>minbox-logging-x-trace-id</code>.</li><li><code>parentSpanId</code>传递时HttpHeader名称为：<code>minbox-logging-x-parent-span-id</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-using-openfeign-transparent-traceid</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot Logging整合SpringCloud Eureka负载均衡上报日志]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-integrates-eureka-report-logs</link>
            <guid>apiboot-logging-integrates-eureka-report-logs</guid>
            <pubDate>Mon, 04 Nov 2019 16:33:12 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging支持整合服务注册中心（Eureka、Consul、Nacos Discovery、Zookeeper...）进行上报请求日志，Logging Client会从服务注册中心内找到指定ServiceID的Logging Admin具体可用实例，通过SpringCloud Discovery内部的负载均衡策略返回Logging Admin的部署服务器IP以及端口号，这样Logging Client就可以完成请求日志的上报流程。]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging</code>支持整合<code>服务注册中心</code>（Eureka、Consul、Nacos Discovery、Zookeeper...）进行上报请求日志，<code>Logging Client</code>会从服务注册中心内找到指定<code>ServiceID</code>的<code>Logging Admin</code>具体可用实例，通过<code>SpringCloud Discovery</code>内部的负载均衡策略返回<code>Logging Admin</code>的部署<code>服务器IP</code>以及<code>端口号</code>，这样<code>Logging Client</code>就可以完成请求日志的上报流程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建eureka-server">搭建Eureka Server<a class="hash-link" href="#搭建eureka-server" title="标题的直接链接">​</a></h2><p>我们先来搭建一个<code>Eureka Server</code>，请访问【{% post_link eureka-server %}】文章内容查看具体搭建流程。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="将logging-admin注册到eureka">将Logging Admin注册到Eureka<a class="hash-link" href="#将logging-admin注册到eureka" title="标题的直接链接">​</a></h2><p>既然使用的是<code>服务注册中心</code>，我们需要将之前章节将的<code>Logging Admin</code>进行简单的改造，添加<code>Eureka</code>客户端相关的依赖，并在<code>application.yml</code>配置文件内添加<code>Eureka Server</code>的相关配置，如果对<code>Logging Admin</code>不了解的同学可以访问【{% post_link apiboot-report-logs-by-logging-to-admin %}】查看文章内容，文章底部有源码。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加eureka-client依赖">添加Eureka Client依赖<a class="hash-link" href="#添加eureka-client依赖" title="标题的直接链接">​</a></h3><p>我们需要将<code>Logging Admin</code>注册到<code>Eureka Server</code>，对于<code>Eureka Server</code>而言<code>Logging Admin</code>是一个<code>客户端</code>（Eureka Client）角色。</p><p>我们在<code>pom.xml</code>文件内添加如下配置：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--Eureka Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用eureka-client">启用Eureka Client<a class="hash-link" href="#启用eureka-client" title="标题的直接链接">​</a></h3><p>添加依赖后我们还需要在<code>XxxApplication</code>入口类添加<code>@EnableDiscoveryClient</code>注解来启用<code>Eureka Client</code>的相关功能，如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingAdmin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingAdminApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">LoggingAdminApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">LoggingAdminApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"日志管理中心"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置注册到eureka-server">配置注册到Eureka Server<a class="hash-link" href="#配置注册到eureka-server" title="标题的直接链接">​</a></h3><p>我们在<code>application.yml</code>配置文件内添加连接到<code>Eureka Server</code>的相关配置信息，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># Eureka Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">eureka</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">client</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">service-url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">defaultZone</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">10000/eureka/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">instance</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">prefer-ip-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="将logging-client注册到eureka">将Logging Client注册到Eureka<a class="hash-link" href="#将logging-client注册到eureka" title="标题的直接链接">​</a></h2><p><code>Logging Client</code>其实就是我们的业务服务，不要被名称误导，我们在本章源码内创建一个<code>user-service</code>模块来作为测试的业务服务，我们也需要将<code>user-service</code>作为客户端注册到<code>Eureka Server</code>，可参考【<a href="https://blog.yuqiyu.com/apiboot-unified-manage-request-logs.html" target="_blank" rel="noopener noreferrer">使用ApiBoot Logging进行统一管理请求日志</a>】文章内容创建项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加eureka-client依赖-1">添加Eureka Client依赖<a class="hash-link" href="#添加eureka-client依赖-1" title="标题的直接链接">​</a></h3><p>在<code>pom.xml</code>配置文件内添加如下依赖：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--Eureka Client--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.cloud</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-cloud-starter-netflix-eureka-client</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用eureka-client-1">启用Eureka Client<a class="hash-link" href="#启用eureka-client-1" title="标题的直接链接">​</a></h3><p>添加依赖后同样需要启用<code>Eureak Client</code>，这是必不可少的步骤，在我们的入口类<code>XxxApplication</code>上添加如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableDiscoveryClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * logger instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">Logger</span><span class="token plain"> logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggerFactory</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">UserServiceApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"{}服务启动成功."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"用户"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置注册到eureka-server-1">配置注册到Eureka Server<a class="hash-link" href="#配置注册到eureka-server-1" title="标题的直接链接">​</a></h3><p>我们在<code>application.yml</code>配置文件内添加<code>Eureka Server</code>的相关配置信息，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># Eureka Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">eureka</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">client</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">service-url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">defaultZone</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">10000/eureka/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">instance</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">prefer-ip-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置logging-admin服务信息">配置Logging Admin服务信息<a class="hash-link" href="#配置logging-admin服务信息" title="标题的直接链接">​</a></h3><p>这是本章的核心内容，我们在之前都是通过<code>api.boot.logging.admin.server-address</code>参数进行配置<code>Logging Admin</code>的<code>IP地址</code>以及<code>服务端口号</code>，而本章我们就要借助<code>服务注册中心</code>（Eureka Server）来从实例列表中获取<code>Logging Admin</code>服务信息，<code>ApiBoot Logging</code>提供了一个配置参数<code>api.boot.logging.discovery.service-id</code>进行配置<code>Logging Admin</code>的<code>ServiceID</code>，也就是<code>spring.application.name</code>参数对应的值，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># ApiBoot Config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">discovery</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># Logging Admin ServiceID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">service-id</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>每当我们发起请求时，Logging Client就会从<code>Eureak Server</code>内获取<code>ServiceID = logging-admin</code>的服务列表，负载均衡筛选后获取一个<strong>可用的实例</strong>信息进行上报日志。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行测试">运行测试<a class="hash-link" href="#运行测试" title="标题的直接链接">​</a></h2><p>我们将本章源码内用到的三个服务<code>eureka-server</code>、<code>logging-admin</code>、<code>user-service</code>依次启动。</p><p>通过<code>curl</code>命令访问<code>user-service</code>提供的<code>Controller</code>地址，如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:9090/test</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">?name</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">你好：admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以在<code>logging-admin</code>控制台看到<code>user-service</code>上报的请求日志信息，如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【user-service -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1572921905360</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:9090"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"name\":\"admin\"}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/test"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"你好：admin"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"user-service"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"9090"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"d97c515f-a147-4f89-9c59-398905c95a73"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1572921905336</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">24</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"5e6c0357-1625-4a28-af18-cacdddba146a"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>自此我们已经成功的整合<code>Eureka</code>与<code>ApiBoot Logging</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging</code>内部提供的两种获取<code>Logging Admin</code>服务信息的方式，分别是：<code>service-id</code>、<code>server-address</code>，都是比较常用的，使用<code>service-id</code>方式可以无缝整合<code>SpringCloud</code>进行使用，而链路信息可以通过<code>Openfeign</code>、<code>RestTemplate</code>进行传递，这会在我们后期的知识点中讲到。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-integrates-eureka-report-logs</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[ApiBoot Logging整合Spring Security安全上报日志]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-logging-integrates-spring-security</link>
            <guid>apiboot-logging-integrates-spring-security</guid>
            <pubDate>Sun, 03 Nov 2019 21:34:14 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging在上报日志时虽然是一般通过内网的形式部署，不过安全方面还是主要依赖于服务器的安全策略（防火墙），为了提高日志上报的安全性，ApiBoot Logging支持了整合Spring Security来使用Basic Auth的形式上传日志信息。]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging</code>在上报日志时虽然是一般通过内网的形式部署，不过安全方面还是主要依赖于服务器的<code>安全策略</code>（防火墙），为了提高日志上报的安全性，<code>ApiBoot Logging</code>支持了整合<code>Spring Security</code>来使用<code>Basic Auth</code>的形式上传日志信息。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建logging-admin项目">创建Logging Admin项目<a class="hash-link" href="#创建logging-admin项目" title="标题的直接链接">​</a></h2><p>我们需要在集成<code>ApiBoot Logging Admin</code>项目内添加<code>Spring Security</code>相关依赖来完成安全配置，我们需要创建一个<code>Logging Admin</code>项目，可参考【{% post_link apiboot-report-logs-by-logging-to-admin %}】文章内容。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="集成spring-security">集成Spring Security<a class="hash-link" href="#集成spring-security" title="标题的直接链接">​</a></h3><p>在<code>Logging Admin</code>项目<code>pom.xml</code>文件内添加<code>Spring Security</code>依赖，如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--SpringBoot Security--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-security</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置spring-security认证用户">配置Spring Security认证用户<a class="hash-link" href="#配置spring-security认证用户" title="标题的直接链接">​</a></h3><p>我们使用<code>SpringBoot</code>集成<code>Spring Security</code>提供的配置文件的方式配置<code>Basic User</code>信息，这种方式使用的是内存方式，用户信息被存储在内存中，如果你需要从数据库内读取，可以查看<code>Spring Security</code>的<code>UserDetails</code>具体使用方法。</p><p><strong>application.yml</strong>文件添加如下配置：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 配置内存方式Spring Security用户信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">security</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">user</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> admin123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建logging-client项目">创建Logging Client项目<a class="hash-link" href="#创建logging-client项目" title="标题的直接链接">​</a></h2><p>我们的业务服务需要集成<code>ApiBoot Logging</code>依赖（作为<code>Logging Client</code>进行上报请求日志），可参考【{% post_link apiboot-unified-manage-request-logs %}】文章内容创建项目。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置安全上报">配置安全上报<a class="hash-link" href="#配置安全上报" title="标题的直接链接">​</a></h3><p>如果使用过<code>Eureka</code>的小伙伴应该对<strong>路径</strong>配置<code>Basic User</code>的方式不陌生，格式为：<code>username:password@ip:port</code>。</p><p><strong>application.yml</strong>修改上报的<code>Logging Admin</code>路径如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 美化打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 控制台显示打印日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置Logging Admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">server-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">admin123@127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token number" style="color:#5a9bcf">8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们在<code>Logging Admin</code>配置的用户名为：<code>admin</code>，密码为：<code>admin123</code>，而<code>@</code>符号后面就是<code>Logging Admin</code>的<code>IP地址</code>以及<code>端口号</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><p>下面我们进行测试<code>Spring Security</code>是否起到了作用。</p><p>依次启动<code>Logging Admin</code>、<code>Logging Client</code>，通过以下命令访问接口：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">➜ ~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:8080/test</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">?name</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">admin </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">你好：admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在<code>Logging Admin</code>控制台可以看到上报的请求日志信息时，证明我们已经<strong>安全的上报了日志</strong>，如果<code>Logging Client</code>控制台打印<code>401 Exception</code>认证错误信息，请检查<code>Logging Client</code>配置的路径<code>Basic User</code>是否正确。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板，划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>请求日志是用来检查接口的稳定性、排除一些请求异常问题的主要凭据，所以我们尽可能要保证数据的有效性、安全性，建议搭配<code>Spring Security</code>一块使用<code>ApiBoot Logging</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-logging-integrates-spring-security</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[自定义ApiBoot Logging链路以及单元ID]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-custom-logging-traceid</link>
            <guid>apiboot-custom-logging-traceid</guid>
            <pubDate>Mon, 21 Oct 2019 16:44:52 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging会为每一个请求都对应创建链路编号（TraceID）以及单元编号（SpanID），用于归类每一次请求日志，通过一个链路下日志单元的Parent SpanID可以进行上下级关系的梳理。]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging</code>会为每一个请求都对应创建链路编号（<code>TraceID</code>）以及单元编号（<code>SpanID</code>），用于归类每一次请求日志，通过一个链路下日志单元的<code>Parent SpanID</code>可以进行上下级关系的梳理。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前文回顾">前文回顾<a class="hash-link" href="#前文回顾" title="标题的直接链接">​</a></h2><ul><li><p>{% post_link apiboot-unified-manage-request-logs %}</p></li><li><p>{% post_link apiboot-report-logs-by-logging-to-admin %}</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="了解链路编号的传递方式">了解链路编号的传递方式<a class="hash-link" href="#了解链路编号的传递方式" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="/assets/images/apiboot-custom-logging-traceid-1-fa67c2cf54de4133ec3b2bfeb8f20f89.png" width="1113" height="493" class="img_ev3q"></p><p>在每一次请求中链路编号（<code>traceId</code>）、单元编号<code>（spanId）</code>都是通过<code>HttpHeader</code>的方式进行传递，日志的起始位置会主动生成<code>traceId</code>、<code>spanId</code>，而起始位置的<code>Parent SpanId</code>则是不存在的，值为<code>null</code>。</p><p>这样每次通过<code>restTemplate</code>、<code>Openfeign</code>的形式访问其他服务的接口时，就会<strong>携带起始位置生成的<code>traceId</code>、<code>spanId</code>到下一个服务单元</strong>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="默认编号">默认编号<a class="hash-link" href="#默认编号" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging</code>内部提供了默认的编号格式，默认为通用格式，没有区分性，无法从编号上进行区分日志的具体归类。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认的链路编号">默认的链路编号<a class="hash-link" href="#默认的链路编号" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging</code>内部通过集成<code>minbox-logging</code>日志组件来完成日志的采集等基本功能，每一次生成采集的日志时都会通过<strong>LoggingTraceGenerator</strong>接口进行生成链路编号（<code>TraceID</code>），该接口源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Logging Tracer</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Create new traceId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author：恒宇少年 - 于起宇</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * DateTime：2019-07-10 17:01</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Blog：http://blog.yuqiyu.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * WebSite：http://www.jianshu.com/u/092df3f77bca</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Gitee：https://gitee.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * GitHub：https://github.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingTraceGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * create new traceId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return traceId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws MinBoxLoggingException exception</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createTraceId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ApiBoot Logging</code>默认的链路编号（<code>TraceID</code>）采用的是<strong>UUID随机字符串</strong>的方式生成的，内部实现是通过<strong>LoggingTraceGenerator</strong>接口的默认实现类<strong>LoggingDefaultTraceGenerator</strong>进行生成，生成类源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Logging Tracer Default Support Instance</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author：恒宇少年 - 于起宇</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * DateTime：2019-07-10 17:28</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Blog：http://blog.yuqiyu.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * WebSite：http://www.jianshu.com/u/092df3f77bca</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Gitee：https://gitee.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * GitHub：https://github.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingDefaultTraceGenerator</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingTraceGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Use UUID as the default traceId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return traceId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws MinBoxLoggingException Exception</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createTraceId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">UUID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">randomUUID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">toString</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="默认的单元编号">默认的单元编号<a class="hash-link" href="#默认的单元编号" title="标题的直接链接">​</a></h3><p><code>单元编号</code>是一条链路下经过的每一个业务单元的唯一标识，在<code>SpringCloud</code>微服务的场景下每发起一个请求内部通过<code>Openfeign</code>可能会经过多个<code>服务</code>，这样每经过的一个服务称之为单元，而当前这条链路下的单元唯一标识字符串就称为<code>单元编号</code>。</p><p><code>minbox-logging</code>提供了生成<code>单元编号</code>的接口<strong>LoggingSpanGenerator</strong>，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Logging Span</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Create new spanId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author：恒宇少年 - 于起宇</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * DateTime：2019-07-10 17:02</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Blog：http://blog.yuqiyu.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * WebSite：http://www.jianshu.com/u/092df3f77bca</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Gitee：https://gitee.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * GitHub：https://github.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingSpanGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * create new spanId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return span id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws MinBoxLoggingException exception</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createSpanId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>spanId</code>默认采用的跟<code>traceId</code>生成方式一致，都是<code>UUID</code>随机字符串，<code>minbox-logging</code>提供了<strong>LoggingSpanGenerator</strong>接口默认的实现<strong>LoggingDefaultSpanGenerator</strong>，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Logging Default Span</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Use By Create New SpanId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author：恒宇少年 - 于起宇</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * &lt;p&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * DateTime：2019-07-15 17:24</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Blog：http://blog.yuqiyu.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * WebSite：http://www.jianshu.com/u/092df3f77bca</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * Gitee：https://gitee.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * GitHub：https://github.com/hengboy</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingDefaultSpanGenerator</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingSpanGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * Create New SpanId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return SpanId</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @throws MinBoxLoggingException Exception</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createSpanId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">UUID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">randomUUID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">toString</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="自定义编号">自定义编号<a class="hash-link" href="#自定义编号" title="标题的直接链接">​</a></h2><p>我们可以根据自己的业务进行自定义<code>traceId</code>、<code>spanId</code>，可以加入一些自己业务的元素，只需要提供<code>minbox-logging</code>提供的生成<code>traceId</code>的接口<strong>LoggingTraceGenerator</strong>、生成<code>spanId</code>的接口<strong>LoggingSpanGenerator</strong>对应的实现类，并将实现类交给<code>LoggingFaceBean</code>管理即可。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义链路编号">自定义链路编号<a class="hash-link" href="#自定义链路编号" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 自定义traceId生成策略</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CustomTraceIdGenerator</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingTraceGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 链路编号前缀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">TRACE_ID_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"local"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createTraceId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">TRACE_ID_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">UUID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">randomUUID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">toString</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">hashCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们创建名为<code>CustomTraceIdGenerator</code>的类并实现<code>LoggingTraceGenerator</code>接口，实现<code>createTraceId()</code>方法的返回值根据<code>local-</code>作为前缀，拼接<code>UUID</code>随机字符串的<code>hashCode</code>值作为后缀。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义单元编号">自定义单元编号<a class="hash-link" href="#自定义单元编号" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 自定义单元编号生成策略</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CustomSpanIdGenerator</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingSpanGenerator</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 单元编号前缀</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">SPAN_ID_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"group"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">createSpanId</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">throws</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MinBoxLoggingException</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">SPAN_ID_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">UUID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">randomUUID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">toString</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">hashCode</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们创建名为<code>CustomSpanIdGenerator</code>的类并实现<code>LoggingSpanGenerator</code>接口，在<code>createSpanId()</code>方法的返回值根据<code>group-</code>作为前缀，使用<code>UUID</code>随机字符串的<code>hashCode</code>值作为后缀。</p><p>在上面我们已经创建了自定义<code>traceId</code>以及<code>spanId</code>的实现类，我们需要将实现类的实例交给<code>LoggingFactoryBean</code>管理，这样我们才可以实现自定义编号。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loggingfactorybeancustomizer">LoggingFactoryBeanCustomizer<a class="hash-link" href="#loggingfactorybeancustomizer" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging</code>提供了一个自定义设置<code>LoggingFactoryBean</code>的接口<strong>LoggingFactoryBeanCustomizer</strong>，通过该接口可以修改<code>LoggingFactoryBean</code>内允许修改的任意值。</p><p>我们创建名为<strong>CustomCreateTraceAndSpanId</strong>类并实现<code>LoggingFactoryBeanCustomizer</code>接口，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 自定义创建链路以及单元编号</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see LoggingFactoryBeanCustomizer</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see LoggingFactoryBean</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see org.minbox.framework.logging.client.tracer.LoggingTraceGenerator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @see org.minbox.framework.logging.client.span.LoggingSpanGenerator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CustomCreateTraceAndSpanId</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingFactoryBeanCustomizer</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * {@link CustomTraceIdGenerator} 自定义链路编号生成策略</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * {@link CustomSpanIdGenerator} 自定义单元编号生成策略</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param factoryBean {@link LoggingFactoryBean}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customize</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">LoggingFactoryBean</span><span class="token plain"> factoryBean</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">CustomTraceIdGenerator</span><span class="token plain"> traceIdGenerator </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CustomTraceIdGenerator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        factoryBean</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">setTraceGenerator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">traceIdGenerator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">CustomSpanIdGenerator</span><span class="token plain"> spanIdGenerator </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">new</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">CustomSpanIdGenerator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        factoryBean</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">setSpanGenerator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">spanIdGenerator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>customize</code>这种设计方式是在<code>SpringBoot</code>中比较常见的，<code>ApiBoot</code>也沿用了这种设计方式，<code>customize（）</code>方法提供了<code>LoggingFactoryBean</code>对象实例作为参数，我们可以直接通过<code>setXxx</code>方法进行修改内定义的默认配置。</p><p>通过<code>facetory.setTraceGenerator</code>方法可以修改默认的<code>traceId</code>生成策略。</p><p>通过<code>facetory.setSpanGenerator</code>方法可以修改默认的<code>spanId</code>生成策略。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><p>启动项目后我们来查看控制台打印的日志内容，确认是否修改成功。</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571711067664</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/index"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"this is index."</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"apiboot-custom-logging-traceid"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"group-1780993769"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571711067643</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">21</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"local1111437283"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>traceId</code>、<code>spanId</code>已经修改成我们自定义的编号生成策略方式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>本章节主要是讲到了如何自定义<code>traceId</code>以及<code>spanId</code>，我们可以通过<code>LoggingFactoryBeanCustomizer</code>对<code>LoggingFactoryBean</code>对象进行深度的自定义配置，有关<code>ApiBoot Logging</code>使用的正确姿势还有很多，敬请期待。</p><blockquote><p>请结合文中前文回顾部分进行编写测试。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-custom-logging-traceid</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[将ApiBoot Logging采集的日志上报到Admin]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-report-logs-by-logging-to-admin</link>
            <guid>apiboot-report-logs-by-logging-to-admin</guid>
            <pubDate>Thu, 17 Oct 2019 10:35:20 GMT</pubDate>
            <description><![CDATA[通过ApiBoot Logging可以将每一条请求的详细信息获取到，在分布式部署方式中，一个请求可能会经过多个服务，如果是每个服务都独立保存请求日志信息，我们没有办法做到统一的控制，而且还会存在日志数据库与业务数据库不一致的情况出现（可能会用到多数据源配置），正因为这个问题ApiBoot Logging提供了一个Admin的概念，将客户端采集到的的每一条日志都进行上报到Admin，由Admin进行分析、保存等操作。]]></description>
            <content:encoded><![CDATA[<p>通过<code>ApiBoot Logging</code>可以将每一条请求的详细信息获取到，在分布式部署方式中，一个请求可能会经过多个服务，如果是每个服务都<code>独立保存</code>请求日志信息，我们没有办法做到统一的控制，而且还会存在<code>日志数据库</code>与<code>业务数据库</code>不一致的情况出现（可能会用到多数据源配置），正因为这个问题<code>ApiBoot Logging</code>提供了一个<code>Admin</code>的概念，将客户端采集到的的每一条日志都进行上报到<code>Admin</code>，由<code>Admin</code>进行分析、保存等操作。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建logging-admin项目">创建Logging Admin项目<a class="hash-link" href="#创建logging-admin项目" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging Admin</code>既然可以汇总每一个<code>业务服务</code>（ApiBoot Logging）的请求日志，因此我们需要将每一个<code>业务服务</code>采集单的日志进行上报到<code>Admin</code>，所以应该使用<strong>独立的方式</strong>进行部署，我们单独创建一个服务来专门采集请求日志然后进行保存。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化logging-admin项目依赖">初始化Logging Admin项目依赖<a class="hash-link" href="#初始化logging-admin项目依赖" title="标题的直接链接">​</a></h3><p>使用<code>idea</code>创建一个<code>SpringBoot</code>项目，<code>pom.xml</code>配置文件内的依赖如下所示：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging Admin--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging-admin</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--MySQL--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">mysql-connector-java</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">com.zaxxer</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">HikariCP</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot MyBatis Enhance--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-mybatis-enhance</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们需要将采集到的请求日志进行保存到数据库，所以在项目内需要添加<code>数据库驱动</code>、<code>数据库连接池</code>相关的依赖，<code>ApiBoot Logging Admin</code>内部通过<code>DataSource</code>进行操作数据，通过<code>ApiBoot MyBatis Enhance</code>的依赖可以自动化创建<code>DataSource</code>，摆脱手动创建并加入<code>Spring IOC</code>容器。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加apiboot统一版本依赖">添加ApiBoot统一版本依赖<a class="hash-link" href="#添加apiboot统一版本依赖" title="标题的直接链接">​</a></h3><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.4.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>最新版的ApiBoot，请访问：<a href="https://search.maven.org/search?q=a:api-boot-dependencies" target="_blank" rel="noopener noreferrer"></a><a href="https://search.maven.org/search?q=a:api-boot-dependencies" target="_blank" rel="noopener noreferrer">https://search.maven.org/search?q=a:api-boot-dependencies</a>进行查询。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启用logging-admin">启用Logging Admin<a class="hash-link" href="#启用logging-admin" title="标题的直接链接">​</a></h3><p>添加<code>ApiBoot Logging Admin</code>依赖后还不能完全使用<code>Admin</code>的功能，我们需要通过<code>@EnableLoggingAdmin</code>注解来启用，该注解会自动将<code>Logging Admin</code>内所需要的部分类自动注册到<code>Spring IOC</code>，在入口类添加注解如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * ApiBoot Logging Admin入口类</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingAdmin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootReportLogsByLoggingToAdminApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootReportLogsByLoggingToAdminApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置日志数据源">配置日志数据源<a class="hash-link" href="#配置日志数据源" title="标题的直接链接">​</a></h3><p><code>application.yml</code>配置文件内数据源配置如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># 服务名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">report</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">logs</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">by</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">logging</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999"># 数据源相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">datasource</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">driver-class-name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">url</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain">3306/test</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">username</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">password</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> com.zaxxer.hikari.HikariDataSource</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># 服务端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="控制台打印上报日志">控制台打印上报日志<a class="hash-link" href="#控制台打印上报日志" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging Admin</code>可以通过配置文件的方式进行控制是否在控制台打印采集到的请求日志信息，在<code>application.yml</code>配置文件内添加如下内容：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># Logging Admin相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># 控制台显示采集的日志信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">show-console-report-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：这里不要跟ApiBoot Logging所提供的<code>api.boot.logging.show-console-log</code>配置混淆。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="美化控制台打印的上报日志">美化控制台打印的上报日志<a class="hash-link" href="#美化控制台打印的上报日志" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># Logging Admin相关配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># 控制台输出时美化采集到的日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：这里不要跟<code>api.boot.logging.format-console-log-json</code>配置混淆。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化日志表结构">初始化日志表结构<a class="hash-link" href="#初始化日志表结构" title="标题的直接链接">​</a></h2><p><code>ApiBoot Logging Admin</code>内部通过<strong>固定的表结构</strong>来进行存储<code>请求日志</code>、<code>服务信息</code>，建表语句如下所示：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">SET</span><span class="token plain"> NAMES utf8mb4 </span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Table structure for table `logging_request_logs`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_request_logs</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'主键，UUID'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_service_detail_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'服务详情编号，关联logging_service_details主键'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_trace_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'链路ID'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_parent_span_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'上级跨度ID'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_span_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'跨度ID'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_start_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mediumtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求开始时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_end_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">mediumtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求结束时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_http_status</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求响应状态码'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_body</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">longtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求主体内容'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_headers</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">text</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求头信息'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_ip</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">30</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'发起请求客户端的IP地址'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_method</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">10</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求方式'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_uri</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求路径'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_response_body</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">longtext</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'响应内容'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_response_headers</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">text</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'响应头信息'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_time_consuming</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'请求耗时'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_create_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">timestamp</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'日志保存时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_request_params</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">text</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_exception_stack</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">text</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_request_logs_LRL_SERVICE_DETAIL_ID_index</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lrl_service_detail_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ENGINE</span><span class="token operator" style="color:#d7deea">=</span><span class="token keyword" style="color:#c5a5c5">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CHARSET</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">'请求日志信息表'</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Table structure for table `logging_service_details`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">logging_service_details</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">36</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_service_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'上报服务的ID，对应spring.application.name配置值'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_service_ip</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">varchar</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">50</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token plain"> utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'上报服务的IP地址'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_service_port</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">11</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'上报服务的端口号'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_last_report_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">timestamp</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'最后一次上报时间，每次上报更新'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_create_time</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">timestamp</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">'首次上报时创建时间'</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token identifier">lsd_id</span><span class="token identifier punctuation" style="color:#8dc891">`</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ENGINE</span><span class="token operator" style="color:#d7deea">=</span><span class="token keyword" style="color:#c5a5c5">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">CHARSET</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4 </span><span class="token keyword" style="color:#c5a5c5">COLLATE</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">utf8mb4_general_ci </span><span class="token keyword" style="color:#c5a5c5">COMMENT</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">'上报日志的客户端服务详情'</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ApiBoot Logging Admin</code>目前为止已经准备完毕，接下来我们需要修改<code>业务服务</code>将请求日志上报到<code>Logging Admin</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="上报日志到指定logging-admin">上报日志到指定Logging Admin<a class="hash-link" href="#上报日志到指定logging-admin" title="标题的直接链接">​</a></h2><p>我们将修改{% post_link apiboot-unified-manage-request-logs %}文章源码，在<code>application.yml</code>添加<code>Logging Admin</code>的地址，如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Logging 日志组件配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token comment" style="color:#999999"># 配置Logging Admin地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">admin</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token key atrule" style="color:#FAC863">server-address</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> 127.0.0.1</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token number" style="color:#5a9bcf">8081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>api.boot.logging.admin-service-address</code>的配置格式为：<code>Ip:Port</code>，我们只需要修改这一个地方即可，其他的工作都交付给<code>ApiBoot Logging</code>内部完成。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h2><p>我们将<code>ApiBoot Logging Admin</code>以及<code>业务服务</code>通过<code>Application</code>的形式进行启动。</p><p>使用<code>curl</code>访问测试地址如下所示：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">~ </span><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:8080/test</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">?name</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">你好：admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们查看<code>ApiBoot Logging Admin</code>控制台日志如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Receiving Service</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> 【apiboot-unified-manage-request-logs -&gt; </span><span class="token number" style="color:#5a9bcf">127.0</span><span class="token plain">.</span><span class="token number" style="color:#5a9bcf">0.1</span><span class="token plain">】</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> Request Log Report，Logging Content：</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571641723779</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"server-region"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"JiNan"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"name\":\"admin\"}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/test"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"你好：admin"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"apiboot-unified-manage-request-logs"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"95a73ca0-831b-45df-aa43-2b5887e8d98d"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571641723776</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">3</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"25a7de96-b3dd-48e5-9854-1a8069a4a681"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们已经看到了<code>Logging Admin</code>控制台打印的上报请求日志，而这条请求的日志是否已经被保存到数据库了还不确定，下面我使用命令行来查看数据库的日志信息。</p><p><strong>查看logging_service_details表内数据</strong></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mysql</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">select</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> logging_service_details\G</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1.</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">row</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">              lsd_id: b069366a</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">25</span><span class="token plain">dc</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">41</span><span class="token plain">ec</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">f09</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">242</span><span class="token plain">d81755cd0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      lsd_service_id: apiboot</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">unified</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">manage</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">request</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      lsd_service_ip: </span><span class="token number" style="color:#5a9bcf">10.180</span><span class="token number" style="color:#5a9bcf">.98</span><span class="token number" style="color:#5a9bcf">.112</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    lsd_service_port: </span><span class="token number" style="color:#5a9bcf">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">lsd_last_report_time: </span><span class="token number" style="color:#5a9bcf">2019</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">10</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">21</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">02</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">26</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">     lsd_create_time: </span><span class="token number" style="color:#5a9bcf">2019</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">10</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">21</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">15</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">26</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>logging_service_details</code>存放了每一个上报请求日志的<code>业务服务</code>基本信息，每一个服务基本信息会在<code>Logging Admin</code>内存中缓存一份，方便获取<code>service_id</code>进行存储日志，根据<code>ip</code>+<code>port</code>+<code>service_id</code>进行<strong>确定唯一性</strong>，同一个服务只进行保存一次。</p><p><strong>查看logging_request_logs表内数据</strong></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mysql</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">select</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> logging_request_logs\G</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1.</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">row</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">               lrl_id: c42761f6</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">b072</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4744</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">a17</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">d8e6097b85de</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">lrl_service_detail_id: b069366a</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">25</span><span class="token plain">dc</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">41</span><span class="token plain">ec</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">f09</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">242</span><span class="token plain">d81755cd0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">         lrl_trace_id: </span><span class="token number" style="color:#5a9bcf">055329</span><span class="token plain">a0</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">cfc1</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4606</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">baf0</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">fb0cc905ba2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   lrl_parent_span_id: </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          lrl_span_id: aab83092</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">7749</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain">f88</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">8</span><span class="token plain">cb6</span><span class="token operator" style="color:#d7deea">-</span><span class="token plain">a949cc060197</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       lrl_start_time: </span><span class="token number" style="color:#5a9bcf">1571642065262</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">         lrl_end_time: </span><span class="token number" style="color:#5a9bcf">1571642065286</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      lrl_http_status: </span><span class="token number" style="color:#5a9bcf">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">     lrl_request_body: </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  lrl_request_headers: {</span><span class="token string" style="color:#8dc891">"server-region"</span><span class="token plain">:</span><span class="token string" style="color:#8dc891">"JiNan"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">"host"</span><span class="token plain">:</span><span class="token string" style="color:#8dc891">"localhost:8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">"user-agent"</span><span class="token plain">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token string" style="color:#8dc891">"accept"</span><span class="token plain">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       lrl_request_ip: </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   lrl_request_method: GET</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      lrl_request_uri: </span><span class="token operator" style="color:#d7deea">/</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    lrl_response_body: 你好：admin</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> lrl_response_headers: {}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   lrl_time_consuming: </span><span class="token number" style="color:#5a9bcf">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      lrl_create_time: </span><span class="token number" style="color:#5a9bcf">2019</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">10</span><span class="token operator" style="color:#d7deea">-</span><span class="token number" style="color:#5a9bcf">21</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">15</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">14</span><span class="token plain">:</span><span class="token number" style="color:#5a9bcf">26</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   lrl_request_params: {</span><span class="token string" style="color:#8dc891">"name"</span><span class="token plain">:</span><span class="token string" style="color:#8dc891">"admin"</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  lrl_exception_stack: </span><span class="token boolean" style="color:#ff8b50">NULL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板画重点">敲黑板画重点<a class="hash-link" href="#敲黑板画重点" title="标题的直接链接">​</a></h2><p>本章我们进行集成了<code>ApiBoot Logging Admin</code>，将<code>业务服务</code>的每一次请求日志都进行上报到<code>Logging Admin</code>，通过数据库的方式进行保存请求日志，然后也可以通过其他的方式，而且可以通过<code>spanId</code>以及<code>traceId</code>查看每一条请求链路的日志上下级关系以及每一个请求内耗时最多的<code>span</code>，可以精准的进行优化服务性能。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-report-logs-by-logging-to-admin</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
        <item>
            <title><![CDATA[使用ApiBoot Logging进行统一管理请求日志]]></title>
            <link>https://apiboot2.minbox.org/blog/apiboot-unified-manage-request-logs</link>
            <guid>apiboot-unified-manage-request-logs</guid>
            <pubDate>Tue, 15 Oct 2019 21:35:57 GMT</pubDate>
            <description><![CDATA[ApiBoot Logging通过集成minbox-logging来进行管理每一次请求的日志信息，包含头信息、参数、主体内容、路径、发生的服务器相关信息等，根据接口的响应状态还可以记录响应的头信息、响应的内容以及发生异常时的堆栈信息。]]></description>
            <content:encoded><![CDATA[<p><code>ApiBoot Logging</code>通过集成<code>minbox-logging</code>来进行管理每一次请求的日志信息，包含<code>头信息</code>、<code>参数</code>、<code>主体内容</code>、<code>路径</code>、发生的<code>服务器</code>相关信息等，根据接口的响应状态还可以记录响应的头信息、响应的内容以及发生异常时的<code>堆栈信息</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="minbox-projects开源组织">minbox-projects开源组织<a class="hash-link" href="#minbox-projects开源组织" title="标题的直接链接">​</a></h2><p><code>“org.minbox.framework”</code> 致力于向广大开发者提供一系列的 <code>“开箱即用”</code> 的框架落地实现解决方案。 </p><p>自从<code>ApiBoot</code>框架的落地，内部集成的<code>第三方插件（plugin）</code>日渐增多也同样导致了<code>ApiBoot</code>的源码太过于冗肿，针对这个问题<code>minbox-projects</code>开源组织就诞生了，<code>ApiBoot</code>第一个加入了该组织，并且会将<code>ApiBoot</code>内集成的<code>第三方插件</code>进行陆续分离，将每一个插件作为独立的开源项目加入<code>minbox-projects</code>开源组织，方便各个项目的单独维护以及更新发版。</p><p>组织首页：<a href="https://gitee.com/minbox-projects" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="minbox-logging日志组件">minbox-logging日志组件<a class="hash-link" href="#minbox-logging日志组件" title="标题的直接链接">​</a></h2><p><code>minbox-logging</code>日志组件是<code>minbox-projects</code>开源组织内的一员，是一款<strong>分布式零侵入式、链路式请求日志分析框架</strong>。</p><p>提供Admin端点进行<code>采集日志</code>、<code>分析日志</code>、<code>日志告警通知</code>、<code>服务性能分析</code>等。通过Admin Ui可查看实时<code>链路日志</code>信息、在线<code>业务服务列表</code>，致力解决<code>request -&gt; response</code>整个业务请求的日志分析以及记录。</p><p>minbox-logging日志组件源码：<a href="https://gitee.com/minbox-projects/minbox-logging" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/minbox-logging</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建示例项目">创建示例项目<a class="hash-link" href="#创建示例项目" title="标题的直接链接">​</a></h2><p>通过<code>idea</code>开发工具创建一个<code>SpringBoot</code>项目。</p><ul><li><strong>pom.xml依赖</strong></li></ul><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">&lt;!--配置参数--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">1.8</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">java.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">2.1.4.RELEASE</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">api.boot.version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">properties</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--Web--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.springframework.boot</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">spring-boot-starter-web</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot Logging--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-starter-logging</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${api.boot.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>测试控制器</strong></li></ul><p>添加一个用于测试的<code>LoggingSampleController</code>控制器，源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 请求日志示例</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RestController</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@RequestMapping</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">value </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"/test"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingSampleController</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 验证请求参数以及相应内容</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param name</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@GetMapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">hello</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@RequestParam</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">"name"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"你好："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 验证主体请求内容以及相应内容</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @param user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@PostMapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">bodyHello</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token annotation punctuation" style="color:#8dc891">@RequestBody</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token plain"> user</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"你好："</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">+</span><span class="token plain"> user</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getName</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * RequestBody 示例类</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">User</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>application.yml</strong></li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">spring</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">application</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> apiboot</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">unified</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">manage</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">request</span><span class="token punctuation" style="color:#8dc891">-</span><span class="token plain">logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token key atrule" style="color:#FAC863">server</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">port</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于<code>ApiBoot Logging</code>需要记录日志产生的服务器相关信息，所以<code>spring.application.name</code>以及<code>server.port</code>这两个参数必须配置，要不然启动项目时会抛出错误信息。</p><ul><li><strong>@EnableLoggingClient注解</strong></li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token annotation punctuation" style="color:#8dc891">@SpringBootApplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@EnableLoggingClient</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">ApibootUnifiedManageRequestLogsApplication</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">main</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">String</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token class-name" style="color:#FAC863">SpringApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">ApibootUnifiedManageRequestLogsApplication</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用<code>@EnableLoggingClient</code>注解来开启日志的<strong>客户端</strong>，将该注解配置在入口类上，内部通过<code>ImportBeanDefinitionRegistrar</code>进行注册<code>minbox-logging-client</code>所需要的<code>Bean</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apiboot的版本统一依赖">ApiBoot的版本统一依赖<a class="hash-link" href="#apiboot的版本统一依赖" title="标题的直接链接">​</a></h3><p>我们在使用<code>SpringBoot</code>时发现我们添加的依赖并不需要指定具体的<code>版本号</code>，这就是版本统一依赖起到的作用，主要还是<code>Maven继承关系</code>缘故。</p><p>在<code>ApiBoot</code>内也存在这么一个统一维护依赖版本的模块<code>api-boot-dependencies</code>，这个模块源码仅一个<code>pom.xml</code>文件，主要用来配置每一个第三方依赖或者内置的依赖的具体版本。</p><p>我们通过在项目中的<code>pom.xml</code>配置文件内添加如下版本管理依赖：</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#999999">&lt;!--ApiBoot统一版本依赖--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">org.minbox.framework</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">groupId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">api-boot-dependencies</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">artifactId</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">pom</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">type</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">import</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">scope</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#8dc891">&lt;</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain">${api.boot.version}</span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">version</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependency</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencies</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token tag punctuation" style="color:#8dc891">&lt;/</span><span class="token tag" style="color:#fc929e">dependencyManagement</span><span class="token tag punctuation" style="color:#8dc891">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就可以不指定版本号使用<code>ApiBoot</code>所提供的全部依赖。</p><blockquote><p>最新版的ApiBoot，请访问：<a href="https://search.maven.org/search?q=a:api-boot-dependencies" target="_blank" rel="noopener noreferrer"></a><a href="https://search.maven.org/search?q=a:api-boot-dependencies" target="_blank" rel="noopener noreferrer">https://search.maven.org/search?q=a:api-boot-dependencies</a>进行查询。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="测试请求">测试请求<a class="hash-link" href="#测试请求" title="标题的直接链接">​</a></h3><p>项目准备完成，我们先来把项目通过<code>SpringBoot Application</code>方式进行启动，通过如下<code>curl</code>命令访问我们的测试接口：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">curl</span><span class="token plain"> http://localhost:8080/test</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token plain">?name</span><span class="token punctuation" style="color:#8dc891">\</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">hengboy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问完成后，请求成功，但是控制台并没有打印任何请求日志信息，倒是有一个警告的日志：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">Not set 【LoggingAdminDiscovery】in LoggingFactoryBean，don't invoke report request logs.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个警告告知的很清楚，我们并未配置<code>logging-admin</code>，所以无法执行日志的上报，我们本章节是独立使用<code>ApiBoot Logging</code>日志组件，所以这个警告信息可以忽略。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="控制台打印请求日志">控制台打印请求日志<a class="hash-link" href="#控制台打印请求日志" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging</code>提供了一个配置<code>api.boot.logging.show-console-log</code>，该配置默认值为<code>false</code>，通过该配置可以实现在控制台打印请求日志。</p><p>在<code>application.yml</code>配置文件内添加配置如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Logging 日志组件配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>添加完成后，<strong>重启项目</strong>，再次访问测试接口，控制台打印如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token number" style="color:#5a9bcf">2019</span><span class="token number" style="color:#5a9bcf">-10</span><span class="token number" style="color:#5a9bcf">-16</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">20</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">18.489</span><span class="token plain">  INFO </span><span class="token number" style="color:#5a9bcf">3930</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">         task</span><span class="token number" style="color:#5a9bcf">-1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.m.f.l.c.n.support.LoggingLocalNotice   </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> Request Uri：/test， Logging：</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571192418416</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"name\":\"hengboy\"}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/test"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"你好：hengboy"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"apiboot-unified-manage-request-logs"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"35a22772-5015-438a-a441-ba407926b789"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571192418391</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">25</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"ec53d162-314e-4516-8c24-5d5e03181543"</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时我们就可以看到打印的请求日志信息了，不过打印的日志内容并未进行美化，不要着急，<code>ApiBoot Logging</code>同样提供了一个配置来进行美化输出内容。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="控制台美化请求日志">控制台美化请求日志<a class="hash-link" href="#控制台美化请求日志" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging</code>提供了配置<code>api.boot.logging.format-console-log-json</code>，该参数默认为<code>false</code>，我们通过修改该配置的值可以实现美化打印请求日志。</p><p>在<code>application.yml</code>配置文件内添加配置如下所示：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token key atrule" style="color:#FAC863">api</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token key atrule" style="color:#FAC863">boot</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># ApiBoot Logging 日志组件配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token key atrule" style="color:#FAC863">logging</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">show-console-log</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token key atrule" style="color:#FAC863">format-console-log-json</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ff8b50;font-weight:400">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>添加完成后我们再次来<strong>重启项目</strong>后，访问测试接口，控制台打印如下所示：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token number" style="color:#5a9bcf">2019</span><span class="token number" style="color:#5a9bcf">-10</span><span class="token number" style="color:#5a9bcf">-16</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">24</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">05.480</span><span class="token plain">  INFO </span><span class="token number" style="color:#5a9bcf">4051</span><span class="token plain"> --- </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token plain">         task</span><span class="token number" style="color:#5a9bcf">-1</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> o.m.f.l.c.n.support.LoggingLocalNotice   </span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> Request Uri：/test， Logging：</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"endTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571192645404</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"httpStatus"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">200</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">""</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"accept"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"*/*"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"host"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"localhost:8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token property" style="color:#5a9bcf">"user-agent"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"curl/7.64.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"0:0:0:0:0:0:0:1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestMethod"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"GET"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestParam"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"{\"name\":\"hengboy\"}"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"requestUri"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"/test"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseBody"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"你好：hengboy"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"responseHeaders"</span><span class="token operator" style="color:#d7deea">:</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"apiboot-unified-manage-request-logs"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"serviceIp"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"127.0.0.1"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"servicePort"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"8080"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"spanId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"277c0973-8042-4740-a8e7-2dbb0c7bb42c"</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"startTime"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">1571192645381</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"timeConsuming"</span><span class="token operator" style="color:#d7deea">:</span><span class="token number" style="color:#5a9bcf">23</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token property" style="color:#5a9bcf">"traceId"</span><span class="token operator" style="color:#d7deea">:</span><span class="token string" style="color:#8dc891">"7a742942-f3cc-4d72-9493-d828b090f1cc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这样是不是很直接明了的看到了请求的详细信息了？不过建议根据自己项目的实际情况来配置，美化后的日志会占用更多的<strong>控制台行</strong>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loggingnotice日志通知">LoggingNotice日志通知<a class="hash-link" href="#loggingnotice日志通知" title="标题的直接链接">​</a></h3><p><code>ApiBoot Logging</code>提供了日志通知的接口，我们只需要实现该接口就可以获取到<code>每一次请求</code>的<code>日志对象</code>，还可以自定义每一个日志通知实现类的<code>执行顺序</code>。</p><p>在<code>ApiBoot Logging</code>内部提供的实现类如下图所示：</p><p><img loading="lazy" src="/assets/images/apiboot-unified-manage-request-logs-1-480205e3b1057e3ccf560e169d3c812e.png" width="746" height="47" class="img_ev3q"></p><ul><li><p><strong>LoggingLocalNotice</strong></p><p>该类就是用于在控制台打印请求日志以及美化请求日志的实现，优先级为：<code>Ordered#HIGHEST_PRECEDENCE</code>（最高优先级）。</p></li><li><p><strong>LoggingAdminNotice</strong></p><p>该类用于将请求日志上报到<code>Logging Admin</code>，优先级为：<code>Ordered#HIGHEST_PRECEDENCE +1</code>，仅低于<code>LoggingLocalNotice</code>。</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用loggingnotice添加header">使用LoggingNotice添加Header<a class="hash-link" href="#使用loggingnotice添加header" title="标题的直接链接">​</a></h3><p>在上面我们已经知道了两个内置的<code>LoggingNotice</code>实现类，优先级我们也已经清楚了，那么我们如果添加自定义的<code>LoggingNotice</code>实现类来向本次请求日志的<code>RequestHeader</code>内添加一个我们自定义的头信息该怎么做呢？</p><p><strong>AddHeaderLoggingNotice</strong>通知类源码如下所示：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * 通过{@link LoggingNotice}向日志的请求header内添加区域信息</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> * @author 恒宇少年</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token annotation punctuation" style="color:#8dc891">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">AddHeaderLoggingNotice</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">implements</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">LoggingNotice</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 区域头信息key</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">private</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">static</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">final</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">String</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">SERVER_REGION</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"server-region"</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">void</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">notice</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token class-name" style="color:#FAC863">MinBoxLog</span><span class="token plain"> minBoxLog</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        minBoxLog</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">getRequestHeaders</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">put</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token constant" style="color:#5a9bcf">SERVER_REGION</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">"JiNan"</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">/**</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * 最大优先级</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     *</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     * @return</span><br></span><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#8dc891">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">public</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">int</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">getOrder</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token constant" style="color:#5a9bcf">HIGHEST_PRECEDENCE</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于<code>minbox-logging</code>在设计初期就已经考虑到了这一点，所以添加起来比较简单，我们只需要调整我们自定义日志通知的优先级，然后通过<code>#notice</code>方法修改本次请求日志对象的值即可。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="敲黑板划重点">敲黑板划重点<a class="hash-link" href="#敲黑板划重点" title="标题的直接链接">​</a></h2><p>本章节我们介绍了<code>ApiBoot Logging</code>的集成使用，可用于采集请求日志，能力确不仅仅如此，使用得当它会很强大，<code>日志通知设计</code>可以使我们很好的控制一个请求的日志，对日志进行<code>添加标识</code>、<code>归类</code>等，可以通过配置来控制<code>日志打印</code>以及<code>美化</code>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码示例">代码示例<a class="hash-link" href="#代码示例" title="标题的直接链接">​</a></h2><p>如果您喜欢本篇文章请为源码仓库点个<code>Star</code>，谢谢！！！
本篇文章示例源码可以通过以下途径获取，目录为<code>apiboot-unified-manage-request-logs</code>：</p><ul><li>Gitee：<a href="https://gitee.com/minbox-projects/api-boot-chapter" target="_blank" rel="noopener noreferrer">https://gitee.com/minbox-projects/api-boot-chapter</a></li></ul>]]></content:encoded>
            <category>Log</category>
        </item>
    </channel>
</rss>